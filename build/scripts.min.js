"use strict";function _possibleConstructorReturn(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function initContextMenu(a){var b=document.querySelectorAll(a),c=document.querySelector("#context-menu");document.addEventListener("click",function(a){var b=a.target;do if("context-menu"===b.getAttribute("id"))return;while(b=b.parentElement);c.classList.remove("active"),c.classList.remove("left")});for(var d=function(a){a.addEventListener("contextmenu",function(a){return a.preventDefault(),e(a),!1})},e=function(a){c.classList.add("active");var b=c.querySelector("ul").offsetWidth,d=c.querySelector("ul").offsetHeight;c.style.top=Math.min(a.clientY,window.innerHeight-d)+"px",c.style.left=Math.min(a.clientX,window.innerWidth-b)+"px",console.log(c.style.left,window.innerWidth-(contexMenuWidth<<1)),c.classList.toggle("left",parseInt(c.style.left.replace("px",""))>window.innerWidth-(contexMenuWidth<<1))},f=0;f<b.length;f++)d(b[f])}function getMessage(a){if(!arguments.length)return a;for(var b=1;b<arguments.length;b++)a=a.replace(MSG_DIVIDER,arguments[b]);return a}function showSavingOptions(){G("#idImageWidth").val(canvas.width),G("#idImageHeight").val(canvas.height);var a,b,c=0,d=G("#layersSavionOptions").empty();each(Scene.layers,function(e){a=new G("input",{attr:{type:"checkbox",class:"layerVisibility",id:"layer"+c,checked:!0,name:e.title}}),b=new G("label",{attr:{for:"layer"+c++},cont:e.title}),d.append(new G("div",{cont:[a,b]}))}),G("#saveForm").show(),G("#modalWindow").show(),G("canvas").addClass("blur")}function serializeSaveData(){var a=function(a){var b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return a?"checkbox"==a.type?a.checked:a.value:b},b=[];b.width=a(G.byId("idImageWidth"),canvas.width),b.height=a(G.byId("idImageHeight"),canvas.height),b.name=a(G.byId("idImageName")),b.background=a(G.byId("idBackground"),KEYWORD_TRANSPARENT),b.format=G.byId("idImageFormat"),b.format=b.format.options&&b.format.selectedIndex&&b.format.options[b.format.selectedIndex]&&b.format.options[b.format.selectedIndex].value;var c=G.byClass("layerVisibility");b.selectedLayers=[];for(var d=0;d<c.length;d++)c[d].checked&&b.selectedLayers.push(c[d].name);processImageData(b)}function serializeShareData(){var a=function(a){return!!a&&("checkbox"==a.type?a.checked:a.value)},b={};b.user_name=a(G.byId("idUserName")),b.type=a(G.byId("idType")),b.limit=a(G.byId("idMaxWatchers")),b.password=a(G.byId("idSharingPassword")),b.shareMenu=a(G.byId("idShareMenu")),b.sharePaints=a(G.byId("idSharePaints")),b.shareObjects=a(G.byId("idShareObjects")),b.shareCreator=a(G.byId("idShareCreator")),b.shareLayers=a(G.byId("idShareLayers")),b.shareTitle=a(G.byId("idShareTitle")),$.post("/checkConnectionData",{content:JSON.stringify(b)},function(a){a.result>0?(closeDialog(),Project.connection.connect(b)):Alert.danger(a.msg)},"JSON")}function serializeWatcherData(){var a=function(a){return!!a&&("checkbox"==a.type?a.checked:a.value)},b={};b.user_name=a(G.byId("idWatchUserName")),b.less_id=a(G.byId("idLessonId")),b.password=a(G.byId("idWatchSharingPassword")),b.nickName=a(G.byId("idNickName")),b.password=a(G.byId("idSharingPassword")),b.timeLine=a(G.byId("idShowTimeLine")),b.changeResolution=a(G.byId("idChangeResolution")),b.showChat=a(G.byId("idShowChat")),b.shareId=a(G.byId("idShareId")),processWatchData(b)}function serializeSaveXmlData(){var a=function(a,b){for(var c=arguments.length,d=Array(c>2?c-2:0),e=2;e<c;e++)d[e-2]=arguments[e];var f=function(b){b&&(a[b.name]="checkbox"==b.type?b.checked:b.value)};return f(G.byId(b)),each(d,function(a){return f(G.byId(a))}),a};saveSceneAsFile(a({},"idProjectTitle","idSaveCreator","idSavePaint","idSaveTask","idTaskHint","idTaskTimeLimit","idSaveHistory","idStoreStatistics"))}function processWatchData(a){({shareId:a.shareId,nickName:a.nickName,password:a.password}),G.createElement("form");a.innerWidth=window.innerWidth,a.innerHeight=window.innerHeight,a.type="watch",$.post("/checkConnectionData",{content:JSON.stringify(a)},function(b){b.result>0?(closeDialog(),a.type=b.type,"exercise"===a.type&&(a.sharePaints=b.sharePaints,a.shareInput=b.shareInput,a.shareCreator=b.shareCreator,a.shareLayers=b.shareLayers,a.shareObjects=b.shareObjects),Project.connection.connect(a)):Alert.danger(b.msg)},"JSON")}function processImageData(a){a.name=isString(a.name)||"desktopScreen",a.format=isString(a.format)||IMAGE_FORMAT_PNG,a.width=a.width||canvas.width,a.height=a.height||canvas.height,a.selectedLayers=a.selectedLayers||[];var b=G("canvas",{attr:{width:canvas.width,height:canvas.height}}).first(),c=b.getContext("2d");isString(a.background)&&a.background!==KEYWORD_TRANSPARENT&&doRect({x:0,y:0,width:b.width,height:b.height,fillColor:a.background,ctx:c});for(var d in a.selectedLayers)a.selectedLayers.hasOwnProperty(d)&&Scene.getLayer(a.selectedLayers[d]).draw(c);var e=G("canvas",{attr:{width:a.width,height:a.height}}).first();c=e.getContext("2d"),c.drawImage(b,0,0,e.width,e.height),Files.saveImage(a.name,e.toDataURL(a.format)),closeDialog()}function shareALl(a){Options.setOpt("grid",a.checked),G.byId("idShareMenu").checked=a.checked,G.byId("idSharePaints").checked=a.checked,G.byId("idShareObjects").checked=a.checked,G.byId("idShareCreator").checked=a.checked,G.byId("idShareLayers").checked=a.checked}function pickUpColor(a,b){var c;arguments.length>1&&(c=b),$("#colorPalete").delegate(".colorPatern","click",function(){$("#colorPalete .selected").removeClass("selected"),a.call(c,$(this).addClass("selected").css("backgroundColor")),closeDialog(),draw()}),showColors()}function shadeColor1(a,b){var c=parseInt(a.slice(1),16),d=Math.round(2.55*b),e=(c>>16)+d,f=(c>>8&255)+d,g=(255&c)+d;return"#"+(16777216+65536*(e<255?e<1?0:e:255)+256*(f<255?f<1?0:f:255)+(g<255?g<1?0:g:255)).toString(16).slice(1)}function hexToRGBA(a){var b=parseInt(a.slice(1),16);return[b>>16,b>>8&255,255&b]}function isIn(a,b){var c;if(isArray(b)){for(c=0;c<b.length;c++)if(b[c]==a)return!0}else for(c=1;c<arguments.length;c++)if(arguments[c]===a)return!0;return!1}function roughSizeOfObject(a){for(var b=[],c=[a],d=0;c.length;){var e=c.pop();if(isBoolean(e))d+=4;else if(isString(e))d+=e.length<<1;else if(isNumber(e))d+=8;else if(isObject(e)&&b.indexOf(e)===-1){b.push(e);for(var f in e)e.hasOwnProperty(f)&&c.push(e[f])}}return d}function toHHMMSS(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,c=parseInt(a,10)/1e3,d=Math.floor(c/3600),e=Math.floor((c-3600*d)/60),f=c-3600*d-60*e;return d<10&&(d="0"+d),e<10&&(e="0"+e),f=f<10?"0"+f.toFixed(b):f.toFixed(b),d+":"+e+":"+f}function each(a,b){var c,d=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(Array.isArray(a))if(d)for(c=0;c<a.length;c++)b.call(d,a[c],c,a);else for(c=0;c<a.length;c++)b(a[c],c,a);else if(d)for(c in a)a.hasOwnProperty(c)&&b.call(d,a[c],c,a);else for(c in a)a.hasOwnProperty(c)&&b(a[c],c,a)}function eachFiltered(a,b,c){var d=arguments.length>3&&void 0!==arguments[3]&&arguments[3];each(a,function(a,d,e){return b(a,d,e)&&c(a,d,e)},d)}function setCursor(a){canvas.style.cursor=a}function closeDialog(){$("#modalWindow > div").each(function(){$(this).hide()}),$("#colorPalete").undelegate(),$("#modalWindow").hide(),$("canvas").removeClass("blur")}function getText(a,b,c,d,e){var f,g=$(document.createElement("INPUT"));arguments.length>1&&(f=e),g.attr({type:"text",value:a,id:"staticInput"}).css({left:b.x+"px",top:b.y+"px",width:c.x,height:c.y,fontSize:.6*c.y}).blur(function(){d.call(f,g.val()),g.remove(),draw()}).keyup(function(a){a.keyCode==ENTER_KEY&&(g.onblur=!1,d.call(f,g.val()),g.remove(),draw())}).appendTo("body"),g.select().focus()}function getFormattedDate(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Date.now(),b=new Date(a);return b.getDate()+"."+(b.getMonth()+1)+"."+b.getFullYear()+" "+b.getHours()+":"+b.getMinutes()+":"+b.getSeconds()+" "+b.getMilliseconds()}function setCookie(a,b,c){var d=new Date;d.setTime(d.getTime()+24*c*60*60*1e3),document.cookie=a+"="+b+";expires="+d.toUTCString()}function getCookie(a){var b,c,d=a+"=",e=document.cookie.split(";");for(b=0;b<e.length;b++){for(c=e[b];" "==c.charAt(0);)c=c.substring(1);if(0==c.indexOf(d))return c.substring(d.length,c.length)}return""}function drawBorder(a,b){var c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{tc:1,bc:1,cl:1,cr:1,br:1};(b.selected||"Paint"==b.name)&&(doRect({position:b.position,size:b.size,borderWidth:DEFAULT_STROKE_WIDTH<<1,lineDash:[15,5],ctx:a}),c.hasOwnProperty("tc")&&drawSelectArc(a,b.position.x+(b.size.x>>1),b.position.y),c.hasOwnProperty("cl")&&drawSelectArc(a,b.position.x,b.position.y+(b.size.y>>1)),c.hasOwnProperty("bc")&&drawSelectArc(a,b.position.x+(b.size.x>>1),b.position.y+b.size.y),c.hasOwnProperty("cr")&&drawSelectArc(a,b.position.x+b.size.x,b.position.y+(b.size.y>>1)),c.hasOwnProperty("br")&&drawSelectArc(a,b.position.x+b.size.x,b.position.y+b.size.y))}function rectRectCollision(a,b,c,d){var e=a.x,f=a.y,g=c.x,h=c.y,i=b.x,j=b.y,k=d.x,l=d.y;return g+k>e&&h+l>f&&g<e+i&&h<f+j}function objectToArray(a){var b=[];return each(a,function(a){return b.push(a)}),b}function updateSelectedObjectView(a){}function drawConnector(a,b,c){a=a.getClone().mul(b.size),doArc({x:b.position.x+a.x,y:b.position.y+a.y,fillColor:"brown",center:!0,width:10,height:10,ctx:c})}function drawSelectArc(a,b,c){var d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:SELECTOR_COLOR,e=arguments.length>4&&void 0!==arguments[4]?arguments[4]:SELECTOR_SIZE<<1,f=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];doArc({x:b,y:c,center:!0,width:e,height:e,fillColor:d,borderWidth:DEFAULT_STROKE_WIDTH<<1,lineDash:f?[15,5]:[],borderColor:SELECTOR_BORDER_COLOR,ctx:a})}function getMousePos(a,b){var c=a.getBoundingClientRect();return{x:b.touches[0].clientX-c.left,y:b.touches[0].clientY-c.top}}function setConstants(a){var b={},c=function(a,c){a=a.toUpperCase(),b[a]=c,Object.defineProperty(window,a,{value:c,writable:!1})};return each(a,function(a,b){"object"===("undefined"==typeof a?"undefined":_typeof(a))?each(a,function(a,d){"object"===("undefined"==typeof a?"undefined":_typeof(a))?each(a,function(a,e){"object"===("undefined"==typeof a?"undefined":_typeof(a))?each(a,function(a,f){c(b+"_"+d+"_"+e+"_"+f,a)}):c(b+"_"+d+"_"+e,a)}):c(b+"_"+d,a)}):c(b,a)}),b}function saveFile(a,b,c){"undefined"==typeof c&&(c="text/plain");var d=new Blob([b],{type:c}),e=document.getElementById("fileLink");e.href=URL.createObjectURL(d),e.download=a,e.click()}function saveImage(a,b){var c=document.getElementById("fileLink");c.href=b,c.download=a,c.click()}function loadImage(a){var b=document.getElementById("fileInput");b.onchange=function(b){var c=new FileReader;c.onload=function(){var b=new Image;b.src=c.result,a(b)},c.readAsDataURL(b.target.files[0])},b.click()}function loadFile(a){var b=document.createElement("input");b.setAttribute("id","fileInput"),b.setAttribute("type","file"),b.setAttribute("value","files"),b.setAttribute("class","hide"),b.onchange=function(b){var c=new FileReader;c.onload=function(){return a(c.result)},c.readAsText(b.target.files[0])},b.click()}function saveSceneAsFile(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{projectTitle:"scene_backup"};console.log(a);var a={scene:Scene.toObject(),creator:Creator.toObject(),paints:Paints.toObject(),type:2500};saveFile(a.projectTitle,JSON.stringify(a))}function saveSceneAsTask(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"default_task",b={};if(Scene.getTaskObject(b)){var c={scene:b.content,results:b.results,title:a,type:2501};saveFile(a,JSON.stringify(c))}else Alert.warning(b.error)}function loadTask(a,b,c){if(Task)return Logger.error("načítava sa task ked už jeden existuje");var d=Scene.createLayer(c,"task");each(a,function(a){a.layer=d.title,Creator.create(a)}),Task=new TaskManager(b,c,d),Logger.notif("Task "+c+" bol úspešne vytvorený")}function loadSceneFromFile(){loadFile(function(a){var b=JSON.parse(a);b.type&&2501===b.type?loadTask(b.scene,b.results,b.title):(Scene.fromObject(b.scene),Creator.fromObject(b.creator),Paints.fromObject(b.paints)),draw()})}function drawGrid(){var a,b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:GRID_WIDTH,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:GRID_DIST,d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:GRID_NTH_BOLD,e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:GRID_COLOR,f=[],g=[],h=0;for(a=0;a<canvas.width;a+=c)h++%d?f.push([a,0,a,canvas.height]):g.push([a,0,a,canvas.height]);for(h=0,a=0;a<canvas.height;a+=c)h++%d?f.push([0,a,canvas.width,a]):g.push([0,a,canvas.width,a]);doLine({points:f,borderWidth:b,borderColor:e}),doLine({points:g,borderWidth:3*b,borderColor:e})}function doPolygon(a){isUndefined(a.points)&&Logger.error(getMessage(MSG_TRY_DRAW_EMPTY_POLYGON));var b=$.extend(_initDef(a),a),c=a.offset?a.offset.x:0,d=a.offset?a.offset.y:0;b.ctx.beginPath();var e=function(a){var e=a.length;0==b.radius||isNaN(b.radius)?each(a,function(a,e){return e?b.ctx.lineTo(a.x+c,a.y+d):b.ctx.moveTo(a.x+c,a.y+d)}):each(a,function(f,g){var h,i,j=f.getClone().sub(a[e-1]),k=j.getLength();j.div(k),0==g?(h=a[g+1].getClone().sub(f),i=h.getLength(),h.div(i),isNumber(b.radius)?(i>>=1,k>>=1):(b.radius.replace("px",""),i=k=1,b.radius=parseInt(b.radius)),b.ctx.moveTo(a[e-1].x+j.x*k*b.radius+c,a[e-1].y+j.y*k*b.radius+d),b.ctx.quadraticCurveTo(f.x+c,f.y+d,f.x+h.x*i*b.radius+c,f.y+h.y*i*b.radius+d)):(h=a[(g+1)%e].getClone().sub(f),i=h.getLength(),h.div(i),isNumber(b.radius)?(i>>=1,k>>=1):(b.radius.replace("px",""),i=k=1),b.ctx.lineTo(f.x-j.x*k*b.radius+c,f.y-j.y*k*b.radius+d),b.ctx.quadraticCurveTo(f.x+c,f.y+d,f.x+h.x*i*b.radius+c,f.y+h.y*i*b.radius+d))}),b.ctx.closePath()};isArray(b.points[0])?each(b.points,e):e(b.points),_process(b)}function doArc(a){var b=_remakePosAndSize(_checkPosAndSize(a,"Arc"),a);b.ctx.beginPath(),b.ctx.ellipse(b.x+(b.width>>1),b.y+(b.height>>1),b.width>>1,b.height>>1,0,0,PI2),_process(b)}function doRect(a){var b=_checkPosAndSize(a,OBJECT_RECT);isDefined(a[ATTRIBUTE_RADIUS])&&(isNumber(a[ATTRIBUTE_RADIUS])?a[ATTRIBUTE_RADIUS]={tl:a[ATTRIBUTE_RADIUS],tr:a[ATTRIBUTE_RADIUS],br:a[ATTRIBUTE_RADIUS],bl:a[ATTRIBUTE_RADIUS]}:each(b[ATTRIBUTE_RADIUS],function(c,d){return a[ATTRIBUTE_RADIUS][d]=a[ATTRIBUTE_RADIUS][d]||b[ATTRIBUTE_RADIUS][d]}));var c=_remakePosAndSize(b,a);c.ctx.beginPath(),c.ctx.moveTo(c.x+c[ATTRIBUTE_RADIUS].tl,c.y),c.ctx.lineTo(c.x+c.width-c[ATTRIBUTE_RADIUS].tr,c.y),c.ctx.quadraticCurveTo(c.x+c.width,c.y,c.x+c.width,c.y+c[ATTRIBUTE_RADIUS].tr),c.ctx.lineTo(c.x+c.width,c.y+c.height-c[ATTRIBUTE_RADIUS].br),c.ctx.quadraticCurveTo(c.x+c.width,c.y+c.height,c.x+c.width-c[ATTRIBUTE_RADIUS].br,c.y+c.height),c.ctx.lineTo(c.x+c[ATTRIBUTE_RADIUS].bl,c.y+c.height),c.ctx.quadraticCurveTo(c.x,c.y+c.height,c.x,c.y+c.height-c[ATTRIBUTE_RADIUS].bl),c.ctx.lineTo(c.x,c.y+c[ATTRIBUTE_RADIUS].tl),c.ctx.quadraticCurveTo(c.x,c.y,c.x+c[ATTRIBUTE_RADIUS].tl,c.y),c.ctx.closePath(),_process(c)}function doLine(a){isUndefined(a.points)&&Logger.error(getMessage(MSG_TRY_DRAW_EMPTY_LINE)),!isArray(a.points[0])&&a.points.length<2&&Logger.error(getMessage(MSG_TRY_DRAW_ONE_POINT_LINE));var b,c,d,e,f=$.extend(_initDef(a),a),g=a.offset?a.offset.x:0,h=a.offset?a.offset.y:0;f.ctx.beginPath();var i=function(a){isNaN(a[0])?0==f.radius||isNaN(f.radius)?each(a,function(a,b){return b?f.ctx.lineTo(a.x+g,a.y+h):f.ctx.moveTo(a.x+g,a.y+h)}):each(a,function(i,j){0==j?f.ctx.moveTo(i.x,i.y):j+1<a.length?(b=a[j+1].getClone().sub(i),c=i.getClone().sub(a[j-1]),d=b.getLength(),e=c.getLength(),c.div(e),b.div(d),isNumber(f.radius)?(d>>=1,e>>=1):(f.radius.replace("px",""),d=e=1),f.ctx.lineTo(i.x-c.x*e*f.radius+g,i.y-c.y*e*f.radius+h),f.ctx.quadraticCurveTo(i.x+g,i.y+h,i.x+b.x*d*f.radius+g,i.y+b.y*d*f.radius+h)):f.ctx.lineTo(i.x+g,i.y+h)}):(f.ctx.moveTo(a[0]+g,a[1]+h),f.ctx.lineTo(a[2]+g,a[3]+h))};isArray(f.points[0])?each(f.points,i):i(f.points),f.fill=!1,_process(f)}function drawQuadraticCurve(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:DEFAULT_STROKE_WIDTH,c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:DEFAUL_STROKE_COLOR,d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:context;a.length<2||(d.lineWidth=b,d.strokeStyle=c,d.beginPath(),each(a,function(a,b){return 0==b?d.moveTo(a.x,a.y):d.quadraticCurveTo(a[0].x,a[0].y,a[1].x,a[1].y)}),d.stroke())}function fillText(a,b,c){var d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:DEFAULT_FONT_SIZE,e=arguments.length>4&&void 0!==arguments[4]?arguments[4]:DEFAULT_FONT_COLOR,f=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,g=arguments.length>6&&void 0!==arguments[6]?arguments[6]:FONT_ALIGN_NORMAL,h=arguments.length>7&&void 0!==arguments[7]?arguments[7]:context;h.font=d+"pt "+DEFAULT_FONT,h.fillStyle=e,g==FONT_ALIGN_NORMAL?(h.textAlign=FONT_HALIGN_LEFT,h.textBaseline=FONT_VALIGN_TOP,isArray(f)?h.fillText(a,b+f[0],c+f[1]):h.fillText(a,b+f,c+f)):g==FONT_ALIGN_CENTER&&(h.textAlign=FONT_HALIGN_CENTER,h.textBaseline=FONT_VALIGN_MIDDLE,h.fillText(a,b,c))}function getMaxWidth(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return isArray(a)?(each(a,function(a){isArray(a)?each(a,function(a){return b=Math.max(calcTextWidth(a),b)}):b=Math.max(calcTextWidth(a),b)}),b):calcTextWidth(a)}function setShadow(a){a?CanvasHandler.setShadow(context,DEFAULT_SHADOW_OFFSET,DEFAULT_SHADOW_OFFSET,"black",DEFAULT_SHADOW_BLUR):CanvasHandler.setShadow(context,0,0,"black",0)}function setLineDash(a){a?CanvasHandler.setLineDash(context,15,5):CanvasHandler.setLineDash(context,1)}function canvasToImage(a){return CanvasHandler.canvasToImage(a)}function imageToCanvas(a){return CanvasHandler.imageToCanvas(a)}function calcTextWidth(a){var b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return CanvasHandler.calcTextWidth(context,a,b)}function _initDef(a){var b={borderWidth:DEFAULT_STROKE_WIDTH,borderColor:DEFAUL_STROKE_COLOR,ctx:context,fillColor:DEFAULT_BACKGROUND_COLOR,radius:{tl:0,tr:0,br:0,bl:0},shadow:!1,lineCap:LINE_CAP_BUTT,center:!1,offset:null,joinType:LINE_JOIN_MITER,lineStyle:LINE_STYLE_NORMAL,lineType:JOIN_LINEAR,lineDash:[],bgImage:!1};return b.draw=isDefined(a.borderColor)||isDefined(a.borderWidth),b.fill=isDefined(a.fillColor),b}function _checkPosAndSize(a,b){return(isUndefined(a.x)||isUndefined(a.y))&&isUndefined(a.position)&&Logger.error(getMessage(MSG_TRY_DRAW_WITHOUT_POSITION,b)),(isUndefined(a.width)||isUndefined(a.height))&&isUndefined(a.size)&&Logger.error(getMessage(MSG_TRY_DRAW_WITHOUT_SIZE,b)),(a.width<=0||a.height<=0)&&Logger.error(getMessage(MSG_TRY_DRAW_WITH_NEG_POSITION,b)),_initDef(a)}function _remakePosAndSize(a,b){var c=$.extend(a,b);return isDefined(c.size)&&(isNumber(c.size)?(c.width=c.size,c.height=c.size):isArray(c.size)?(c.width=c.size[0],c.height=c.size[1]):(c.width=c.size.x,c.height=c.size.y)),isDefined(c.position)&&(isNumber(c.position)?(c.x=c.position,c.y=c.position):isArray(c.position)?(c.x=c.position[0],c.y=c.position[1]):(c.x=c.position.x,c.y=c.position.y)),c.center&&(c.x-=c.width>>1,c.y-=c.height>>1),c}function saveCanvasAsFile(){saveImage("canvas_screen_shot",canvas.toDataURL())}function _process(a){a.shadow&&Options.shadows&&setShadow(a.shadow),a.bgImage?(a.ctx.save(),a.ctx.clip(),a.bgImage instanceof HTMLImageElement?a.ctx.drawImage(a.bgImage,a.x,a.y,a.width,a.height):a.ctx.drawImage(a.bgImage.img,a.bgImage.x,a.bgImage.y,a.bgImage.w,a.bgImage.h,a.x,a.y,a.width,a.height),a.ctx.restore()):a.fill&&(a.ctx.fillStyle=a.fillColor,a.ctx.fill()),a.shadow&&setShadow(!1),a.ctx.lineCap=a.lineCap,a.ctx.lineJoin=a.joinType,"function"==typeof a.ctx.setLineDash&&a.ctx.setLineDash(a.lineDash),a.draw&&(a.ctx.lineWidth=a.borderWidth,a.ctx.strokeStyle=a.borderColor,a.ctx.stroke())}function testExercise(a,b){Project.connection.startExercise({user_name:b,less_id:a})}function testTeach(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"teacherName";Project.connection.startTeach({user_name:a,user_id:a})}function testWatch(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"watcherName";Project.connection.startWatch({user_name:b,less_id:a})}function testShare(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"SharerName",b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100;Project.connection.startShare({user_name:a,sharePaints:!0,shareCreator:!0,shareObjects:!0,shareLayers:!0,maxWatchers:b})}function setUpComponents(){components={draw:window.location.hash.indexOf(COMPONENT_DRAW)>=0||"undefined"!=typeof Watcher,share:window.location.hash.indexOf(COMPONENT_SHARE)>=0||"undefined"!=typeof Watcher,watch:window.location.hash.indexOf(COMPONENT_WATCH)>=0||"undefined"!=typeof Watcher,tools:window.location.hash.indexOf(COMPONENT_TOOLS)>=0||"undefined"!=typeof Watcher,save:window.location.hash.indexOf(COMPONENT_SAVE)>=0||"undefined"!=typeof Watcher,load:window.location.hash.indexOf(COMPONENT_LOAD)>=0||"undefined"!=typeof Watcher,screen:window.location.hash.indexOf(COMPONENT_SCREEN)>=0||"undefined"!=typeof Watcher,content:window.location.hash.indexOf(COMPONENT_CONTENT)>=0||"undefined"!=typeof Watcher,edit:window.location.hash.indexOf(COMPONENT_EDIT)>=0||"undefined"!=typeof Watcher,layers:window.location.hash.indexOf(COMPONENT_LAYERS)>=0||"undefined"!=typeof Watcher,task:window.location.hash.indexOf(COMPONENT_TASK)>=0||"undefined"!=typeof Watcher}}function sendMessage(a){"undefined"!=typeof Watcher&&Watcher.sendMessage(a,Project.autor),"undefined"!=typeof Sharer&&Sharer.isSharing&&Sharer.sendMessage(a,Project.autor),Panel.recieveMessage(a,Project.autor)}function ajax(a,b,c){isFunction(b)?(b={success:b},isString(c)&&(b.dataType=c)):isObject(b)||(b={}),b.method=b.method||"GET",b.async=b.async||!0;var d=0,e=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");isFunction(b.abort)&&(e.onabort=b.abort),isFunction(b.error)&&(e.onerror=b.error),isFunction(b.progress)&&(e.onprogress=b.progress),isFunction(b.timeout)&&(e.ontimeout=b.timeout),isFunction(b.loadEnd)&&(e.onloadend=function(){return b.loadEnd(Date.now()-d)}),isFunction(b.loadStart)&&(e.onloadstart=function(){b.loadStart(),d=Date.now()}),isFunction(b.success)&&(e.onreadystatechange=function(){if(4==e.readyState&&200==e.status&&isFunction(b.success))switch(b.dataType){case"json":b.success(JSON.parse(e.responseText));break;case"html":b.success((new DOMParser).parseFromString(e.responseText,FORMAT_FILE_XML));break;case"xml":b.success((new DOMParser).parseFromString(e.responseText,FORMAT_FILE_XML));break;default:b.success(e.responseText)}}),e.open(b.method,a,b.async),e.send()}function init(){Project.scene.addToScene(new Rect(new GVector2f(800,50),new GVector2f(100,100),"#ff0000")),Project.scene.addToScene(new Line([new GVector2f(10,400),new GVector2f(300,450)],5,"#66CCCC")),Project.scene.addToScene(new Arc(new GVector2f(600,300),new GVector2f(50,50),"#66CCCC")),Project.scene.addToScene(new Rect(new GVector2f(800,50),new GVector2f(100,100),"#ff0000")),Project.scene.addToScene(new Rect(new GVector2f(250,250),new GVector2f(100,100),"#00ff00")),Project.scene.addToScene(new Polygon([new GVector2f(1200,100),new GVector2f(1150,150),new GVector2f(1250,150)],"#ff69b4")),Project.scene.addToScene(new Table(new GVector2f(800,250),new GVector2f(200,800),[["meno","vek"],["gabo",21],["maros",35]]),"test2"),loadImage(function(a){return Project.scene.addToScene(new ImageObject(new GVector2f(300,400),new GVector2f(300,400),a))});var a={getArea:{name:"getArea",retType:"number",access:ACCESS_PUBLIC,args:"void"},getPosition:{name:"getPosition",retType:"GVector2f",access:ACCESS_PROTECTED,args:"void"}},b={x:{name:"x",access:ACCESS_PROTECTED,type:"number"},y:{name:"y",access:ACCESS_PROTECTED,type:"number"},width:{name:"width",access:ACCESS_PROTECTED,type:"number"},height:{name:"height",access:ACCESS_PROTECTED,type:"number"}};Project.scene.addToScene(new Class(new GVector2f(500,150),new GVector2f(250,250),"Rectange",b,a)),draw()}function setVisibilityData(a){Project.topMenu.visible=a.showTopMenu}function realDraw(){(("undefined"==typeof Watcher?"undefined":_typeof(Watcher))===KEYWORD_UNDEFINED||Watcher.connected)&&Project.context&&isObject(Project.context)&&(Project.increaseDrawCounter(),drawMousePos=(new Date).getMilliseconds(),CanvasHandler.clearCanvas(Project.context),Project.options.grid&&drawGrid(),Creator.operation==OPERATION_AREA&&area&&area.draw(),Project.scene.draw(),Creator.draw(),Project.topMenu.draw(),actContextMenu&&actContextMenu.draw(),Logger.log("kreslí sa všetko",LOGGER_DRAW),("undefined"==typeof timeLine?"undefined":_typeof(timeLine))!==KEYWORD_UNDEFINED&&timeLine&&timeLine.draw(),Project.context.font="30px Comic Sans MS",Project.context.fillStyle="red",Project.context.fillText("draw(ms): "+((new Date).getMilliseconds()-drawMousePos),window.innerWidth-100,15))}function testAnimation(){for(var a=[],b=0;b<100;b++)a.push(new Rect(new GVector2f(Math.random()*canvas.width,Math.random()*canvas.height),new GVector2f(50,50),"blue")),Scene.addToScene(a[a.length-1]),Entity.animateMove(a[a.length-1],new GVector2f(300,300))}function initGraphs(){var a=new Graph;a.addVertex({x:100,y:100,size:30,borderWidth:5,borderColor:"blue",fillColor:"red"}),a.addVertex({x:500,y:100,size:40,borderWidth:15,borderColor:"blue",fillColor:"red"}),a.addVertex({x:300,y:300,size:50,borderWidth:25,borderColor:"blue",fillColor:"red"}),a.addEdge({fillColor:"pink",borderWidth:10,A:0,B:1}),a.addEdge({fillColor:"brown",borderWidth:20,A:1,B:2}),a.addEdge({fillColor:"orange",borderWidth:30,A:0,B:2}),Scene.addToScene(a)}function createTable(a,b){var c=G("tr",{}),d=new G("table",{attr:{border:"1"},style:{borderCollapse:"collapse",width:"100%"}}),e=!0,f=!1,g=void 0;try{for(var h,i=a[Symbol.iterator]();!(e=(h=i.next()).done);e=!0){var j=h.value;c.append(new G("td",{cont:j,style:{padding:"5px",fontWeight:"bold",textAlign:"center"}}))}}catch(a){f=!0,g=a}finally{try{!e&&i.return&&i.return()}finally{if(f)throw g}}d.append(c);for(var k in b){c=G("tr",{});for(var l in b[k])c.append(new G("td",{style:{padding:"5px"},cont:0!=l?b[k][l]:getFormattedDate(b[k][l])}));d.append(c)}return d}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),LayersViewer=function(){function a(b){var c=this,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Layer_";return _classCallCheck(this,a),G.isDefined(a.instance)?void alert("Nieje možné vytvoriť viac ako jednu inštanciu LayersViewera!!!!"):(a.instance=this,this._defaultName=d,this._counter=0,this._layers={},this._activeLayer="",this._existingLayers=0,this._selectedLayer=null,this._layersViewer=this._createDiv(),b.appendChild(this._layersViewer.first()),void(G.isObject(Scene)&&G.isDefined(Scene._layers)&&each(Scene._layers,function(a){return c.createLayer(a)},this)))}return _createClass(a,[{key:"hover",value:function(a,b){return!1}},{key:"clickIn",value:function(a,b){return!1}},{key:"_createDiv",value:function(){return this._layersBody=G("div",{attr:{id:"layersBody"}}),G("div",{attr:{id:"layersViewer",onclick:"LayersViewer.clickOnLayersViewer(event)",class:"minimalized"},cont:[G.createElement("div",{id:"layersHeader"},[G.createElement("div",{class:"layersHeaderButton",id:"addLayerButton",onclick:"LayersViewer.createAnonymLayer()"},"+"),G.createElement("div",{class:"layersHeaderButton",id:"removeLayerButton",onclick:"LayersViewer.removeActiveLayer()"},"×"),G.createElement("div",{class:"layersHeaderButton",id:"toggleLayerButton",onclick:"G('#layersViewer').toggleClass('minimalized');"},"-")]),this._layersBody.first()]})}},{key:"_createLayerDiv",value:function(a){return G("div",{attr:{class:"layer",id:a,onclick:"LayersViewer.makeSelected(this, event)"},cont:[G.createElement("div",{class:"visible true",onclick:"LayersViewer.changeVisibility(this, event)"}),G.createElement("div",{class:"title",ondblclick:"LayersViewer.changeName(this, event)"},a),G.createElement("div",{class:"options",onclick:"LayersViewer.showOptions(this, event)"})]})}},{key:"createLayer",value:function(b){this._counter++,this._existingLayers++,this._layers[b.title]={layer:b,title:b.title,div:this._createLayerDiv(b.title)},this._layersBody.append(this._layers[b.title].div),1===this._existingLayers&&a.makeSelected(this._layers[b.title].div.first())}},{key:"onScreenResize",value:function(){}},{key:"deleteLayer",value:function(a){"string"==typeof a&&0!==a.length||(a=this.activeLayerName);var b=this._layers[a].div;if(b.hasClass("selected")&&this._existingLayers>1)for(var c in this._layers)if(c!==a&&this._layers.hasOwnProperty(c)){this._layers[c].div.addClass("selected");break}b.delete(),delete this._layers[a],this._existingLayers--}},{key:"selectedLayer",set:function(a){this._selectedLayer=this._layers[a],this._selectedLayer||alert("nieje označenážiadna vrstva")}},{key:"activeLayerName",get:function(){return this._selectedLayer.title}},{key:"activeLayer",get:function(){return this._selectedLayer.layer}}],[{key:"clickOnLayersViewer",value:function(a){draw(),G(a.target).is(".options")||G("#layerContextMenu").delete()}},{key:"setName",value:function(b){var c=G(b),d=c.parent().attr("oldName"),e=c.first().value;G.isDefined(a.instance._layers[e])&&alert("vrstva "+e+" už existuje"),b.onblur=b.onkeydown=null,Scene&&Scene.createLayer&&Scene.renameLayer(d,e),a.instance._layers[e]=a.instance._layers[d],a.instance._layers[e].title=e,delete a.instance._layers[d],c.parent().text(e)}},{key:"changeName",value:function(a){var b=G(a),c=b.text();b.attr("oldName",c);var d=G.createElement("input",{class:"tmpLayerInput",type:"text",onblur:"LayersViewer.setName(this)",onkeydown:"if(event.keyCode === 13){LayersViewer.setName(this)}",value:c});b.text("").append(d),d.focus(),d.select()}},{key:"changeVisibility",value:function(b,c){var d=a.instance._layers[G(b).parent().text()];d&&(d.div.find(".visible.true").toggleClass("false"),d.layer.visible=!d.layer.visible)}},{key:"showOptions",value:function(b,c){var d={items:[{key:"lockLayer",type:"boolean",attr:"locked",label:"Zamknuta"},{key:"drawPaint",attr:"drawPaint",type:"boolean",label:"Zobraziť malbu"},{key:"animatePaint",type:"button",label:"Prehrať malbu"},{key:"clearPaint",type:"button",label:"Vyčistiť malbu"},{key:"clearLayer",type:"button",label:"Vyčistiť vrstvu"}]},e=G.position(b),f=G.size(b);G("#layerContextMenu").delete();var g=[];G.each(d.items,function(a){var b=G.createElement("li",{onclick:'LayersViewer.clickOnContext(this, "'+a.attr+'")'},G.createElement("a",{},a.label));"boolean"===a.type&&b.append(G.createElement("div",{class:"visible true",attr:a.attr})),g.push(b)}),a.instance._layersViewer.append(G.createElement("nav",{id:"layerContextMenu"},G.createElement("ul",{},g),{top:e.y+f.height+"px",right:window.innerWidth-e.x-f.width+"px"}))}},{key:"clickOnContext",value:function(b,c){var d=G(b),e=d.children(".visible");e.isEmpty()?G("#layerContextMenu").delete():(a.instance.activeLayer[c]=!a.instance.activeLayer[c],e.class("/false")),draw()}},{key:"removeActiveLayer",value:function(){a.instance._layersViewer.class("minimalized")||Scene&&Scene.createLayer&&Scene.deleteLayer(a.instance.activeLayerName)}},{key:"createAnonymLayer",value:function(){a.instance._layersViewer.class("minimalized")||Scene&&Scene.createLayer&&Scene.createLayer(a.instance._defaultName+a.instance._counter);
}},{key:"makeSelected",value:function(b){var c=new G(b);c.hasClass("selected")||(G("#layersViewer .layer").each(function(){G(this).removeClass("selected")}),a.instance.selectedLayer=c.text(),c.addClass("selected"))}}]),a}(),G=function a(){var b=this;if(!(this instanceof a)){var c=Object.create(a.prototype);return a.apply(c,arguments),c}0===arguments.length?this.elements=[]:1===arguments.length?a.isString(arguments[0])?this.elements=a.find(arguments[0]):a.isArray(arguments[0])?(this.elements=[],a.each(arguments[0],function(c){a.isElement(c)&&b.elements.push(c)})):a.isElement(arguments[0])?this.elements=[arguments[0]]:null!==arguments[0]&&a.isDefined(arguments[0])&&a.isG(arguments[0])&&(this.elements=arguments[0].elements):2===arguments.length&&a.isString(arguments[0])&&a.isObject(arguments[1])&&(this.elements=[a.createElement(arguments[0],arguments[1].attr,arguments[1].cont,arguments[1].style)]),a.isUndefined(this.elements)&&(a.warn("nepodarilo sa rozpoznať argumenty: ",arguments),this.elements=[]),a.isArray(this.elements)||(a.error("elementy niesu pole ale "+a.typeOf(this.elements),arguments),this.elements=[]),this.size=this.length()},tests=function(a){var b=new a(document.body);b.empty(),0!==b.children().length()&&a.error("dlžka prazdneho objektu je: "+b.length()),b.append("<div id='idecko'>jupilajda</div>"),b.append(new a("div",{attr:{class:"clasa"},cont:"toto je classsa"}));var c=document.createElement("p");c.appendChild(document.createTextNode("juhuuu toto je paragraf")),b.append(c),3!==b.children().length()&&a.error("dlžka objektu s 2 detmi je: "+b.children().length());var d=new a("#idecko"),e=new a(".clasa"),f=new a("p");a.isDefined((new a).first())&&a.error("pri prazdnom G to nevratilo ako prvý element null"),d.first()!==document.getElementById("idecko")&&a.error("nenašlo to spravny element podla id"),e.first()!==document.getElementsByClassName("clasa")[0]&&a.error("nenašlo to spravny element podla class"),f.first()!==document.getElementsByTagName("p")[0]&&a.error("nenašlo to spravny element podla tagu"),a.isObject(d.css())||a.error("css() nevratilo objekt"),d.css("color",""),""!==d.css("color")&&a.error("nenastavený css nieje prazdny"),d.css("color","red"),"red"!==d.css("color")&&a.error("nesprávne to nastavilo css štýl"),d.css({color:"blue",width:"200px"}),"blue"===d.css("color")&&"200px"===d.css("width")||a.error("nesprávne to nastavilo css štýl s objektu"),d.parent().first()!==b.first()&&a.error("parent nefunguje správne");var g={a:"aa"},h={b:"bb",c:"cc"},i={a:"aaa",c:"cccc"},j=a.extend({},g,h,i);"aaa"===j.a&&"bb"===j.b&&"cccc"===j.c||a.error("nefunguje extendse pretože po zlučenie",g,h,i," vzniklo: ",j,"a malo vzniknut: ",{a:"aaa",b:"bb",c:"cccc"}),a("div",{attr:{id:"container"},cont:[a.createElement("nav",{id:"topMenu"},a.createElement("ul",{},[a.createElement("li",{},a.createElement("a",{class:"firstLink",href:"stranka"})),a.createElement("li",{},a.createElement("a",{class:"secondLink"}))])),a.createElement("div",{id:"wrapper",class:"wrappedDiv"},a.createElement("nav",{id:"rightMenu"},a.createElement("ul",{class:"secondUl"},[a.createElement("li",{class:"firstLi"},a.createElement("a",{class:"firstLink"})),a.createElement("li",{class:"middleLi disabled"},a.createElement("a",{class:"secondLink"})),a.createElement("li",{class:"lastLi disabled"},a.createElement("a",{class:"thirdLink"}))])))]}).appendTo(b),"stranka"!==a("#topMenu").find(".firstLink").attr("href")&&console.log("zlihalo 1"),a(".thirdLink").parents("#wrapper").is(".wrappedDiv")!==!0&&console.log("zlihalo 2"),0==a("#rightMenu").find("ul").children(":not(.disabled)").is(".firstLi")&&console.log("zlihalo 3"),a(".middleLi").prev().is(".firstLi")!==!0&&console.log("zlihalo 4"),a(".middleLi").next().is(".lastLi")!==!0&&console.log("zlihalo 5"),a(".secondUl").parent().is("#rightMenu")!==!0&&console.log("zlihalo 6"),a("#wrapper").equal(new a(".wrappedDiv"))!==!0&&console.log("zlihalo 7"),a("#wrapper").equal(a(".wrappedDiv").first())!==!0&&console.log("zlihalo 8"),a("#container").children().emptyAll(),a("#rightMenu").isEmpty()||console.log("zlihalo 9"),a("ul").isEmpty()||console.log("zlihalo 10")};G.ajax=function(a,b,c){var d=0;if(!window.XMLHttpRequest)return G.error("Lutujeme ale váš prehliadaš nepodporuje AJAX"),!1;var e=new XMLHttpRequest;return G.isFunction(b)?(b={success:b},G.isString(c)&&(b.dataType=c)):G.isObject(b)||(b={}),G.isString(a)?(b.method=b.method||"GET",b.async=b.async||!0,G.isFunction(b.abort)&&(e.onabort=b.abort),G.isFunction(b.error)&&(e.onerror=b.error),G.isFunction(b.progress)&&(e.onprogress=b.progress),G.isFunction(b.timeout)&&(e.ontimeout=b.timeout),G.isFunction(b.loadEnd)&&(e.onloadend=function(){return b.loadEnd(window.performance.now()-d)}),G.isFunction(b.loadStart)&&(e.onloadstart=function(){b.loadStart(),d=window.performance.now()}),G.isFunction(b.success)?e.onreadystatechange=function(){if(4==e.readyState&&200==e.status)switch(b.dataType){case"json":b.success(JSON.parse(e.responseText));break;case"html":b.success((new DOMParser).parseFromString(e.responseText,"text/xml"));break;case"xml":b.success((new DOMParser).parseFromString(e.responseText,"text/xml"));break;default:b.success(e.responseText)}}:G.error("nieje zadaná Succes funkcia"),e.open(b.method,a,b.async),e.send(),e):(G.error("url nieje string a je: ",a),!1)},G.byId=function(a){return document.getElementById(a)},G.byClass=function(a){return document.getElementsByClassName(a)},G.hasClass=function(a,b){return G.isElement(a)&&G.isToStringable(b)?a.classList.contains(b):(G.error("argumenty musia byť (element, string) a sú ",G.typeOf(a),G.typeOf(b)),!1)},G.byTag=function(a){return document.getElementsByTagName(a)},G.error=function(){console.error.apply(console,arguments)},G.warn=function(){console.warn.apply(console,arguments)},G.log=function(){console.log.apply(console,arguments)},G.createElement=function(a,b,c,d){var e;if(G.isObject(a)){if(!G.isString(a.name))return G.error("prví parameter funkcie[Object] musí obsahovať name[String] ale ten je: ",a.name);G.createElement(a.name,a.attr||{},a.cont||"",a.style||{})}return G.isString(a)?(e=document.createElement(a),G.isObject(b)&&G.each(b,function(a,b){return e.setAttribute(b,a)}),G.isObject(d)&&G.each(d,function(a,b){return e.style[b]=a}),G.isToStringable(c)?G.html(e,c):G.isArray(c)?G.each(c,function(a){G.isObject(a)&&e.appendChild(a)}):G.isElement(c)?e.appendChild(c):G.isG(c)&&e.appendChild(c.first()),e):G.error("prvý parameter(nazov elementu) musí byť string a je: ",a)},G.typeOf=function(a){return"undefined"==typeof a?"undefined":_typeof(a)},G.isFunction=function(a){return"function"===G.typeOf(a)},G.isDefined=function(a){return"undefined"!==G.typeOf(a)},G.isString=function(a){return"string"===G.typeOf(a)},G.isObject=function(a){return"object"===G.typeOf(a)},G.isNumber=function(a){return"number"===G.typeOf(a)},G.isInt=function(a){return G.isNumber(a)&&a%1===0},G.isFloat=function(a){return G.isNumber(a)&&a%1!==0},G.isBool=function(a){return"boolean"===G.typeOf(a)},G.isG=function(a){return G.isObject(a)&&Object.getPrototypeOf(a)===G.prototype},G.isUndefined=function(a){return!G.isDefined(a)},G.isArray=function(a){return Array.isArray(a)},G.isToStringable=function(a){return G.isNumber(a)||G.isString(a)||G.isBool(a)},G.isEmpty=function(a){return a==={}||a===[]||""===a},G.isElement=function(a){try{return a instanceof HTMLElement}catch(b){return G.isObject(a)&&1===a.nodeType&&G.isObject(a.style)&&G.isObject(a.ownerDocument)}},G.isIn=function(a,b){if(G.isArray(b)){if(b.indexOf(a)>=0)return!0}else for(var c=1;c<arguments.length;c++)if(arguments[c]===a)return!0;return!1},G.extend=function(){var a=arguments[0],b=Array.from(arguments);return b.splice(0,1),G.isObject(a)?G.each(b,function(b,c){G.isObject(b)?G.each(b,function(b,c){return a[c]=b}):G.error("args["+c+"] ma byť object a je : ",b)}):G.error("prvý argument musí byť objekt. teraz je: ",a),a},G.each=function(a,b,c){var d;if(G.isObject(a)&&G.isFunction(b)){if(G.isArray(a))if(G.isObject(c))for(d=0;d<a.length&&b.call(c,a[d],d,a)!==!1;d++);else for(d=0;d<a.length&&b(a[d],d,a)!==!1;d++);else if(G.isObject(c)){for(d in a)if(a.hasOwnProperty(d)&&b.call(c,a[d],d,a)===!1)break}else for(d in a)if(a.hasOwnProperty(d)&&b(a[d],d,a)===!1)break}else G.error("argumenty majú byť (object, function) a sú:",a,b)},G.find=function(a,b){var c=[];if(G.isElement(b)||(b=document),G.isString(a)){var d=b.querySelectorAll(a);G.each(d,function(a){return c.push(a)})}else G.error("argument funkcie musí byť string a je ",a);return c},G.parent=function(a){return G.isElement(a)?a.parentElement:(G.error("argument funcie musí byť element a teraz je: ",a),null)},G.parents=function(a,b){(G.isUndefined(b)||!G.isString(b)||G.isEmpty(b))&&(b="*");var c=[];if(G.isElement(a)){for(;a=a.parentElement;)a.matches(b)&&c.push(a);return c}return[]},G.text=function(a,b,c){if(G.isElement(a)){if(G.isUndefined(b))return a.textContent;G.isToStringable(b)?c?a.textContent+=b:a.textContent=b:G.error("druhý argument musí byť string a je: ",html)}else G.error("prvý argument musí byť objekt a je: ",a);return a},G.html=function(a,b,c){if(G.isUndefined(c)&&(c=!1),G.isElement(a)){if(G.isUndefined(b))return a.innerHTML();G.isToStringable(b)?c?a.innerHTML+=b:a.innerHTML=b:G.error("druhý argument musí byť string a je: ",b)}else G.error("prvý argument musí byť objekt a je: ",a);return a},G.next=function(a){return G.isElement(a)?a.nextSibling:(G.error("prvý argument musí byť element a je: ",a),null)},G.prev=function(a){return G.isElement(a)?a.previousSibling:(G.error("prvý argument musí byť element a je: ",a),null)},G.children=function(a,b){(G.isUndefined(b)||!G.isString(b)||G.isEmpty(b))&&(b="*");var c=[];if(G.isElement(a)){var d=a.children;G.each(d,function(a){c.indexOf(a)<0&&a.matches(b)&&c.push(a)})}else G.error("argument funcie musí byť element a teraz je: ",a);return c},G.delete=function(a){G.isElement(a)?a.parentElement.removeChild(a):G.error("argument funcie musí byť element a teraz je: ",a)},G.prototype.parents=function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"*";return new G(G.parents(this.first(),a))},G.prototype.find=function(a){return new G(G.find(a,this.first()))},G.prototype.is=function(a){if(this.isEmpty())return null;try{return this.first().matches(a)}catch(a){return null}},G.prototype.add=function(){var a=this;return G.each(arguments,function(b,c){G.isElement(b)?a.element.push(b):G.isString(b)?a.elements.push.apply(a,G.find(b)):G.error("argumenty funkcie: (string[]), "+c+" -ty argument: ",b)}),this},G.prototype.remove=function(){var a,b=this;return G.each(arguments,function(c){G.isElement(c)&&(a=b.elements.indexOf(c),a>=0&&b.elements.splice(a,1))}),this},G.prototype.clear=function(){return this.elements=[],this},G.prototype.contains=function(a){if(G.isElement){for(var b=0;b<this.element.length;b++)if(this.element[b]===a)return!0}else G.error("argument funkcie musí byť element a teraz je: ",a);return!1},G.prototype.equal=function(a){return G.isG(a)?this.first()===a.first():G.isElement(a)?this.first()===a:(G.error("argument funkcie môže byť iba element alebo G objekt"),!1)},G.prototype.width=function(){return this.isEmpty()?null:this.first().offsetWidth},G.prototype.height=function(){return this.isEmpty()?null:this.first().offsetHeight},G.prototype.show=function(){return this.css("display","block")},G.prototype.hide=function(){return this.css("display","none")},G.prototype.toggle=function(){return"none"===this.css("display")?this.show():this.hide()},G.prototype.emptyAll=function(){return G.each(this.elements,function(a){return G.html(a,"")}),this},G.prototype.empty=function(){return this.html("")},G.prototype.hasClass=function(a){return this.class(a)},G.prototype.val=function(){return this.attr("value",arguments[0])},G.prototype.addClass=function(a){return this.class("+"+a)},G.prototype.removeClass=function(a){return this.class("-"+a)},G.prototype.toggleClass=function(a){return this.class("/"+a)},G.prototype.parent=function(){return new G(G.parent(this.first()))},G.prototype.next=function(){return new G(G.next(this.first()))},G.prototype.prev=function(){return new G(G.prev(this.first()))},G.prototype.children=function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"*";return new G(G.children(this.first(),a))},G.prototype.first=function(){return this.elements[0]},G.prototype.length=function(){return this.elements.length},G.prototype.isEmpty=function(){return 0===this.length()},G.prototype.each=function(a){for(var b=arguments.length,c=Array(b>1?b-1:0),d=1;d<b;d++)c[d-1]=arguments[d];return G.isFunction(a)?G.each(this.elements,function(b){return a.apply(b,c)}):G.error("prvý parameter musí byť funkcia a je: ",a),this},G.prototype.deleteAll=function(){return G.each(this.elements,function(a){return G.delete(a)}),this.elements=[],this},G.prototype.prependTo=function(a){return this.isEmpty()?this:(G.isElement(a)?a.parentElement.insertBefore(this.first(),a.parentElement.firstElementChild):G.isG(a)&&!a.isEmpty()?a.parent().first().insertBefore(this.first(),a.parent().first().firstElementChild):G.error("argument funkcie musí byť element a je: ",a),this)},G.prototype.appendTo=function(a){return this.isEmpty()?this:(G.isElement(a)?a.appendChild(this.first()):G.isG(a)&&!a.isEmpty()?a.first().appendChild(this.first()):G.error("argument funkcie musí byť element a je: ",a),this)},G.prototype.prepend=function(a){return this.isEmpty()?this:(G.isElement(a)?this.first().insertBefore(a,this.first().firstElementChild):G.isString(a)?this.html(a+this.html()):G.error("argument funkcie musí byť element alebo string a teraz je: ",a),this)},G.prototype.append=function(a){return this.isEmpty()?this:(G.isElement(a)?this.first().appendChild(a):G.isString(a)?G.html(this.first(),a,!0):G.isG(a)&&!a.isEmpty()?this.first().appendChild(a.first()):G.error("argument funkcie musí byť element alebo string a teraz je: ",a),this)},G.prototype.text=function(a,b){return G.isUndefined(b)&&(b=!1),this.isEmpty()?this:G.isUndefined(a)?G.text(this.first()):("+"===a[0]?G.text(this.first(),a.substring(1),!0):G.text(this.first(),a),this)},G.prototype.html=function(a){return this.isEmpty()?this:G.isUndefined(a)?G.html(this.first()):(G.isString(a)?"+"===a[0]?G.html(this.first(),a.substring(1),!0):G.html(this.first(),a):G.isElement(a)&&(G.html(this.first(),""),this.append(a)),this)},G.prototype.delete=function(){return this.isEmpty()?this:(G.delete(this.first()),G.isArray(this.elements)&&this.elements.splice(0,1),this)},G.prototype.class=function(a,b){var c=this;if(this.isEmpty())return this;var d=this.first().classList;if(G.isArray(a))G.each(a,function(a){return c.class(a)});else if(G.isString(a))switch(a[0]){case"+":d.add(a.substring(1));break;case"-":d.remove(a.substring(1));break;case"/":a=a.substring(1),G.isBool(b)?d.toggle(a,b):d.toggle(a);break;default:return d.contains(a)}return null},G.prototype.css=function(){var a=this;if(this.isEmpty())return this;if(0===arguments.length){var b={},c=window.getComputedStyle(this.first());return G.each(c,function(a){""!==c.getPropertyValue(a)&&(b[a]=c.getPropertyValue(a))}),b}if(G.isString(arguments[0]))if(2==arguments.length&&G.isToStringable(arguments[1]))this.first().style[arguments[0]]=arguments[1];else{if("-"!==arguments[0][0])return this.first().style[arguments[0]];this.first().style[arguments[0].substring(1)]=""}else G.isObject(arguments[0])&&G.each(arguments[0],function(b,c){G.isString(c)&&G.isToStringable(b)&&(a.first().style[c]=b)});return this},G.prototype.attr=function(){var a=this;if(this.isEmpty())return this;if(0===arguments.length){var b={};return G.each(this.first().attributes,function(a){b[a.nodeName]=a.nodeValue}),b}if(G.isString(arguments[0]))if(2==arguments.length&&G.isToStringable(arguments[1]))this.first().setAttribute(arguments[0],arguments[1]);else{if("-"!==arguments[0][0])return this.first().getAttribute(arguments[0]);this.first().removeAttribute(arguments[0].substring(1))}else G.isObject(arguments[0])&&G.each(arguments[0],function(b,c){G.isString(c)&&G.isToStringable(b)&&a.first().setAttribute(c,b)});return this},G._modifyListener=function(a,b,c,d){var e=["click","blur","submit","focus","scroll","keydown","keyup","dblclick"];return G.isElement(a)?G.isIn(b,e)?G.isFunction(c)?"unset"===d?a.removeEventListener(b,displayDate):"set"===d&&a.addEventListener(b,displayDate):Logger.error("tretí parameter musí byť funkcia ale je",G.typeOf(c)):Logger.error("druhý parameter nieje platný listenre"):Logger.error("prví parameter musí byť element ale je",G.typeOf(a)),eleelement},G.prototype.unbind=function(a,b){return this.isEmpty()?this:(G._modifyListener(this.first(),a,b,"unset"),this)},G.prototype.bind=function(a,b){return this.isEmpty()?this:(G._modifyListener(this.first(),a,b,"set"),this)},G.prototype.blur=function(a){return(void 0).bind("blur",a)},G.prototype.keyup=function(a){return(void 0).bind("keyup",a)},G.prototype.click=function(a){return(void 0).bind("click",a)},G.prototype.focus=function(a){return(void 0).bind("focus",a)},G.prototype.submit=function(a){return(void 0).bind("submit",a)},G.prototype.scroll=function(a){return(void 0).bind("scroll",a)},G.prototype.keydown=function(a){return(void 0).bind("keydown",a)},G.prototype.dblclick=function(a){return(void 0).bind("dblclick",a)},G.position=function(a){if(!G.isElement(a))return G.warn("argument musí byť element"),null;var b=0,c=0;do b+=a.offsetTop||0,c+=a.offsetLeft||0,a=a.offsetParent;while(a);return{y:b,x:c}},G.left=function(a){if(!G.isElement(a))return G.warn("argument musí byť element"),0;var b=0;do b+=a.offsetLeft||0,a=a.offsetParent;while(a);return b},G.top=function(a){if(!G.isElement(a))return G.warn("argument musí byť element"),0;var b=0;do b+=a.offsetTop||0,a=a.offsetParent;while(a);return b},G.size=function(a){!(arguments.length>1&&void 0!==arguments[1])||arguments[1],!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return G.isElement(a)?{width:a.offsetWidth,height:a.offsetHeight}:(G.warn("argument musí byť element"),null)},G.width=function(a){return G.isElement(a)?a.offsetWidth:(G.warn("argument musí byť element"),0)},G.height=function(a){return G.isElement(a)?a.offsetHeight:(G.warn("argument musí byť element"),0)};var LogManager=function(){function a(){_classCallCheck(this,a),a.LOGS="logs",a.WARNS="warns",a.ERRORS="errors",this._logs=[],this._data={},this._show={},this._data[a.LOGS]={},this._data[a.WARNS]={},this._data[a.ERRORS]={},this._show[a.LOGS]=this._show[a.WARNS]=this._show[a.ERRORS]=!0}return _createClass(a,[{key:"log",value:function(a,b){this._logs.push([Date.now(),a,b])}},{key:"notif",value:function(a){Alert.info(a)}},{key:"write",value:function(b){this._data[a.LOGS][Date.now()]=b,this._show[a.LOGS]&&console.log(b)}},{key:"error",value:function(b,c){Alert.danger(b),this._data[a.ERRORS][Date.now()]=b,this._show[a.ERRORS]&&(c?console.error(getErrorMessage(c)+b):console.error("number"==typeof b?getErrorMessage(b):b))}},{key:"warn",value:function(b){this._data[a.WARNS][Date.now()]=b,this._show[a.WARNS]&&console.warn(b)}},{key:"showLogs",value:function(){var a=G("#showLogs");a.length()>0&&(a.empty().append(createTable(["Time","Message","Type"],this._logs)),G("#showLogs").show(),G("#modalWindow").show())}},{key:"data",get:function(){return this_data}}]),a}(),getErrorMessage=function(a){switch(a){case 0:return"Nezadaný parameter";case 1:return"Neznáma Input akcia: ";case 2:return"Neznáma Object akcia: ";case 3:return"Neznáma Paint akcia: ";default:return"Neznáma chyba"}},Alert={_closeParent:function(a){a.parentElement.style.opacity=0,setTimeout(function(){null!==a.parentElement.parentElement&&a.parentElement.parentElement.removeChild(a.parentElement)},300)},success:function(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3;return Alert._showAlert(a,"success",b)},warning:function(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3;return Alert._showAlert(a,"warning",b)},danger:function(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3;return Alert._showAlert(a,"danger",b)},info:function(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3;return Alert._showAlert(a,"info",b)},_showAlert:function(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success",c=arguments[2];if("undefined"==typeof document||"undefined"==typeof document.body)return!1;var d=function(a,b,c){var d=document.createElement(a);if("object"===("undefined"==typeof b?"undefined":_typeof(b)))for(var e in b)b.hasOwnProperty(e)&&d.setAttribute(e,b[e]);return"string"==typeof c&&d.appendChild(document.createTextNode(c)),d},e=d("div",{class:"alert alert-"+b}),f=d("a",{onclick:"Alert.removeEvent(event)",class:"close"},"×");switch(b){case"success":b="success! ";break;case"info":b="Info! ";break;case"warning":b="Warning! ";break;case"danger":b="Danger! "}e.appendChild(d("strong",{},b)),e.appendChild(f),"string"==typeof a?e.appendChild(document.createTextNode(a)):e.appendChild(a),document.body.appendChild(e),setTimeout(function(){return Alert.removeEvent({target:f})},c)},removeEvent:function(a){return Alert._closeParent(a.target),!1},show:function(){Alert._showAlert("warningoš","warning"),Alert._showAlert("successoš","success"),Alert._showAlert("infoš","info"),Alert._showAlert("dangeroš","danger")}},LEFT_BUTTON=0,RIGHT_BUTTON=2,SHIFT_KEY=16,L_CTRL_KEY=17,L_ALT_KEY=18,ESCAPE_KEY=27,ENTER_KEY=13,Z_KEY=90,Y_KEY=89,DELETE_KEY=46,A_KEY=65,KEY_NUM_1=49,KEY_NUM_2=50,KEY_NUM_3=51,KEY_NUM_4=52,KEY_NUM_5=53,KEY_NUM_6=54,KEY_NUM_7=55,KEY_NUM_8=56,KEY_NUM_9=57,FPS=60,FONT_HALIGN_LEFT="left",FONT_HALIGN_CENTER="center",FONT_HALIGN_RIGHT="right",FONT_VALIGN_MIDDLE="middle",FONT_VALIGN_TOP="top",FONT_VALIGN_ALPHA="alphabetic",FONT_VALIGN_HANG="hanging",FONT_VALIGN_IDEO="ideographic",FONT_VALIGN_BOTT="bottom",FONT_ALIGN_CENTER=10,FONT_ALIGN_NORMAL=11,FOLDER_IMAGE="/img",FOLDER_JSON="/js/json",SELECTOR_SIZE=10,SELECTOR_COLOR="orange",SELECTOR_BORDER_COLOR="black",LINE_CAP_BUTT="butt",LINE_CAP_ROUND="round",LINE_CAP_SQUARE="square",LINE_JOIN_MITER="miter",LINE_JOIN_ROUND="round",LINE_JOIN_BEVEL="bevel",OPERATION_DRAW_RECT=1e3,OPERATION_DRAW_ARC=1001,OPERATION_DRAW_PATH=1002,OPERATION_DRAW_LINE=1003,OPERATION_DRAW_JOIN=1004,OPERATION_DRAW_IMAGE=1005,OPERATION_RUBBER=1006,OPERATION_AREA=1007,JOIN_LINEAR=2e3,JOIN_BAZIER=2001,JOIN_SEQUENCAL=2002,LINE_STYLE_NORMAL=2100,LINE_STYLE_STRIPPED=2101,LINE_STYLE_FILLED=2102,LIMIT_LAYERS_COUNT=10,DEFAULT_BACKGROUND_COLOR="#ffffff",DEFAULT_FONT="Comic Sans MS",DEFAULT_FONT_SIZE=22,DEFAULT_FONT_COLOR="#000000",DEFAULT_SHADOW_COLOR="#000000",DEFAULT_SHADOW_BLUR=20,DEFAULT_SHADOW_OFFSET=5,DEFAUL_STROKE_COLOR="#000000",DEFAULT_STROKE_WIDTH=2,DEFAULT_COLOR="#000000",DEFAULT_FILL_COLOR="#000000",DEFAULT_RADIUS=5,DEFAULT_TEXT_OFFSET=5,DEFAULT_FONT_HALIGN=FONT_HALIGN_LEFT,DEFAULT_FONT_VALIGN=FONT_VALIGN_TOP,DEFAULT_ROUND_VAL=10,DEFAULT_BORDER_COLOR="#000000",DEFAULT_BORDER_WIDTH=2,DEFAULT_LINE_TYPE=JOIN_LINEAR,DEFAULT_LINE_STYLE=LINE_STYLE_NORMAL,DEFAULT_BRUSH_SIZE=20,DEFAULT_BRUSH_TYPE="line",DEFAULT_BRUSH_COLOR="#000000",DEFAULT_LAYER_TITLE="default",DEFAULT_USER_NAME="DEFAULT_NAME",CONTEXT_MENU_LINE_HEIGHT=40,CONTEXT_MENU_FONT_COLOR=DEFAULT_FONT_COLOR,CONTEXT_MENU_OFFSET=10,CONTEXT_MENU_WIDTH=240,CONTEXT_FILL_COLOR="#1abc9c",CONTEXT_DISABLED_FILL_COLOR="#abd6bb",CONTEXT_SELECTED_FILL_COLOR="red",GRID_COLOR="Black",GRID_WIDTH=.1,GRID_DIST=10,GRID_NTH_BOLD=5,TOUCH_DURATION=500,TOUCH_VARIATION=5,MENU_OFFSET=10,MENU_RADIUS=10,MENU_BORDER_WIDTH=2,MENU_FONT_COLOR="#000000",MENU_BORDER_COLOR="#000000",MENU_WIDTH=50,MENU_HEIGHT=50,MENU_POSITION=MENU_OFFSET,MENU_BACKGROUND_COLOR="#1abc9c",MENU_DISABLED_BG_COLOR="#abd6bb",TABLE_BORDER_WIDTH=1,TABLE_HEADER_COLOR="#53cfff",TABLE_BODY_COLOR="#5bf2ff",TABLE_LINE_HEIGHT=40,TABLE_BORDER_COLOR="#000000",TABLE_WIDTH=300,TABLE_RADIUS=10,TABLE_TEXT_OFFSET=5,TIMELINE_HEIGHT=60,TIMELINE_SLIDER_HEIGHT=5,TIMELINE_SLIDER_COLOR="purple",TIMELINE_SLIDER_OFFSET=30,TIMELINE_BUTTON_SIZE=20,TIMELINE_BUTTON_COLOR="HotPink",TIMELINE_BUTTON_BORDER_COLOR="IndianRed",ACCESS_PUBLIC="+",ACCESS_PRIVATE="-",ACCESS_PROTECTED="#",ACTION_OBJECT_MOVE=2310,ACTION_OBJECT_CREATE=2311,ACTION_OBJECT_CHANGE=2312,ACTION_OBJECT_DELETE=2313,ACTION_PAINT_CLEAN=2314,ACTION_PAINT_ADD_POINT=2315,ACTION_PAINT_BREAK_LINE=2316,ACTION_PAINT_CHANGE_BRUSH=2317,ACTION_LAYER_CREATE=2318,ACTION_LAYER_DELETE=2319,ACTION_LAYER_CLEAN=2320,ACTION_LAYER_VISIBLE=2321,ACTION_LAYER_RENAME=2322,PAINT_ACTION_BRUSH=2400,PAINT_ACTION_LINE=2401,KEYWORD_OBJECT="object",KEYWORD_STRING="string",KEYWORD_NUMBER="number",KEYWORD_BOOLEAN="boolean",KEYWORD_FUNCTION="function",KEYWORD_UNDEFINED="undefined",KEYWORD_TRANSPARENT="transparent",PI2=2*Math.PI,IMAGE_FORMAT_JPG="image/jpeg",IMAGE_FORMAT_PNG="image/png",IMAGE_FORMAT_GIF="image/gif",FORMAT_FILE_XML="text/xml",ATTRIBUTE_FILL_COLOR="fillColor",ATTRIBUTE_BORDER_COLOR="borderColor",ATTRIBUTE_BORDER_WIDTH="borderWidth",ATTRIBUTE_LINE_WIDTH="lineWidth",ATTRIBUTE_FONT_SIZE="fontSize",ATTRIBUTE_FONT_COLOR="fontColor",ATTRIBUTE_LINE_TYPE="lineType",ATTRIBUTE_LINE_STYLE="lineStyle",ATTRIBUTE_BRUSH_SIZE="brushSize",ATTRIBUTE_BRUSH_TYPE="brushType",ATTRIBUTE_BRUSH_COLOR="brushColor",ATTRIBUTE_RADIUS="radius",INPUT_TYPE_CHECKBOX="checkbox",INPUT_TYPE_RADIO="radio",CHECKBOX_COLOR_TRUE="green",CHECKBOX_COLOR_FALSE="red",COMPONENT_DRAW="a",COMPONENT_SHARE="b",COMPONENT_WATCH="c",COMPONENT_TOOLS="d",COMPONENT_LOAD="e",COMPONENT_SCREEN="f",COMPONENT_CONTENT="g",COMPONENT_EDIT="h",COMPONENT_SAVE="i",COMPONENT_LAYERS="j",COMPONENT_TASK="k",LAYERS_LINE_HEIGHT=50,LAYERS_PANEL_WIDTH=180,LAYERS_PANEL_OFFSET=40,LAYERS_FONT_SIZE=20,LAYERS_CHECKBOX_SIZE=30,LAYERS_BUTTON_SIZE=40,LOGGER_MENU_CLICK=2600,LOGGER_CREATOR_CHANGE=2601,LOGGER_CONTEXT_CLICK=2602,LOGGER_OBJECT_CREATED=2604,LOGGER_OBJECT_ADDED=2605,LOGGER_OBJECT_CLEANED=2609,LOGGER_COMPONENT_CREATE=2606,LOGGER_PAINT_HISTORY=2607,LOGGER_PAINT_ACTION=2608,LOGGER_MOUSE_EVENT=2610,LOGGER_KEY_EVENT=2611,LOGGER_DRAW=2612,LOGGER_CHANGE_OPTION=2613,LOGGER_LAYER_CHANGE=2603,LOGGER_LAYER_CLEANED=2614,LOGGER_LAYER_RENAMED=2615,LOGGER_LAYER_RASTERED=2616,HIGHTLIGHT_CORRECT=2700,HIGHTLIGHT_WRONG=2701,LAYER_USER=2710,LAYER_GUI=2711,LAYER_TASK=2712,STATUS_CONNECTED=2720,STATUS_DISCONNECTED=2721,OBJECT_ARC="Arc",OBJECT_ARROW="Arrow",OBJECT_CLASS="Class",OBJECT_CONNECTOR="Connector",OBJECT_IMAGE="Image",OBJECT_JOIN="Join",OBJECT_LINE="Line",OBJECT_PAINT="Paint",OBJECT_POLYGON="Polygon",OBJECT_RECT="Rect",OBJECT_TABLE="Table",OBJECT_INPUT="Input",OBJECT_TEXT="Text",OBJECT_GRAPH="Graph",OBJECT_RUBBER="Rubber",OBJECT_AREA="Area",CURSOR_POINTER="pointer",CURSOR_DEFAULT="default",CURSOR_NOT_ALLOWED="not-allowed",OPTION_CHANGE_CURSOR=!0,OPTION_MOVING_SILHOUETTE=!1,OPTION_SHOW_SHADOWS=!0,OPTION_CANVAS_BLUR=!1,OPTION_SHOW_LAYERS_VIEWER=!0,OPTION_SHOW_GRID=!0,LINE_NONE=2210,LINE_ARROW_CLASSIC=2211,LINE_ARROW_CLOSED=2212,LINE_ARROW_FILLED=2213,LINE_DIAMOND_CLASSIC=2214,LINE_DIAMOND_FILLED=2215,ACTION_MOUSE_MOVE=2318,ACTION_MOUSE_DOWN=2319,ACTION_MOUSE_UP=2320,ACTION_KEY_DOWN=2321,ACTION_KEY_UP=2322,ACTION_PAINT_ADD_PATH=2323,ACTION_PAINT_REMOVE_PATH=2324,CUT_OFF_AFTER_DISTANCE=100,CUT_OFF_PATHS_AFTER=!1,CUT_OFF_PATHS_BEFORE=!1,CUT_OFF_BEFORE_DISTANCE=100,MSG_DIVIDER="########",MSG_CONN_RECONNECT="Spojenie zo serverom bolo uspešne znovunadviazané",MSG_CONN_CONFIRM="jupíííí spojenie bolo úspešné",MSG_CONN_FAILED="Nepodarilo sa nadviazať spojenie zo serverom",MSG_CONN_ERROR="Spojenie zo serverom bolo prerušené",MSG_CONN_DISCONNECT="Spojenie zo serverom bolo úspešne ukončené",MSG_USER_CONNECT="používatel "+MSG_DIVIDER+"["+MSG_DIVIDER+"] sa pripojil",MSG_ANNONYM_FAILED="Nepodarilo sa odoslať anonymné dáta o prehliadači",MSG_MISS_LESS_ID="Nieje zadané 'less_id'",MSG_UNKNOW_ACTION="neznáma akcia: "+MSG_DIVIDER,MSG_RECIEVED_UNKNOWN_ACTION="bola prijatá neznáma akcia: "+MSG_DIVIDER,MSG_TRY_DRAW_EMPTY_POLYGON="chce sa vykresliť Polygon bez pointov",MSG_TRY_DRAW_EMPTY_LINE="chce sa vykresliť Line bez pointov",MSG_TRY_DRAW_ONE_POINT_LINE="chce sa vykresliť Line bez pointov",MSG_TRY_DRAW_WITHOUT_POSITION="chce sa vykresliť "+MSG_DIVIDER+" bez pozície",MSG_TRY_DRAW_WITHOUT_SIZE="chce sa vykresliť "+MSG_DIVIDER+" bez veľkosti",MSG_TRY_DRAW_WITH_NEG_POSITION="chce sa vykresliť "+MSG_DIVIDER+" zo zápornou velkosťou",MSG_RECREATE_LAYER="ide sa vytvoriť vrstva ktorá už existuje: "+MSG_DIVIDER,MSG_MAXIMUM_LAYER="bolo vytvorené maximálne množstvo vrstiev("+MSG_DIVIDER+")",Analyzer=function(){function a(b){_classCallCheck(this,a),this._url=b,this._browserData=this._analyzeWindow(this._analyzeBrowser())}return _createClass(a,[{key:"sendData",value:function(){this._sendAnonymousData(this._browserData)}},{key:"_sendAnonymousData",value:function(){var a=this,b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},c=function(b){return $.post(a._url,{content:JSON.stringify(b)}).fail(function(){Logger.error(getMessage(MSG_ANNONYM_FAILED))})};return navigator.geolocation?void navigator.geolocation.watchPosition(function(a){navigator.geolocation.getCurrentPosition(function(a){b.accuracy=a.coords&&a.coords.accuracy||"unknown",b.position={lat:a.coords.latitude,lon:a.coords.longitude},c(b)})},function(a){a.code==a.PERMISSION_DENIED&&c(b)}):void c(b)}},{key:"_analyzeWindow",value:function(a){return a.userAgent=navigator.userAgent,a.language=navigator.language,a.platform=navigator.platform,a.vendor=navigator.vendor,a.innerHeight=window.innerHeight,a.innerWidth=window.innerWidth,a.availHeight=screen.availHeight,a.availWidth=screen.availWidth,a.connectedAt=getFormattedDate(),a}},{key:"_analyzeBrowser",value:function(){var a=navigator.userAgent;return{browser:/Edge\/\d+/.test(a)?"ed":/MSIE 9/.test(a)?"ie9":/MSIE 10/.test(a)?"ie10":/MSIE 11/.test(a)?"ie11":/MSIE\s\d/.test(a)?"ie?":/rv\:11/.test(a)?"ie11":/Firefox\W\d/.test(a)?"ff":/Chrom(e|ium)\W\d|CriOS\W\d/.test(a)?"gc":/\bSafari\W\d/.test(a)?"sa":/\bOpera\W\d/.test(a)?"op":/\bOPR\W\d/i.test(a)?"op":"undefined"!=typeof MSPointerEvent?"ie?":"",os:/Windows NT 10/.test(a)?"win10":/Windows NT 6\.0/.test(a)?"winvista":/Windows NT 6\.1/.test(a)?"win7":/Windows NT 6\.\d/.test(a)?"win8":/Windows NT 5\.1/.test(a)?"winxp":/Windows NT [1-5]\./.test(a)?"winnt":/Mac/.test(a)?"mac":/Linux/.test(a)?"linux":/X11/.test(a)?"nix":"",mobile:/IEMobile|Windows Phone|Lumia/i.test(a)?"w":/iPhone|iP[oa]d/.test(a)?"i":/Android/.test(a)?"a":/BlackBerry|PlayBook|BB10/.test(a)?"b":/Mobile Safari/.test(a)?"s":/webOS|Mobile|Tablet|Opera Mini|\bCrMo\/|Opera Mobi/i.test(a)?1:0,tablet:/Tablet|iPad/i.test(a),touch:"ontouchstart"in document.documentElement}}},{key:"browserData",get:function(){return this._browserData}},{key:"isMobile",get:function(){return 0!==this._browserData.mobile}}]),a}(),objectCreator=function(){function a(){_classCallCheck(this,a),this._object=!1,this._fillColor=DEFAULT_FILL_COLOR,this._borderColor=DEFAULT_BORDER_COLOR,this._borderWidth=DEFAULT_STROKE_WIDTH,this._operation=OPERATION_DRAW_PATH,this._lineWidth=DEFAULT_STROKE_WIDTH,this._fontSize=DEFAULT_FONT_SIZE,this._fontColor=DEFAULT_FONT_COLOR,this._lineType=DEFAULT_LINE_TYPE,this._lineStyle=DEFAULT_LINE_STYLE,this._brushSize=DEFAULT_BRUSH_SIZE,this._brushType=DEFAULT_BRUSH_TYPE,this._brushColor=DEFAULT_BRUSH_COLOR,this._radius=DEFAULT_RADIUS,this._items=null,this._controllPress=!1,this._allLayers=!1,this._view=null,this._lastOperation=this._operation,this._visibleView=!0,this._allowedItems=["_fillColor","_borderColor","_borderWidth","_operation","_lineWidth","_fontSize","_fontColor","_lineType","_lineStyle","_brushSize","_brushType","_brushColor","_radius"],Logger&&Logger.log("Bol vytvorený objekt "+this.constructor.name,LOGGER_COMPONENT_CREATE)}return _createClass(a,[{key:"onMouseMove",value:function(a,b,c){updateSelectedObjectView(this._object),isFunction(this._object.updateCreatingPosition)&&this._object.updateCreatingPosition(a)}},{key:"init",value:function(){var a=arguments.length>0&&void 0!==arguments[0]&&arguments[0];null===this._items&&a!==!1&&(this._items=a),null!==this._view&&this._view.init()}},{key:"createObject",value:function(a){
var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;switch(this._operation){case OPERATION_DRAW_RECT:this._object=new Rect(a,new GVector2f,this._fillColor);break;case OPERATION_DRAW_ARC:this._object=new Arc(a,new GVector2f,this._fillColor);break;case OPERATION_DRAW_LINE:this._object=new Line([a,a.getClone()],this._lineWidth,this._fillColor,b);break;case OPERATION_DRAW_JOIN:this._object=new Join(a);break;case OPERATION_DRAW_IMAGE:this._object=new ImageObject(a,new GVector2f)}selectedObjects.clearAndAdd(this._object)}},{key:"finishCreating",value:function(){var a=this;this._object.name===OBJECT_IMAGE?loadImage(function(b){a._object.image=b,Scene.addToScene(a._object),a._object=!1}):(Scene.addToScene(this._object),this._object=!1)}},{key:"toggleArea",value:function(){this._operation!==OPERATION_AREA?(this._operation!==OPERATION_RUBBER&&(this._lastOperation=this._operation),this.operation=OPERATION_AREA):this.operation=this._lastOperation}},{key:"toggleRubber",value:function(){this._operation!==OPERATION_RUBBER?(this._operation!==OPERATION_AREA&&(this._lastOperation=this._operation),this.operation=OPERATION_RUBBER):this.operation=this._lastOperation}},{key:"fromObject",value:function(a){each(a,function(a,b){isIn(b,this._allowedItems)&&this.setOpt(b,a)},this)}},{key:"toObject",value:function(){var a={};return each(this,function(b,c){return a[c]=b}),a}},{key:"draw",value:function(){this._object&&this._object.draw(),null!==this._view&&null!==this._items&&this._visibleView&&this._view.draw()}},{key:"create",value:function(a){var b=Entity.create(a,!1);return b&&(Scene.addToScene(b,b.layer,!1),draw()),b}},{key:"setOpt",value:function(a,b){var c=this;if(isObject(a))return void each(a,function(a,b){return c.setOpt(b,a)});if("_"!=a[0]&&(a="_"+a),this[a]==b)return!1;var d=isIn(a,"_brushColor","_brushSize","_brushType")&&this[a]!=b;this[a]=b,"_brushType"===a&&("line"!==b?(Paints.selectedImage=b,Paints.action=PAINT_ACTION_BRUSH):Paints.action=PAINT_ACTION_LINE),Events.creatorChange(a,b),d&&Paints.rePaintImage(this.brushSize,this.brushColor),isDefined(this._view)&&(isIn(a,"_fillColor","_borderColor","_fontColor","_color","_brushColor")?this._view.init():isIn(a,"_brushSize","_brushType")&&this._view.init())}},{key:"clickIn",value:function(a,b){var c=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return!(!isDefined(this._view)||!this._visibleView)&&this._view.clickIn(a,b,c)}},{key:"view",get:function(){return this._view},set:function(a){this._view=a,null!==this._items&&this.init()}},{key:"controllPress",get:function(){return this._controllPress}},{key:"allLAyers",get:function(){return this._allLayers}},{key:"visibleView",set:function(a){this._visibleView=a}},{key:"items",get:function(){return this._items}},{key:"object",get:function(){return this._object},set:function(a){this._object=a}},{key:"radius",get:function(){return this._radius}},{key:"color",get:function(){return this._fillColor}},{key:"lineType",get:function(){return this._lineType}},{key:"fontSize",get:function(){return this._fontSize}},{key:"fillColor",get:function(){return this._fillColor}},{key:"fontColor",get:function(){return this._fontColor}},{key:"operation",get:function(){return this._operation},set:function(a){this._operation=a,this._view.changeOperation()}},{key:"lineWidth",get:function(){return this._lineWidth}},{key:"lineStyle",get:function(){return this._lineStyle}},{key:"brushSize",get:function(){return this._brushSize}},{key:"brushType",get:function(){return this._brushType}},{key:"brushColor",get:function(){return this._brushColor}},{key:"borderColor",get:function(){return this._borderColor}},{key:"borderWidth",get:function(){return this._borderWidth}}]),a}(),showPanel=function(a){G("#"+a).show(),G("#modalWindow").show(),G("canvas").addClass("blur")},showOptions=function(){return showPanel("optionsForm")},showColors=function(){return showPanel("colorPalete")},showWatcherOptions=function(){return showPanel("watchForm")},showSharingOptions=function(){return showPanel("shareForm")},showXmlSavingOptions=function(){G("#idProjectTitle").val(Project.title),showPanel("saveXmlForm")},processValues=function(a,b){for(var c=arguments.length,d=Array(c>2?c-2:0),e=2;e<c;e++)d[e-2]=arguments[e];var f=function(b){b&&(a[b.name]="checkbox"==b.type?b.checked:b.value)};return f(G.byId(b)),each(d,function(a){return f(G.byId(a))}),a},GuiManager=function(){function a(){_classCallCheck(this,a),this._topMenu=new MenuManager,this._actContextMenu=null}return _createClass(a,[{key:"showOptionsByComponents",value:function(){var a=function(a,b){var c=G.byId(a);c&&(c.parentElement.style.display=b?"block":"none")};a("idAllowedSnapping",Components.edit()),a("idShadows",Components.edit()),a("idShowLayersViewer",Components.layers()),a("idMovingSilhouette",Components.edit())}},{key:"menu",get:function(){return this._topMenu}},{key:"contextMenu",get:function(){return this._actContextMenu}}]),a}(),setAttr=function(a,b,c){if("string"==typeof b)a.setAttribute(b,c);else if("object"===("undefined"==typeof b?"undefined":_typeof(b)))for(var d in b)b.hasOwnProperty(d)&&a.setAttribute(d,b[d]);return a},append=function(a,b){return"object"===("undefined"==typeof b?"undefined":_typeof(b))&&a.appendChild(b),a},createEl=function(a,b,c){return append(setAttr(document.createElement(a),b),c)},createText=function(a){return document.createTextNode(a)},createIcon=function(a){return createEl("i",{class:"material-icons"},createText(a))},PanelManager=function(){function a(){_classCallCheck(this,a),this._running=!1,this._panel=createEl("div",{class:"guiPanel minimalized showChat",style:"display: none;"}),this._bodyPanel=createEl("div",{class:"panelBody"}),this._headerPanel=createEl("div",{class:"panelHeader noselect"}),append(this._panel,this._headerPanel),append(this._panel,this._bodyPanel),append(document.body,this._panel)}return _createClass(a,[{key:"_update",value:function(){this._durationSpan.innerText=toHHMMSS(Date.now()-this._startTime)}},{key:"_startRun",value:function(){var a=this;this._startTime=Date.now(),this._running=!0,this._interval=setInterval(function(){return a._update()},1e3)}},{key:"_stopRun",value:function(){clearInterval(this._interval),this._running=!1}},{key:"stopShare",value:function(){this._stopRun()}},{key:"startTask",value:function(){this._type="Task",this._startRun()}},{key:"startShare",value:function(a){this._type="Share",append(this._headerPanel,this._initTitle()),append(this._headerPanel,createEl("div",{class:"headerButton minimalize"},createIcon("stop"))),this._initChatPanel(),this._initWatcherPanel(),this._panel.style.display="block",this._sendMessage=a,this._startRun()}},{key:"startWatch",value:function(a){this._type="Watch",append(this._headerPanel,this._initTitle()),this._initChatPanel(),this._panel.style.display="block",this._sendMessage=a,this._startRun()}},{key:"_initChatPanel",value:function(){var a=this;this._isShifDown=!1;var b=createEl("div",{class:"headerButton minimalize",id:"toggleChat"},createIcon("message"));b.onclick=function(b){a._panel.classList.contains("showChat")?a._panel.classList.toggle("minimalized"):a._panel.classList.add("showChat"),a._panel.classList.contains("showWatchers")&&(a._panel.classList.remove("showWatchers"),a._panel.classList.remove("minimalized"))},append(this._headerPanel,b),this._chatHistory=createEl("div",{id:"chatHistory"}),this._chatWrapper=createEl("div",{id:"chatHistoryWrapper"},this._chatHistory),this._msgInput=createEl("div",{id:"chatInput",contenteditable:!0}),this._chatPanel=createEl("div",{class:"panelContent",id:"panelChat"},this._chatWrapper),append(this._chatPanel,this._msgInput),append(this._bodyPanel,this._chatPanel),this._msgInput.onkeydown=function(b){if(b.keyCode===SHIFT_KEY&&(a._isShifDown=!0),b.target.onkeyup=function(b){b.keyCode===SHIFT_KEY&&(a._isShifDown=!1),a._updateData()},b.keyCode==ENTER_KEY&&!a._isShifDown)return a._prepareMessage(),!1}}},{key:"recieveMessage",value:function(a,b){var c;Project.autor!=b?(c='<div class="messageC">',c+='<div class ="senderName">'+getFormattedDate()+" - ",c+=b+":</div>"):c='<div class="messageC myMessage">',c+='<div class="messageText">'+a+"</div></div>",this._chatHistory.innerHTML+=c,this._updateData(!1)}},{key:"_updateData",value:function(){var a=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];a&&(this._chatWrapper.style.height=this._bodyPanel.offsetHeight-this._msgInput.offsetHeight+"px"),b&&(this._chatWrapper.scrollTop=this._chatWrapper.scrollHeight-this._chatWrapper.clientHeight)}},{key:"_prepareMessage",value:function(){this._msgInput.innerHTML&&this._sendMessage(this._msgInput.innerHTML),this._msgInput.innerHTML=""}},{key:"addWatcher",value:function(a){this._watchers.push({name:a});var b=createEl("div",{class:"watcherProfil"},createText(a));append(this._watchersWrapper,createEl("div",{class:"panelLine"},b)),this._actualConnected.innerText=this._watchers.length}},{key:"_initWatcherPanel",value:function(){var a=this;this._watchers=[];var b=createEl("div",{class:"headerButton minimalize",id:"toggleWrappers"});append(b,createText(" ")),this._actualConnected=createEl("span",{id:"connected"},createText(this._watchers.length)),append(b,this._actualConnected),append(b,createText("/")),append(b,createEl("span",{id:"maxConnected"},createText(Sharer.maxWatchers))),append(b,createText(" ")),b.onclick=function(b){a._panel.classList.contains("showWatchers")?a._panel.classList.toggle("minimalized"):a._panel.classList.add("showWatchers"),a._panel.classList.contains("showChat")&&(a._panel.classList.remove("showChat"),a._panel.classList.remove("minimalized"))},append(this._headerPanel,b);this._watchersWrapper=createEl("div",{class:"panelContent",id:"panelWatchers"});for(var c in this._watchers)this._watchers.hasOwnProperty(c)&&this.addWatcher(this._watchers[c].name);append(this._bodyPanel,this._watchersWrapper)}},{key:"_initTitle",value:function(){return this._headerTitle=createEl("div",{id:"chatHeader"}),append(this._headerTitle,createEl("span",{id:"title"},createText(Project.title))),append(this._headerTitle,createText("   ")),isIn(this._type,"Share","Task"),this._durationSpan=createEl("span",{id:"duration"},createText("00:00:00")),append(this._headerTitle,this._durationSpan),this._headerTitle}}]),a}(),GVector2fCounter=0,GVector2fCounterClone=0,GVector2f=function(){function a(){_classCallCheck(this,a),GVector2fCounter++,0==arguments.length?(this._x=0,this._y=0):1==arguments.length?isNaN(arguments[0])?(this._x=arguments[0].x,this._y=arguments[0].y):this._x=this._y=arguments[0]:2==arguments.length&&(this._x=arguments[0],this._y=arguments[1])}return _createClass(a,[{key:"getClone",value:function(){return GVector2fCounterClone++,new a(this._x,this._y)}},{key:"toArray",value:function(){return[this._x,this._y]}},{key:"equal",value:function(a){return a._x==this._x&&a._y==this._y}},{key:"getLength",value:function(){return Math.sqrt(this._x*this._x+this._y*this._y)}},{key:"normalize",value:function(){return this.div(this.getLength())}},{key:"_process",value:function(){return 1==arguments[0].length?isNaN(arguments[0][0])?(this._x=arguments[1](this._x,arguments[0][0].x),this._y=arguments[1](this._y,arguments[0][0].y)):(this._x=arguments[1](this._x,arguments[0][0]),this._y=arguments[1](this._y,arguments[0][0])):2==arguments[0].length&&(this._x=arguments[1](this._x,arguments[0][0]),this._y=arguments[1](this._y,arguments[0][1])),this}},{key:"round",value:function(){return this._x=Math.round(this._x),this._y=Math.round(this._y),this}},{key:"br",value:function(){return this._process(arguments,function(a,b){return a>>b})}},{key:"bl",value:function(){return this._process(arguments,function(a,b){return a<<b})}},{key:"add",value:function(){return this._process(arguments,function(a,b){return a+b})}},{key:"div",value:function(){return this._process(arguments,function(a,b){return a/b})}},{key:"sub",value:function(){return this._process(arguments,function(a,b){return a-b})}},{key:"mul",value:function(){return this._process(arguments,function(a,b){return a*b})}},{key:"set",value:function(){return this._process(arguments,function(a,b){return b})}},{key:"length",value:function(){return Math.sqrt(this._x*this._x+this._y*this._y)}},{key:"dist",value:function(){return 1==arguments.length?Math.sqrt(Math.pow(this._x-arguments[0].x,2)+Math.pow(this._y-arguments[0].y,2)):2==arguments.length?Math.sqrt(Math.pow(this._x-arguments[0],2)+Math.pow(this._y-arguments[1],2)):void 0}},{key:"x",get:function(){return this._x},set:function(a){this._x=a}},{key:"y",get:function(){return this._y},set:function(a){this._y=a}}],[{key:"angle",value:function(a,b){var c=a.length(),d=b.length(),e=a.x/c*(b.x/d)+a.y/c*(b.y/d);return Math.acos(e)*(180/Math.PI)}}]),a}(),Animation=function(){function a(){_classCallCheck(this,a)}return _createClass(a,null,[{key:"init",value:function(b){a._running=!1,a._loop=b,a._counter=0}},{key:"_mainLoop",value:function(b){a._loop(b),a._running&&requestAnimationFrame(a._mainLoop)}},{key:"stop",value:function(){a._running=!1}},{key:"start",value:function(){a._running=!0;var b=function(b){a._mainLoop(b)};requestAnimationFrame(b)}}]),a}(),isUndefined=function(a){return("undefined"==typeof a?"undefined":_typeof(a))===KEYWORD_UNDEFINED},isDefined=function(a){return("undefined"==typeof a?"undefined":_typeof(a))!==KEYWORD_UNDEFINED},isFunction=function(a){return("undefined"==typeof a?"undefined":_typeof(a))===KEYWORD_FUNCTION},isNumber=function(a){return("undefined"==typeof a?"undefined":_typeof(a))===KEYWORD_NUMBER},isString=function(a){return("undefined"==typeof a?"undefined":_typeof(a))===KEYWORD_STRING},isObject=function(a){return("undefined"==typeof a?"undefined":_typeof(a))===KEYWORD_OBJECT},isBoolean=function(a){return("undefined"==typeof a?"undefined":_typeof(a))===KEYWORD_BOOLEAN},isArray=function(a){return Array.isArray(a)},isNull=function(a){return null===a},isEmptyObject=function(a){return a&&0===Object.keys(a).length&&a.constructor===Object},isEmptyArray=function(a){return isArray(a)&&0===a.length},getLength=function(a){var b=0;return each(a,function(a){return b++}),b},isSharing=function(){return"undefined"!=typeof Sharer&&Sharer.isSharing},isInt=function(a){return Number(a)===a&&a%1===0},isFloat=function(a){return Number(a)===a&&a%1!==0},callIfFunc=function(a){return!!isFunction(a)&&a()},angleBetween=function(a,b){return Math.atan2(b.y,b.x)-Math.atan2(a.y,a.x)},getClassOf=Function.prototype.call.bind(Object.prototype.toString),nvl=function(a,b){return a?a:b},getLastElement=function(a){return!(!isArray(a)||!a.length)&&a[a.length-1]},round=function(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:DEFAULT_ROUND_VAL;return 1===b?a:Math.floor(a/b)*b},Movement={move:function(a,b,c){var d=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(!isDefined(a.locked)||!a.locked){if(isDefined(a.selectedConnector)&&Creator.operation==OPERATION_DRAW_JOIN&&a.selectedConnector);else if(a.name===OBJECT_AREA)a.move(b,c);else if(isDefined(a.moveType))if(Creator.operation==OPERATION_DRAW_LINE&&Menu.isToolActive());else{a.position.getClone(),a.size.getClone();switch(a.moveType){case 0:a.position.y+=c,a.size.y-=c;break;case 1:a.size.x+=b;break;case 2:a.size.y+=c;break;case 3:a.position.x+=b,a.size.x-=b;break;case 4:a.position.add(b,c),d&&a.eachChildren(function(a){a.moveType=4,Movement.move(a,b,c,!1),a.moveType=-1});break;case 5:(!a.minSize||a.size.x+b>=a.minSize.x)&&(a.size.x+=b),(!a.minSize||a.size.y+c>=a.minSize.y)&&(a.size.y+=c)}}else if(isDefined(a.movingPoint)){var e=0;a.movingPoint<0?a.points.forEach(function(a){return a.add(b,c)}):isInt(a.movingPoint)?(0==a.movingPoint?a.targetA="":a.movingPoint==a.points.length-1&&(a.targetB=""),a.points[a.movingPoint].add(b,c)):(e=parseInt(a.movingPoint)+1,a.points.splice(e,0,a.points[e-1].getClone().add(a.points[e%a.points.length]).br(1)),a.movingPoint=e),Entity.findMinAndMax(a.points,a.position,a.size)}else a.position.add(b,c),d&&a.eachChildren(function(a){return a.position.add(b,c)});Events.objectMove(a)}}},EventTimer=function(){function a(b,c){_classCallCheck(this,a),this._event=b,this._time=c,this._timeOut=!1,this._lastTime=Date.now()}return _createClass(a,[{key:"_callEvent",value:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this;a._event(),a._timeOut&&(clearTimeout(a._timeOut),a._timeOut=!1),a._lastTime=Date.now()}},{key:"_setTimeOut",value:function(a){var b=this;this._timeOut||(this._timeOut=setTimeout(function(){return b._callEvent(b)},this._time-a))}},{key:"callIfCan",value:function(){var a=Date.now()-this._lastTime;a>this._time?this._callEvent():this._setTimeOut(a)}}]),a}();Array.prototype.forEach||(Array.prototype.forEach=function(a,b){var c,d;if(null===this)throw new TypeError(" this is null or not defined");var e=Object(this),f=e.length>>>0;if("function"!=typeof a)throw new TypeError(a+" is not a function");for(arguments.length>1&&(c=b),d=0;d<f;){var g;d in e&&(g=e[d],a.call(c,g,d,e)),d++}}),Array.prototype.indexOf||(Array.prototype.indexOf=function(a,b){var c;if(null==this)throw new TypeError('"this" is null or not defined');var d=Object(this),e=d.length>>>0;if(0===e)return-1;var f=+b||0;if(Math.abs(f)===1/0&&(f=0),f>=e)return-1;for(c=Math.max(f>=0?f:e-Math.abs(f),0);c<e;){if(c in d&&d[c]===a)return c;c++}return-1}),Date.now||(Date.now=function(){return(new Date).getTime()}),Function.prototype.bind||(Function.prototype.bind=function(a){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var b=Array.prototype.slice.call(arguments,1),c=this,d=function(){},e=function(){return c.apply(this instanceof d?this:a,b.concat(Array.prototype.slice.call(arguments)))};return this.prototype&&(d.prototype=this.prototype),e.prototype=new d,e}),Object.keys||(Object.keys=function(){var a=Object.prototype.hasOwnProperty,b=!{toString:null}.propertyIsEnumerable("toString"),c=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],d=c.length;return function(e){if("object"!==("undefined"==typeof e?"undefined":_typeof(e))&&("function"!=typeof e||null===e))throw new TypeError("Object.keys called on non-object");var f,g,h=[];for(f in e)a.call(e,f)&&h.push(f);if(b)for(g=0;g<d;g++)a.call(e,c[g])&&h.push(c[g]);return h}}()),Array.isArray||(Array.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)});var MenuManager=function(){function a(){var b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new GVector2f,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new GVector2f(MENU_WIDTH,MENU_HEIGHT),d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"mainMenu",e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;_classCallCheck(this,a),null!=e&&(this._items=e._allItems[d]),this._key=d,this._parent=e,this._toolActive=!1,this._fontColor=MENU_FONT_COLOR,this._backgroundColor=MENU_BACKGROUND_COLOR,this._disabledBackgroundColor=MENU_DISABLED_BG_COLOR,this._position=b.add(MENU_OFFSET),this._offset=MENU_OFFSET,this._size=c,this._vertical=null!=e,this._visibleElements=0,this._canvas=null==e?document.createElement("canvas"):e._canvas,this._context=null,this._tmpDrawArray=[],this._visible=!0,this._visibleSubMenu=!1,this._subMenus={},Logger&&Logger.log("Bol vytvorený objekt "+this.constructor.name,LOGGER_COMPONENT_CREATE)}return _createClass(a,[{key:"hover",value:function(a,b){if(!this._visible)return!1;var c=this._position.y,d=this._position.x,e=!1;return this._visibleSubMenu&&(e=this._subMenus[this._visibleSubMenu].hover(a,b)),e||each(this._items,function(f){return!(!f.visible||e)&&(a>d&&a<d+this._size.x&&b>c&&b<c+this._size.y&&(e=f),void(this._vertical?c+=this._size.y+this._offset:d+=this._size.x+this._offset))},this),setCursor(e?e.disabled?CURSOR_NOT_ALLOWED:CURSOR_POINTER:CURSOR_DEFAULT),e!==!1}},{key:"init",value:function(b){var c=this;a.dataBackup||(a.dataBackup=JSON.stringify(b)),b=a._changeDataByComponents(b);var d,e=[],f=new GVector2f,g=this._size.x+MENU_OFFSET,h=this._size.y+MENU_OFFSET,i=0,j={};this._visibleElements=0,each(b,function(a,c){e[c]=[],each(b[c],function(a,b){return isDefined(a.values)?void each(a.values,function(g){d={},d.visible=a.visible,d.disabled=a.disabled,d.key=b.replace("XYZ ",""),d.posX=f.x,d.posY=f.y,f.x++,d.value=g,this._tmpDrawArray.push({x:f.x,y:f.y,value:g,key:b}),e[c].push(d)},this):(a.key=b,"mainMenu"===c&&a.visible&&this._visibleElements++,a.posX=f.x,a.posY=f.y,this._tmpDrawArray.push({x:f.x,y:f.y,key:b}),f.x++,void e[c].push(a))},this),isIn(c,"tools","file","content","sharing")&&(j[c]=i),"mainMenu"!==c&&b.mainMenu[c].visible&&i++},this),this._canvas.width=this._tmpDrawArray[this._tmpDrawArray.length-1].x*this._size.x+this._size.x,this._canvas.height=this._tmpDrawArray[this._tmpDrawArray.length-1].y*this._size.y+this._size.y,this._context=this._canvas.getContext("2d"),this._redraw(),this._items=e.mainMenu,this._allItems=e,each(j,function(b,d){c._subMenus[d]=new a(new GVector2f(b*g,h),new GVector2f(c._size.x,c._size.y),d,c)},this),Creator.view&&(this._visible?Creator.view.position.x=this.position.x+(this.size.x+MENU_OFFSET)*this.visibleElements-MENU_OFFSET:Creator.view.position.x=MENU_OFFSET),draw()}},{key:"isToolActive",value:function(){var a=this._toolActive;return this._toolActive=!1,a}},{key:"clickIn",value:function(a,b){if(!this._visible)return!1;var c=this._position.y,d=this._position.x,e=!1;return this._visibleSubMenu&&(e=this._subMenus[this._visibleSubMenu].clickIn(a,b)),this._visibleSubMenu=!1,e?e:(each(this._items,function(f){return!(!f.visible||e)&&(a>d&&a<d+this._size.x&&b>c&&b<c+this._size.y&&(e=f,this._doClickAct(f)),void(this._vertical?c+=this._size.y+this._offset:d+=this._size.x+this._offset))},this),e?e:void 0)}},{key:"disabled",value:function(a,b,c){var d=function(a,d,e){a.key===b&&(e[d].disabled=("undefined"==typeof c?"undefined":_typeof(c))===KEYWORD_UNDEFINED?!a.disabled:c)};this._key==a?each(this._items,d):isDefined(this._subMenus[a])&&each(this._subMenus[a]._items,d)}},{key:"_doClickAct",value:function(a){var b=a.key;if(a.disabled)return void Logger.log("Klikol v menu na disablovanu položku "+b,LOGGER_MENU_CLICK);if(Logger.log("Klikol v menu na položku "+b,LOGGER_MENU_CLICK),isIn(b,"file","content","sharing"))return void(this._visibleSubMenu=b);switch(b){case"tools":this._toolActive="tools";break;case"color":pickUpColor(function(a){return Creator.setOpt(ATTRIBUTE_FILL_COLOR,a)});break;case"options":showOptions();break;case"draw":Creator.operation=OPERATION_DRAW_PATH;break;case"area":Creator.toggleArea();break;case"rect":Creator.operation=OPERATION_DRAW_RECT;break;case"image":Creator.operation=OPERATION_DRAW_IMAGE;break;case"line":Creator.operation=OPERATION_DRAW_LINE;break;case"startShare":showSharingOptions();break;case"loadLocalImage":Content.setContentImage();break;case"loadLocalHTML":Content.setContentHTML();break;case"undo":Paints.undo();break;case"copyUrl":Sharer.copyUrl();break;case"redo":Paints.redo();break;case"saveImg":showSavingOptions();break;case"watch":showWatcherOptions();break;case"saveTask":saveSceneAsTask();break;case"stopShare":Sharer.stopShare();break;case"saveXML":showXmlSavingOptions();break;case"loadXML":loadSceneFromFile();break;case"rubber":Creator.toggleRubber();break;case"arc":Creator.operation=OPERATION_DRAW_ARC;break;case"defaultBrushes":Paints.setImage(a.value);break;case"defaultWidth":Creator.setOpt(ATTRIBUTE_LINE_WIDTH,a.value),this._parent._redraw();break;case"join":Creator.operation=OPERATION_DRAW_JOIN;break;case"lineWidth":this._visibleSubMenu=b}}},{key:"_doPressAct",value:function(a,b){if(!a)return!1;switch(a){case"tools":this._visibleSubMenu=a;break;case"file":actContextMenu=new ContextMenuManager(b,[],!1,"file")}return a}},{key:"pressIn",value:function(a,b){if(!this._visible)return!1;var c=this._position.y,d=this._position.x,e=!1;return this._visibleSubMenu&&(e=this._subMenus[this._visibleSubMenu].clickIn(a,b)),e?e:(each(this._items,function(f){return!(!f.visible||e)&&(a>d&&a<d+this._size.x&&b>c&&b<c+this._size.y&&(e=f,this._doPressAct(f.key,new GVector2f(a,b))),void(this._vertical?c+=this._size.y+this._offset:d+=this._size.x+this._offset))},this),e?e:void 0)}},{key:"draw",value:function(){if(this._items&&this._visible){var a=this._position.y,b=this._position.x;context.lineWidth=MENU_BORDER_WIDTH,context.strokeStyle=MENU_BORDER_COLOR,context.fillStyle=this._backgroundColor,each(this._items,function(c){if(c.visible){var d=c.disabled?this._disabledBackgroundColor:this._backgroundColor;"color"==c.key&&(d=Creator.color);var e="rubber"===c.key&&Creator.operation===OPERATION_RUBBER||"area"===c.key&&Creator.operation===OPERATION_AREA||c.key===this._visibleSubMenu;doRect({position:[b,a],size:this._size,radius:MENU_RADIUS,fillColor:d,borderWidth:MENU_BORDER_WIDTH,borderColor:MENU_BORDER_COLOR,shadow:e}),context.drawImage(this._canvas,c.posX*this._size.x,c.posY*this._size.y,this._size.x,this._size.y,b,a,this._size.x,this._size.y),this._vertical?a+=this._size.y+this._offset:b+=this._size.x+this._offset}},this),this._visibleSubMenu&&this._subMenus[this._visibleSubMenu].draw()}}},{key:"_redraw",value:function(){this._context.clearRect(0,0,this._canvas.width,this._canvas.height),each(this._tmpDrawArray,function(a){this._drawIcon(a,a.x*this._size.x,a.y*this._size.y,5,this._size.x,this._size.y,this._fontColor)},this),Logger.log("prekresluje sa "+this.constructor.name,LOGGER_DRAW)}},{key:"_drawIcon",value:function(a,b,c){var d,e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,f=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this._size.x,g=arguments.length>5&&void 0!==arguments[5]?arguments[5]:this._size.y,h=arguments.length>6&&void 0!==arguments[6]?arguments[6]:DEFAUL_STROKE_COLOR,i=arguments.length>7&&void 0!==arguments[7]?arguments[7]:DEFAULT_STROKE_WIDTH;switch(a.key){case"arc":doArc({position:[b+e,c+e],size:[f-(e<<1),g-(e<<1)],borderColor:h,borderWidth:i,ctx:this._context});break;case"rect":doRect({position:[b+e,c+e],size:[f-(e<<1),g-(e<<1)],borderWidth:i,borderColor:h,ctx:this._context});break;case"line":doLine({points:[new GVector2f(b+e,c+e),new GVector2f(b+f-(e<<1),c+(g>>1)),new GVector2f(b+e,c+g-(e<<1)),new GVector2f(b+f-(e<<1),c+e)],borderWidth:i,borderColor:h,ctx:this._context});break;case"text":fillText("TEXT",b+(f>>1),c+(g>>1),g>>2,h,0,FONT_ALIGN_CENTER,this._context);break;case"ctrl":fillText("CTRL",b+(f>>1),c+(g>>1),g>>2,h,0,FONT_ALIGN_CENTER,this._context);break;case"file":fillText("FILE",b+(f>>1),c+(g>>1),g>>2,h,0,FONT_ALIGN_CENTER,this._context);break;case"content":fillText("CONT",b+(f>>1),c+(g>>1),g>>2,h,0,FONT_ALIGN_CENTER,this._context);break;case"undo":fillText("UNDO",b+(f>>1),c+(g>>1),g>>2,h,0,FONT_ALIGN_CENTER,this._context);break;case"redo":fillText("REDO",b+(f>>1),c+(g>>1),g>>2,h,0,FONT_ALIGN_CENTER,this._context);break;case"watch":fillText("JOIN",b+(f>>1),c+(g>>1),g>>2,h,0,FONT_ALIGN_CENTER,this._context);break;case"copyUrl":fillText("LINK",b+(f>>1),c+(g>>1),g>>2,h,0,FONT_ALIGN_CENTER,this._context);break;case"shareOptions":fillText("OPT",b+(f>>1),c+(g>>1),g>>2,h,0,FONT_ALIGN_CENTER,this._context);break;case"rubber":fillText("RUBB",b+(f>>1),c+(g>>1),g/5,h,0,FONT_ALIGN_CENTER,this._context);break;case"area":fillText("AREA",b+(f>>1),c+(g>>1),g/5,h,0,FONT_ALIGN_CENTER,this._context);break;case"stopShare":fillText("STOP",b+(f>>1),c+(g>>1),g>>2,h,0,FONT_ALIGN_CENTER,this._context);break;case"startShare":fillText("START",b+(f>>1),c+(g>>1),g>>2,h,0,FONT_ALIGN_CENTER,this._context);break;case"sharing":fillText("CONN",b+(f>>1),c+(g>>1),g>>2,h,0,FONT_ALIGN_CENTER,this._context);break;case"loadLocalImage":fillText("locImg",b+(f>>1),c+(g>>1),g/6,h,0,FONT_ALIGN_CENTER,this._context);break;case"loadLocalHTML":fillText("locHTML",b+(f>>1),c+(g>>1),g/6,h,0,FONT_ALIGN_CENTER,this._context);break;case"loadExternalImage":fillText("extImg",b+(f>>1),c+(g>>1),g/6,h,0,FONT_ALIGN_CENTER,this._context);break;case"loadExternalHTML":fillText("extHTML",b+(f>>1),c+(g>>1),g/6,h,0,FONT_ALIGN_CENTER,this._context);break;case"saveImg":fillText("SAVE IMG",b+(f>>1),c+(g>>1),g>>3,h,0,FONT_ALIGN_CENTER,this._context);break;case"saveXML":fillText("SAVE XML",b+(f>>1),c+(g>>1),g>>3,h,0,FONT_ALIGN_CENTER,this._context);break;case"saveTask":fillText("SAVE TASK",b+(f>>1),c+(g>>1),g>>3,h,0,FONT_ALIGN_CENTER,this._context);break;case"loadXML":fillText("LOAD XML",b+(f>>1),c+(g>>1),g>>3,h,0,FONT_ALIGN_CENTER,this._context);break;case"options":fillText("OPT",b+(f>>1),c+(g>>1),g>>2,h,0,FONT_ALIGN_CENTER,this._context);break;case"table":for(var j=4,k=(g-(e<<1))/j,l=[[b+(f>>1),c+e,b+(f>>1),c-e+g]],m=1,n=k;m<j;m++,n+=k)l.push([b+e,c+e+n,b-e+f,c+e+n]);doRect({position:[b+e,c+e],size:[f-(e<<1),g-(e<<1)],borderWidth:i,borderColor:h,ctx:this._context}),doLine({points:l,borderWidth:i,borderColor:h,ctx:this._context});break;case"class":fillText("CLASS",b+(f>>1),c+(g>>1),g/5,h,0,FONT_ALIGN_CENTER,this._context);break;case"image":fillText("IMG",b+(f>>1),c+(g>>1),g>>2,h,0,FONT_ALIGN_CENTER,this._context);break;case"tools":fillText("TOOLS",b+(f>>1),c+(g>>1),g/5,h,0,FONT_ALIGN_CENTER,this._context);break;case"polygon":fillText("POLY",b+(f>>1),c+(g>>1),g>>2,h,0,FONT_ALIGN_CENTER,this._context);break;case"help":fillText("HELP",b+(f>>1),c+(g>>1),g>>2,h,0,FONT_ALIGN_CENTER,this._context);break;case"defaultWidth":doLine({points:[b+e,c+(g>>1),b+f-e,c+(g>>1)],borderWidth:a.value,borderColor:h,ctx:this._context});break;case"brushes":if(d=Paints.selectedImg,null==d)return;this._context.drawImage(d,0,0,d.width,d.height,b,c,f,g);break;case"lineWidth":doLine({points:[b+e,c+(g>>1),b+f-e,c+(g>>1)],borderWidth:Creator.lineWidth,borderColor:this._fontColor,ctx:this._context});break;case"defaultBrushes":Paints.addBrush(a.value),d=Paints.getBrush(a.value),this._context.drawImage(d,0,0,d.width,d.height,b,c,f,g);break;case"draw":drawQuadraticCurve([new GVector2f(b+e,c+e),[new GVector2f(b+e,c+g-(e<<1)),new GVector2f(b+f-(e<<1),c+(g>>1))],[new GVector2f(b+e,c+e),new GVector2f(b+e,c+g-(e<<1))],[new GVector2f(b+f-(e<<1),c+(g>>1)),new GVector2f(b+f-(e<<1),c+e)],[new GVector2f(b+e,c+g-(e<<1)),new GVector2f(b+e,c+e)]],i,h,this._context);break;case"join":fillText("JOIN",b+(f>>1),c+(g>>1),g>>2,h,0,FONT_ALIGN_CENTER,this._context)}}},{key:"position",get:function(){return this._position}},{key:"size",get:function(){return this._size}},{key:"visible",get:function(){return this._visible},set:function(a){this._visible=a,Creator.view&&(this._visible?Creator.view.position.x=this.position.x+(this.size.x+MENU_OFFSET)*this.visibleElements-MENU_OFFSET:Creator.view.position.x=MENU_OFFSET,draw())}},{key:"visibleElements",get:function(){return this._visibleElements}}],[{key:"_changeDataByComponents",value:function(a){return!Components.tools()&&Components.draw()&&(Creator.operation=OPERATION_DRAW_PATH),a.tools.draw.visible=a.tools.draw.visible&&Components.draw(),a.mainMenu.undo.visible=a.mainMenu.undo.visible&&Components.draw(),a.mainMenu.redo.visible=a.mainMenu.redo.visible&&Components.draw(),a.mainMenu.tools.visible=a.mainMenu.tools.visible&&Components.tools(),a.mainMenu.content.visible=a.mainMenu.content.visible&&Components.content(),a.mainMenu.sharing.visible=a.mainMenu.sharing.visible&&Components.share(),a.tools.image.visible=a.tools.image.visible&&Components.load(),Components.load()||Components.save()||Components.screen()||Components.task()?(a.file.loadXML.visible=a.file.loadXML.visible&&Components.load(),a.file.saveXML.visible=a.file.saveXML.visible&&Components.save(),a.file.saveImg.visible=a.file.saveImg.visible&&Components.screen(),a.file.saveTask.visible=a.file.saveTask.visible&&Components.task()):a.mainMenu.file.visible=a.mainMenu.file.visible&&!1,a}}]),a}(),Slider=function(){function a(b,c,d,e){_classCallCheck(this,a),this._position=b,this._size=c,this._buttonSize=Math.min(c.x,c.y)/4*3,this._buttonColor="#FA1D2F",this._sliderWidth=this._buttonSize>>2,this._sliderColor="#FFADB9",this._backgroundColor="#EEE0E5",this._value=d,this._onMove=e,c.x<c.y&&(this._sliderOffset=(c.x-this._buttonSize>>1)+(this._buttonSize>>1),
this._sliderA=new GVector2f(b.x+(c.x>>1),b.y+this._sliderOffset),this._sliderB=new GVector2f(b.x+(c.x>>1),b.y+c.y-this._sliderOffset))}return _createClass(a,[{key:"clickIn",value:function(a,b){if(a<this._position.x||a>this._position.x+this._size.x||b<this._position.y||b>this._position.y+this._size.y)return!1}},{key:"draw",value:function(){fillRect(this._position.x,this._position.y,this._size.x,this._size.y,this._backgroundColor),drawLine([this._sliderA,this._sliderB],this._sliderWidth,this._sliderColor);var a=this._sliderA.getClone().sub(this._sliderB).div(100).mul(this._value).add(this._sliderB);fillArc(a.x-(this._buttonSize>>1),a.y-(this._buttonSize>>1),this._buttonSize,this._buttonSize,this._buttonColor)}},{key:"value",set:function(a){this._value=a,draw(),this.draw()}}]),a}(),ChatViewer=function(){function a(b,c,d){_classCallCheck(this,a),this._myName=c,this._title=b,this._createHTML(),this._isShifDown=!1,this._textC=document.getElementById("textC"),this._histC=document.getElementById("histC"),this._chatW=document.getElementById("chatW"),this._histW=document.getElementById("hist"),this._sendMessage=d,this._init(document.getElementById("headC")),this.hide(),this.toggleChat()}return _createClass(a,[{key:"_createHTML",value:function(){var a='<div id="chatW"><div id="headC"><span id="chatTitle">';a+=this._title+'</span><div class="headerButton" id="hideChat">×</div>',a+='<div class="headerButton" id="toggleChat">-</div>',a+='<div class="headerButton" id="clearChat">C</div></div>',a+='<div id="histC"><div id="hist"></div></div>',a+='<div id="textC" contenteditable="true"></div></div>';var b=document.createElement("div");b.innerHTML=a,document.body.appendChild(b.firstChild)}},{key:"hide",value:function(){if(this._chatW.style.display="none","undefined"!=typeof Project&&Project.isMobile){var a=document.getElementsByClassName("canvas");for(var b in a)canvas.classList.remove("offset")}}},{key:"show",value:function(){if(this._chatW.style.display="block","undefined"!=typeof Project&&Project.isMobile){var a=document.getElementsByClassName("canvas");for(var b in a)canvas.classList.add("offset")}}},{key:"_init",value:function(a){var b=this;document.getElementById("chatTitle").innerHTML=this._title,document.getElementById("toggleChat").onclick=function(){return b.toggleChat()},document.getElementById("clearChat").onclick=function(){return b._histW.innerHTML=""},document.getElementById("hideChat").onclick=function(){return b.hide()},a.onmousedown=function(c){if(c.target!=a)return!1;var d=window.onmousemove;window.onmousemove=function(a){return b._check(a,c,b._chatW)},window.onmouseup=function(a){return window.onmousemove=d}},this._textC.onkeydown=function(a){if(a.keyCode===SHIFT_KEY&&(b._isShifDown=!0),a.target.onkeyup=function(a){a.keyCode===SHIFT_KEY&&(b._isShifDown=!1),b._updateData()},a.keyCode==ENTER_KEY&&!b._isShifDown)return b._prepareMessage(),!1}}},{key:"_updateData",value:function(){var a=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];a&&(this._histC.style.height=this._chatW.offsetHeight-this._textC.offsetHeight-30+"px"),b&&(this._histC.scrollTop=this._histC.scrollHeight-this._histC.clientHeight)}},{key:"_check",value:function(a,b,c){var d=function(a,b,c,d){return Math.max(Math.min(a-b,c-d),0)+"px"};c.style.top=d(a.clientY,b.offsetY,window.innerHeight,c.offsetHeight),c.style.left=d(a.clientX,b.offsetX,window.innerWidth,c.offsetWidth)}},{key:"toggleChat",value:function(){var a=this,b=function(b,c){a._chatW.style.height=b+"px",a._histC.style.display=c,a._textC.style.display=c};"28px"==this._chatW.style.height?b(404,"block"):b(28,"none")}},{key:"recieveMessage",value:function(a,b){var c;this._myName!=b?(c='<div class="messageC">',c+='<div class ="senderName">'+getFormattedDate()+" - ",c+=b+":</div>"):c='<div class="messageC myMessage">',c+='<div class="messageText">'+a+"</div></div>",this._histW.innerHTML+=c,this._updateData(!1)}},{key:"_prepareMessage",value:function(){var a=this._textC.innerHTML;this._sendMessage(a),this._textC.innerHTML=""}}]),a}(),ContextMenuManager=function(){function a(b){var c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],d=arguments.length>2&&void 0!==arguments[2]&&arguments[2],e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"undefined";_classCallCheck(this,a),this._position=b,this._subMenu=!1,this._parent=d,this._key=e,this._textColor=CONTEXT_MENU_FONT_COLOR,this._fillColor=CONTEXT_FILL_COLOR,this._selectedObject=d?d._selectedObject:selectedObjects.movedObject,this._titles=c,0==this._titles.length&&(selectedObjects.movedObject?(isIn(selectedObjects.movedObject.name,OBJECT_RECT,OBJECT_POLYGON,OBJECT_ARC,OBJECT_LINE,OBJECT_TABLE,OBJECT_IMAGE,OBJECT_TEXT)&&this._addFields("delete","locked","makeCopy","changeLayer","changeOpacity"),isIn(selectedObjects.movedObject.name,OBJECT_RECT,OBJECT_POLYGON,OBJECT_TEXT,OBJECT_ARC)&&this._addFields("changeFillColor","changeBorderColor"),isIn(selectedObjects.movedObject.name,OBJECT_RECT,OBJECT_POLYGON,OBJECT_TEXT,OBJECT_LINE)&&this._addFields("radius"),selectedObjects.movedObject.name==OBJECT_LINE?this._addFields("joinType","lineCap","lineStyle","lineType","lineWidth","arrowEndType","arrowStartType"):selectedObjects.movedObject.name==OBJECT_TABLE?this._addFields("editTable"):selectedObjects.movedObject.name==OBJECT_TEXT?this._addFields("verticalTextAlign","horizontalTextAlign","taskResult"):selectedObjects.movedObject.name==OBJECT_IMAGE?this._addFields("changeImage"):"LayerViewer"==selectedObjects.movedObject.name&&(this._addFields("visible","lockLayer","showPaint","animatePaint","clearPaint"),selectedObjects.movedObject.locked||this._addFields("deleteLayer","renameLayer","clearLayer"))):d||this._addFields("clearWorkspace")),context.font=30-CONTEXT_MENU_OFFSET+"pt "+DEFAULT_FONT;var f=!1;this._titles.length&&each(c,function(a,b,c){a.type==INPUT_TYPE_RADIO&&(f=!0,c[b].value=this._selectedObject["_"+this._key]==a.name),a.type==INPUT_TYPE_CHECKBOX&&(f=!0,"locked"==a.key?c[b].value=selectedObjects.movedObject.locked:"visible"==a.key?c[b].value=selectedObjects.movedObject.visible:"showPaint"==a.key?c[b].value=selectedObjects.movedObject.showPaint:"taskResult"==a.key&&(c[b].value=selectedObjects.movedObject.taskResult))},this),this._menuWidth=getMaxWidth(this._titles.map(function(a){return a.label}))+(CONTEXT_MENU_OFFSET<<1),f&&(this._menuWidth+=30),this._size=new GVector2f(this._menuWidth,this._titles.length*CONTEXT_MENU_LINE_HEIGHT),Logger.log("Bol vytvorený objekt "+this.constructor.name,LOGGER_COMPONENT_CREATE)}return _createClass(a,[{key:"_addFields",value:function(){var b,c=this;each(objectToArray(arguments),function(d){b=a.items[d],b&&b.visible&&(b.key=d,c._titles.push(b))},this)}},{key:"clickInBoundingBox",value:function(a,b){return a+SELECTOR_SIZE>this._position.x&&a-SELECTOR_SIZE<this._position.x+this._menuWidth&&b+SELECTOR_SIZE>this._position.y&&b-SELECTOR_SIZE<this._position.y+this._titles.length*CONTEXT_MENU_LINE_HEIGHT}},{key:"draw",value:function(){this._position.x+this._menuWidth>canvas.width&&(this._position.x=canvas.width-this._menuWidth),this._position.y+this._titles.length*CONTEXT_MENU_LINE_HEIGHT>canvas.height&&(this._position.y=canvas.height-this._titles.length*CONTEXT_MENU_LINE_HEIGHT);var a=0,b=this._position.x,c=this._position.y,d=this._menuWidth,e=c,f=20,g=CONTEXT_MENU_LINE_HEIGHT-f>>1;doRect({position:[b,c],width:this._menuWidth,height:Object.keys(this._titles).length*CONTEXT_MENU_LINE_HEIGHT,radius:MENU_RADIUS,borderColor:this._borderColor,borderWidth:this._borderWidth,fillColor:this._fillColor,shadow:!0,draw:!0}),each(this._titles,function(h){if(context.fillStyle=DEFAULT_FONT_COLOR,e=c+a*CONTEXT_MENU_LINE_HEIGHT,a++&&doLine({points:[b,e,b+d,e],draw:!0}),h.disabled||this._subMenu&&h.key==this._subMenu._key){var i=this._titles[0]===h?MENU_RADIUS:0,j=getLastElement(this._titles)===h?MENU_RADIUS:0;doRect({position:[b,e],width:this._menuWidth,height:CONTEXT_MENU_LINE_HEIGHT,radius:{tr:i,tl:i,br:j,bl:j},borderColor:this.borderColor,borderWidth:this.borderWidth,fillColor:h.disabled?CONTEXT_DISABLED_FILL_COLOR:CONTEXT_SELECTED_FILL_COLOR,draw:!0})}fillText(h.label,b,e,30-CONTEXT_MENU_OFFSET,this._textColor,[CONTEXT_MENU_OFFSET,0]),h.type==INPUT_TYPE_CHECKBOX?doRect({x:b+d-g-f,y:e+g,size:f,radius:5,borderColor:this.borderColor,borderWidth:this.borderWidth,fillColor:h.value?CHECKBOX_COLOR_TRUE:CHECKBOX_COLOR_FALSE,draw:!0}):h.type==INPUT_TYPE_RADIO?doArc({x:b+d-g-f,y:e+g,size:f,borderColor:DEFAULT_FONT_COLOR,fillColor:DEFAULT_FONT_COLOR,draw:!h.value,fill:h.value}):"widthValue"==h.type&&doLine({points:[b+d-(f<<2),e+(CONTEXT_MENU_LINE_HEIGHT>>1),b+d-g,e+(CONTEXT_MENU_LINE_HEIGHT>>1)],borderWidth:h.name})},this),this._subMenu&&this._subMenu.draw()}},{key:"_doClickAct",value:function(b){var c=this,d=b.key;if(b.disabled)return!1;switch(Logger.log("Klikol v contextMenu na položku "+d,LOGGER_CONTEXT_CLICK),d){case"changeLayer":break;case"changeFillColor":pickUpColor(function(a){return Entity.changeAttr(c._selectedObject,ATTRIBUTE_FILL_COLOR,a)},this),actContextMenu=!1;break;case"changeBorderColor":pickUpColor(function(a){return Entity.changeAttr(c._selectedObject,ATTRIBUTE_BORDER_COLOR,a)},this),actContextMenu=!1;break;case"delete":this._selectedObject&&Scene.remove(this._selectedObject),actContextMenu=!1;break;case"locked":this._selectedObject.locked=!this._selectedObject.locked,a.items.locked.value=this._selectedObject.locked,actContextMenu=!1;break;case"clearWorkspace":Scene.cleanUp(),actContextMenu=!1;break;case"taskResult":this._selectedObject.taskResult=!this._selectedObject.taskResult,actContextMenu=!1;break;case"removeRow":this._selectedObject.removeRow(this._parent.position.y),actContextMenu=!1;break;case"removeColumn":this._selectedObject.removeColumn(this._parent.position.x),actContextMenu=!1;break;case"addRowBelow":this._selectedObject.addRow(this._parent.position.y,"below"),actContextMenu=!1;break;case"addRowAbove":this._selectedObject.addRow(this._parent.position.y,"above"),actContextMenu=!1;break;case"addColumnToRight":this._selectedObject.addColumn(this._parent.position.x,"right"),actContextMenu=!1;break;case"addColumnToLeft":this._selectedObject.addColumn(this._parent.position.x,"left"),actContextMenu=!1;break;case"clearRow":this._selectedObject.clear(this._parent.position.y,"row"),actContextMenu=!1;break;case"clearColumn":this._selectedObject.clear(this._parent.position.x,"column"),actContextMenu=!1;break;case"clearTable":this._selectedObject.clear(null,"table"),actContextMenu=!1;break;case"showPaint":this._selectedObject.toggleVisibilityOfPaint(this._position.y),actContextMenu=!1;break;case"clearPaint":this._selectedObject.clearPaint(this._position.y),actContextMenu=!1;break;case"visible":this._selectedObject.toggleVisibilityOfLayer(this._position.y),actContextMenu=!1;break;case"clearLayer":this._selectedObject.clearLayer(this.position.y),actContextMenu=!1;break;case"animatePaint":this._selectedObject.animateLayer(this.position.y),actContextMenu=!1;break;case"renameLayer":this._selectedObject.renameLayer(this.position.y),actContextMenu=!1;break;case"makeCopy":var e=Entity.create(this._selectedObject);e.position.add(this._selectedObject.size),Scene.addToScene(e),actContextMenu=!1;break;default:"roundRadius"==b.group?(Entity.changeAttr(this._selectedObject,ATTRIBUTE_RADIUS,b.name),actContextMenu=!1):"lineCapValue"==b.group?(this._selectedObject.lineCap=b.name,actContextMenu=!1):"joinTypeValue"==b.group?(this._selectedObject.joinType=b.name,actContextMenu=!1):"lineStyleValue"==b.group?(this._selectedObject.lineStyle=b.name,actContextMenu=!1):"widthValue"==b.group?(Entity.changeAttr(this._selectedObject,ATTRIBUTE_BORDER_WIDTH,b.name),actContextMenu=!1):"arrowEndType"==b.group?(this._selectedObject.arrowEndType=b.name,actContextMenu=!1):"arrowStartType"==b.group?(this._selectedObject.arrowStartType=b.name,actContextMenu=!1):"valignValue"==b.group?(this._selectedObject.verticalTextAlign=b.name,actContextMenu=!1):"halignValue"==b.group?(this._selectedObject.horizontalTextAlign=b.name,actContextMenu=!1):"layerValue"===b.group&&(Project.scene.changeLayer(this._selectedObject,b.name),actContextMenu=!1,draw())}}},{key:"clickIn",value:function(b,c){var d=this;if(!this.clickInBoundingBox(b,c))return!!this._subMenu&&this._subMenu.clickIn(b,c);var e=parseInt((c-this._position.y)/CONTEXT_MENU_LINE_HEIGHT);if(isDefined(this._titles[e])&&this._titles[e].hasOwnProperty("fields")){var f=this._position.getClone().add(this._menuWidth,e*CONTEXT_MENU_LINE_HEIGHT);f.x+this._menuWidth>canvas.width&&(f.x-=this._menuWidth<<1),"changeLayer"===this._titles[e].key&&(this._titles[e].fields=[],each(Scene.layers,function(a){d._titles[e].fields.push({group:"layerValue",name:a.title,label:a.title})})),this._subMenu=new a(f,objectToArray(this._titles[e].fields),this,this._titles[e].key)}else this._subMenu=!1;return this._doClickAct(this._titles[e]),!0}},{key:"position",get:function(){return this._position}}],[{key:"disabled",value:function(b){for(var c=arguments.length,d=Array(c>1?c-1:0),e=1;e<c;e++)d[e-1]=arguments[e];var f=a.items[d[0]];d[1]?f.fields[d[1]].disabled=b:f.disabled=b}},{key:"visibility",value:function(b){for(var c=arguments.length,d=Array(c>1?c-1:0),e=1;e<c;e++)d[e-1]=arguments[e];var f=a.items[d[0]];d[1]?f.fields[d[1]].visible=b:f.visible=b}}]),a}(),FileManager=function(){function a(){_classCallCheck(this,a),this._input=document.createElement("input"),this._input.setAttribute("type","file"),this._input.setAttribute("value","files"),this._input.setAttribute("class","hide"),this._link=document.createElement("a"),this._link.setAttribute("class","hide"),this._link.setAttribute("href",""),Logger.log("Bol vytvorený objekt "+this.constructor.name,LOGGER_COMPONENT_CREATE)}return _createClass(a,[{key:"saveFile",value:function(a,b){var c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"text/plain";this._link.href=URL.createObjectURL(new Blob([b],{type:c})),this._link.download=a,this._link.click()}},{key:"saveImage",value:function(a,b){this._link.href="string"==typeof b?b:b.src,this._link.download=a,this._link.click()}},{key:"loadImage",value:function(a){this._input.onchange=function(b){var c=new FileReader;c.onload=function(){var b=new Image;b.src=c.result,a(b)},c.readAsDataURL(b.target.files[0])},this._input.click()}},{key:"loadFile",value:function(a){this._input.onchange=function(b){var c=new FileReader;c.onload=function(){return a(c.result)},c.readAsText(b.target.files[0])},this._input.click()}}]),a}(),OptionsManager=function(){function a(){_classCallCheck(this,a),this._options={snapping:{id:"idAllowedSnapping",attr:"value",val:0},grid:{id:"idShowGrid",attr:"checked",val:OPTION_SHOW_GRID},showLayersViewer:{id:"idShowLayersViewer",attr:"checked",val:OPTION_SHOW_LAYERS_VIEWER},shadows:{id:"idShadows",attr:"checked",val:OPTION_SHOW_SHADOWS},movingSilhouette:{id:"idMovingSilhouette",attr:"checked",val:OPTION_MOVING_SILHOUETTE},changeCursor:{id:"idChangeCursor",attr:"checked",val:OPTION_CHANGE_CURSOR},canvasBlur:{id:"idCanvasBlur",attr:"checked",val:OPTION_CANVAS_BLUR}},Logger&&Logger.log("Bol vytvorený objekt "+this.constructor.name,LOGGER_COMPONENT_CREATE)}return _createClass(a,[{key:"_processAndSetValueIfExistById",value:function(a,b,c,d){var e=this,f=document.getElementById(a);f&&(f[c]=d,f.onchange=function(a){return e.setOpt(b,a.target[c],!1)})}},{key:"init",value:function(){var a=this;each(this._options,function(b,c){return a._processAndSetValueIfExistById(b.id,c,b.attr,b.val)})}},{key:"setOpt",value:function(a,b){var c=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],d=this._options[a];if(c){var e=document.getElementById(d.id);e&&(e[d.attr]=b)}"showLayersViewer"===a&&Entity.setAttr(Layers,"visible",b),Logger.log("nastavila sa možnosť "+a+" na hodnotu "+b,LOGGER_CHANGE_OPTION),d.val=b,draw()}},{key:"grid",get:function(){return this._options.grid.val}},{key:"shadows",get:function(){return this._options.shadows.val}},{key:"snapping",get:function(){return this._options.snapping.val}},{key:"canvasBlur",get:function(){return this._options.canvasBlur.val}},{key:"changeCursor",get:function(){return this._options.changeCursor.val}},{key:"showLayersViewer",get:function(){return this._options.showLayersViewer.val}},{key:"movingSilhouette",get:function(){return this._options.movingSilhouette.val}}]),a}(),InputManager=function(){function a(){_classCallCheck(this,a),this._keys=[],this._timer=!1,this._buttons=[],this._pressPosition=new GVector2f,this._mousePos=new GVector2f,this._lastTouch=!1,this._hist={},Logger&&Logger.log("Bol vytvorený objekt "+this.constructor.name,LOGGER_COMPONENT_CREATE)}return _createClass(a,[{key:"_onResize",value:function(){Project.canvasManager.onResize(),Scene.onScreenResize(),isDefined(timeLine)&&timeLine.onScreenResize(),isDefined(Layers)&&Layers.onScreenResize(),draw()}},{key:"_initWindowListeners",value:function(){var a=this;window.onresize=this._onResize,window.orientationchange=this._onResize,window.onbeforeunload=function(a){a.returnValue="Nazoaj chceš odísť s tejto stránky???!!!"},window.onhashchange=Listeners.hashChange,window.onkeydown=function(b){a._keyDown(b.keyCode),b.target.onkeyup||(b.target.onkeyup=function(b){a._keyUp(b.keyCode),b.target.onkeyup=!1})}}},{key:"initListeners",value:function(a){var b=this;this._initWindowListeners(),a.onclick=function(){draw()},a.onmousepress=function(a){return Listeners.mousePress(a.position.getClone(),a.button)},a.ondblclick=function(a){Listeners.mouseDoubleClick(new GVector2f(a.offsetX,a.offsetY),a.button)},a.onmousedown=function(a){b._buttonDown(a),Listeners.mouseDown(new GVector2f(a.offsetX,a.offsetY),a.button),a.target.onmouseup=function(a){return!!b.isButtonDown(a.button)&&(b._buttonUp(a),Options.changeCursor||(a.target.onmousemove=!1),a.target.onmouseup=!1,void Listeners.mouseUp(new GVector2f(a.offsetX,a.offsetY),a.button))},a.target.onmousemove=function(a){b._mouseMove(a),Listeners.mouseMove(new GVector2f(a.offsetX,a.offsetY),a.movementX,a.movementY)}},$(a).bind("contextmenu",function(){return!1}),a.addEventListener("touchstart",function(c){c.preventDefault(),b._lastTouch=getMousePos(a,c),Input._buttonDown({button:LEFT_BUTTON,offsetX:b._lastTouch.x,offsetY:b._lastTouch.y}),Listeners.mouseDown(new GVector2f(b._lastTouch.x,b._lastTouch.y),LEFT_BUTTON),c.target.addEventListener("touchmove",function(c){c.preventDefault(),Input._mouseMove({offsetX:b._lastTouch.x,offsetY:b._lastTouch.y});var d=getMousePos(a,c);d.x-=b._lastTouch.x,d.y-=b._lastTouch.y,b._lastTouch=getMousePos(a,c),Listeners.mouseMove(new GVector2f(b._lastTouch.x,b._lastTouch.y),d.x,d.y),draw()},!1),c.target.addEventListener("touchend",function(a){return a.preventDefault(),!!Input.isButtonDown(LEFT_BUTTON)&&(Input._buttonUp({button:LEFT_BUTTON,offsetX:b._lastTouch.x,offsetY:b._lastTouch.y}),Listeners.mouseUp(new GVector2f(b._lastTouch.x,b._lastTouch.y),LEFT_BUTTON),void draw())},!1),c.target.addEventListener("touchcancel",function(a){return a.preventDefault(),!!Input.isButtonDown(LEFT_BUTTON)&&(Input._buttonUp({button:LEFT_BUTTON,offsetX:b._lastTouch.x,offsetY:b._lastTouch.y}),Listeners.mouseUp(new GVector2f(b._lastTouch.x,b._lastTouch.y),LEFT_BUTTON),void draw())},!1)},!1)}},{key:"_keyDown",value:function(a){this._keys[a]=!0,Events.keyDown(a),Listeners.keyDown(a,this.isKeyDown(L_CTRL_KEY))}},{key:"_keyUp",value:function(a){this._keys[a]=!1,Events.keyUp(a),Listeners.keyUp(a,this.isKeyDown(L_CTRL_KEY)),this._hist[a]||(this._hist[a]=0),this._hist[a]++}},{key:"isKeyDown",value:function(a){return this._keys[a]}},{key:"_checkPress",value:function(a){if(!SelectedText){var b=this;this._buttons[a]=!1,canvas.onmousepress({position:b._pressPosition,button:a}),Logger.log("podržané tlačítko myši ::"+a+"::"+b._pressPosition.x+"::"+b._pressPosition.y,LOGGER_MOUSE_EVENT),this._timer,this._clearTimer()}}},{key:"_clearTimer",value:function(){clearTimeout(this._timer),this._timer=!1}},{key:"_mouseMove",value:function(a){this._mousePos.set(a.offsetX,a.offsetY),Events.mouseMove(a.offsetX,a.offsetY),this._timer&&this._pressPosition.dist(a.offsetX,a.offsetY)>TOUCH_VARIATION&&this._clearTimer()}},{key:"_buttonDown",value:function(a){this._buttons[a.button]=!0,Events.mouseDown(a.button,a.offsetX,a.offsetY);var b=this;this._timer&&this._clearTimer(),this._timer=setTimeout(function(){b._checkPress(a.button)},TOUCH_DURATION),this._pressPosition.set(a.offsetX,a.offsetY)}},{key:"_buttonUp",value:function(a){this._timer&&this._clearTimer(),this._buttons[a.button]=!1,Events.mouseUp(a.button,a.offsetX,a.offsetY)}},{key:"isButtonDown",value:function(a){return this._buttons[a]}},{key:"mousePos",get:function(){return this._mousePos}}]),a}(),MAIN_CANVAS="mainCanvas",POINTER_CANVAS="pointerCanvas",CANVAS_PREFIX="canvas",CanvasManager=function(){function a(b,c){_classCallCheck(this,a),this._sizeX=b,this._sizeY=c,this._canvases={},this._canvases[MAIN_CANVAS]=new CanvasHandler("myCanvas",b,c),this._canvasCounter=1}return _createClass(a,[{key:"initPointerCanvas",value:function(){this._pointerCanvas=new CanvasHandler(this._sizeX,this._sizeY),this._canvasCounter++}},{key:"onResize",value:function(){this._canvases[MAIN_CANVAS].setCanvasSize(),this._canvases[POINTER_CANVAS]&&this._canvases[POINTER_CANVAS].setCanvasSize()}},{key:"createCanvas",value:function(a,b,c){return c=c||CANVAS_PREFIX+this._canvasCounter,this._canvases[c]=new CanvasHandler(a,b),this._canvasCounter++,this._canvases[c]}},{key:"getCanvas",value:function(a){return this._canvases[a]}},{key:"removeCanvas",value:function(a){this._canvases[a]&&delete this._canvases[a]}},{key:"canvas",get:function(){return this._canvases[MAIN_CANVAS]}},{key:"pCanvas",get:function(){return this._canvases[POINTER_CANVAS]}}]),a}(),CanvasHandler=function(){function a(b,c,d){_classCallCheck(this,a),"string"==typeof b?(this._canvas=document.getElementById(b),c&&d&&a.setCanvasSize(this._canvas,c,d)):b instanceof HTMLImageElement?(this._canvas=a.imageToCanvas(b),a.setCanvasSize(this._canvas,b.width,b.height)):(this._canvas=document.createElement("canvas"),b&&c&&this.setCanvasSize(b,c)),this._context=this._canvas.getContext("2d")}return _createClass(a,[{key:"getImage",value:function(){return a.canvasToImage(this._canvas)}},{key:"setShadow",value:function(b,c,d,e){a.setShadow(this._context,b,c,d,e)}},{key:"show",value:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"image/png";window.open(this._canvas.toDataURL(a),"_blank")}},{key:"clearCanvas",value:function(){a.clearCanvas(this._context)}},{key:"setLineDash",value:function(){for(var b=arguments.length,c=Array(b),d=0;d<b;d++)c[d]=arguments[d];a.setLineDash(this._context,c)}},{key:"setCanvasSize",value:function(){var b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window.innerWidth,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window.innerHeight;a.setCanvasSize(this._canvas,b,c)}},{key:"appendTo",value:function(a){a.appendChild(this._canvas)}},{key:"canvas",get:function(){return this._canvas}},{key:"context",get:function(){return this._context}}],[{key:"clearCanvas",value:function(a){a.clearRect(0,0,a.canvas.width,a.canvas.height)}},{key:"setCanvasSize",value:function(a,b,c){a.width=b,a.height=c}},{key:"setShadow",value:function(a,b,c,d,e){a.shadowColor=d,a.shadowBlur=e,a.shadowOffsetX=b,a.shadowOffsetY=c}},{key:"imageToCanvas",value:function(a){var b=document.createElement("canvas");return b.width=a.width,b.height=a.height,b.getContext("2d").drawImage(a,0,0),b}},{key:"setLineDash",value:function(a){if("function"==typeof a.setLineDash){for(var b=arguments.length,c=Array(b>1?b-1:0),d=1;d<b;d++)c[d-1]=arguments[d];a.setLineDash(c)}}},{key:"calcTextWidth",value:function(a,b){var c=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return c&&(a.font=c),a.measureText(b).width}},{key:"canvasToImage",value:function(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"image/png",c=new Image;return c.src=a.toDataURL(b),c.width=a.width,c.height=a.height,c}}]),a}(),ContentManager=function(){function a(){_classCallCheck(this,a),this._contentImage=null,this._contentHTML=null,Logger.log("Bol vytvorený objekt "+this.constructor.name,LOGGER_COMPONENT_CREATE)}return _createClass(a,[{key:"setContentImage",value:function(){var a=this,b=arguments.length>0&&void 0!==arguments[0]&&arguments[0];null===this._contentImage&&(this._contentImage=document.getElementById("contentImage")),b?this._contentImage.src=b:(this._contentImage.src="#",loadImage(function(b){return a._contentImage.src=b.src})),this._contentImage.classList.remove("hide")}},{key:"setContentHTML",value:function(){var a=this;null===this._contentHTML&&(this._contentHTML=document.getElementById("contentHTML")),this._contentHTML.classList.remove("hide"),loadFile(function(b){return a._contentHTML.innerHTML=b})}},{key:"hideContent",value:function(){null!==this._contentImage&&this._contentImage.classList.add("hide"),null!==this._contentHTML&&this._contentHTML.classList.add("hide")}}]),a}(),ObjectsManager=function(){function a(){_classCallCheck(this,a),this._movedObject=!1,this._objects=[],Logger&&Logger.log("Bol vytvorený objekt "+this.constructor.name,LOGGER_COMPONENT_CREATE)}return _createClass(a,[{key:"size",value:function(){return this._objects.length}},{key:"onMouseMove",value:function(a,b,c){selectedObjects.forEach(function(a){return Movement.move(a,b,c)}),this._movedObject.selected||Movement.move(this._movedObject,b,c),selectedObjects.size()?updateSelectedObjectView(selectedObjects.getLast()):this._movedObject&&updateSelectedObjectView(this._movedObject)}},{key:"deleteAll",value:function(){each(this._objects,function(a){return Scene.remove(a)})}},{key:"selectAll",value:function(){var a=this;Scene.forEach(function(b){return a.add(b)})}},{key:"add",value:function(a){isDefined(a.locked)&&a.locked||!a||this._objects.indexOf(a)>=0||(this._objects.push(a),a.selected=!0,updateSelectedObjectView(a))}},{key:"get",value:function(a){return!!this._objects.hasOwnProperty(a)&&this._objects[a]}},{key:"getLast",value:function(){return this._objects[this.size()-1]}},{key:"clear",value:function(){each(this._objects,function(a){isDefined(a.moveType)&&(a.moveType=-1),a.selected=!1}),this._objects=[]}},{key:"clearAndAdd",value:function(a){this.clear(),this.add(a)}},{key:"forEach",value:function(a){each(this._objects,a)}},{key:"firstObject",get:function(){return this._objects[0]}},{key:"movedObject",get:function(){return this._movedObject},set:function(a){this._movedObject=a}}]),a}(),Layer=function(){function a(b){var c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";_classCallCheck(this,a),this._objects={},this._visible=!0,this._title=b,this._paint=null,this._locked=!1,this._drawPaint=!0,this._opacity=1,this._raster=!1,this._canvas=null,this._forRemove=[],this._layerType=c}return _createClass(a,[{key:"setForRemove",value:function(a){this._forRemove.push(a)}},{key:"removeElements",value:function(){each(this._forRemove,function(a){return Project.scene.remove(a)}),this._forRemove=[]}},{key:"cleanUp",value:function(){this.forEach(function(a){return callIfFunc(a.cleanUp)}),this._objects=[],Paints.cleanUp(this._title),Events.layerCleanUp(this._title)}},{key:"rename",value:function(a){Events.layerRename(this._title,a),this._title=a}},{key:"makeRaster",value:function(){this._raster=!0}},{key:"getObject",value:function(a){return this._objects[a]}},{key:"draw",value:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:context;this.visible&&(this.forEach(function(b){return b.visible&&b.draw(a)}),this._drawPaint&&this.paint.draw(a))}},{key:"add",value:function(a){this._objects[a.id]=a}},{key:"remove",value:function(a){delete this._objects[a.id]}},{key:"forEach",value:function(a){each(this._objects,function(b){return a(b)})}},{key:"locked",get:function(){return this._locked||""!==this._layerType},set:function(a){locked=a===!0}},{key:"taskLayer",get:function(){return this._layerType===LAYER_TASK}},{key:"guiLayer",get:function(){return this._layerType===LAYER_GUI}},{key:"userLayer",get:function(){return this._layerType===LAYER_USER}},{key:"drawPaint",get:function(){return this._drawPaint},set:function(a){this._drawPaint=a}},{key:"layerType",get:function(){return this._layerType}},{key:"visible",get:function(){return this._visible},set:function(a){this._visible=a}},{key:"objects",get:function(){return this._objects},set:function(a){this._objects=a}},{key:"raster",get:function(){return this._raster}},{key:"title",get:function(){return this._title},set:function(a){this._title=a}},{key:"paint",get:function(){return isNull(this._paint)&&(this._paint=new Paint),this._paint}}]),a}(),SceneManager=function(){function a(){_classCallCheck(this,a),this._layers={},this._secondCanvas=null,this._layersCount=0,this._creator=new objectCreator,this._objectManager=new ObjectsManager,Logger&&Logger.log("Bol vytvorený objekt "+this.constructor.name,LOGGER_COMPONENT_CREATE)}return _createClass(a,[{key:"initSecondCanvas",value:function(){this._secondCanvas=new CanvasHandler}},{key:"forEach",value:function(a){each(this._layers,function(b){return b.visible&&b.forEach(a)})}},{key:"cleanUp",value:function(){var a=this;each(this._layers,function(b){b.cleanUp(),b.title!==DEFAULT_LAYER_TITLE&&a.deleteLayer(b.title)}),Events.sceneCleanUp(),Logger.log("Bol vyčistený objekt "+this.constructor.name,LOGGER_OBJECT_CLEANED)}},{key:"onScreenResize",value:function(){each(this._layers,function(a){return a.paint.onScreenResize()})}},{key:"createLayer",value:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:DEFAULT_LAYER_TITLE,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return this._layers.hasOwnProperty(a)?(Logger.error(getMessage(MSG_RECREATE_LAYER,a)),null):this.layersNumber==LIMIT_LAYERS_COUNT?(Logger.error(getMessage(MSG_MAXIMUM_LAYER,LIMIT_LAYERS_COUNT)),null):(this._layers[a]=new Layer(a,b),this._layersCount++,isDefined(Layers)&&Layers.createLayer(this._layers[a]),Events.layerCreate(a,b),this._layers[a])}},{key:"getLayer",value:function(a){return this._layers[a]}},{key:"renameLayer",value:function(a,b){this._layers[a]&&!this._layers[b]&&(this._layers[b]=this._layers[a],delete this._layers[a],this._layers[b].rename(b))}},{key:"deleteLayer",value:function(a){return this._layers.hasOwnProperty(a)||Logger.error("ide sa vymazať vrstva ktorá už neexistuje: "+a),this._layers[a].guiLayer?(Logger.notif("nemože sa zmazať gui vrstva"),!1):(this._layers[a].cleanUp(),delete this._layers[a],this._layersCount--,isDefined(Layers)&&Layers.deleteLayer(a),void Events.layerDelete(a))}},{key:"changeLayer",value:function(a,b){var c=Project.scene.getLayer(b);if(c){var d=a.layer;c.add(a),Entity.changeAttr(a,"layer",b),Project.scene.getLayer(d).remove(a)}}},{key:"getTaskObject",value:function(a){a.error=""===a.error?a.error:"",a.results=isEmptyObject(a.results)?a.results:{},a.content=isEmptyArray(a.content)?a.content:[],each(this.layers,function(b,c){b.visible&&b.forEach(function(b){if(b!==Layers&&b.visible){if(b.name===OBJECT_TEXT){if(""===b.text)return;if(b.taskResult){a.results[b.id]=b.text,b.text="";for(var c in a.results[b.id])b.text+=" "}}a.content.push(b)}})});var b=!0;return isEmptyObject(a.results)&&(a.error+="nieje zadaný žiadny text pre výsledok"),""===a.error&&b}},{key:"addToScene",value:function(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Layers.activeLayerName,c=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._layers.hasOwnProperty(b)||Logger.error("ide sa načítať neexistujúca vrstva: "+b),a.layer=b,this._layers[b].add(a),Events.objectAdded(c,a),c||(a.selected=!1),draw()}},{key:"findObjectsForRemove",value:function(a,b,c){each(Project.scene.layers,function(d){d.forEach(function(e){isFunction(e.isIn)&&e.isIn(a,b,c)&&d.setForRemove(e)}),d.removeElements()})}},{key:"getObject",value:function(a,b){return this._layers[a].getObject(b)}},{key:"draw",value:function(){each(this._layers,function(a){return a.draw()})}},{key:"remove",value:function(a){
var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a.layer,c=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._layers[b].remove(a),Events.objectDeleted(c,a)}},{key:"toString",value:function(){return JSON.stringify(this.toObject())}},{key:"fromObject",value:function(a){each(a,function(a){return Creator.create(a)})}},{key:"fromObjectToSingleLayer",value:function(a,b){each(b,function(b){b._layer=a,Creator.create(b)})}},{key:"toObject",value:function(){var a=[];return each(this._layers,function(b){return b.forEach(function(b){"LayerViewer"!=b.name&&a.push(b)})}),a}},{key:"creator",get:function(){return this._creator}},{key:"objectManager",get:function(){return this._objectManager}},{key:"layers",get:function(){return this._layers}},{key:"paint",get:function(){return Layers.activeLayer.paint}},{key:"layersNumber",get:function(){return this._layersCount}},{key:"secondCanvas",get:function(){return this._secondCanvas}}]),a}(),EventManager=function(){function a(){_classCallCheck(this,a),this._history=[]}return _createClass(a,[{key:"paintAddPoint",value:function(a,b){Project.connection&&Project.connection.paint.addPoint(a,b)}},{key:"paintAddPath",value:function(a,b){}},{key:"paintBreakLine",value:function(a){Project.connection&&Project.connection.paint.breakLine(a),Logger.log("bola ukončená čiara vo vrstve "+a,LOGGER_PAINT_ACTION)}},{key:"paintCleanUp",value:function(a){Project.connection&&Project.connection.paint.clean(a),Logger.log("Bol vyčistený objekt "+this.constructor.name,LOGGER_OBJECT_CLEANED)}},{key:"paintBrushChange",value:function(a,b,c){Logger.log("Bol prekreslený štetec "+a+", "+b+", "+c,LOGGER_PAINT_HISTORY)}},{key:"paintUndo",value:function(a){Logger.log("bolo zavolane undo na vrstvu "+a,LOGGER_PAINT_HISTORY)}},{key:"paintRedo",value:function(a){Logger.log("bolo zavolane redo na vrstvu "+a,LOGGER_PAINT_HISTORY)}},{key:"layerCreate",value:function(a,b){Project.connection&&Project.connection.layer.create(a,b),Logger.log("Vytvorila sa vrstva: "+a+"typu: "+b,LOGGER_LAYER_CHANGE)}},{key:"layerDelete",value:function(a){Project.connection&&Project.connection.layer.delete(a),Logger.log("Vymazala sa vrstva: "+a,LOGGER_LAYER_CHANGE)}},{key:"layerRaster",value:function(a){Logger.log("vrstva "+a+" bola rastrovaná",LOGGER_LAYER_RASTERED)}},{key:"layerCleanUp",value:function(a){Project.connection&&Project.connection.layer.clean(a),Logger.log("Bola vyčistená vrstva: "+a,LOGGER_LAYER_CLEANED)}},{key:"layerRename",value:function(a,b){Project.connection&&Project.connection.layer.rename(a,b),Logger.log("Bola premenovaná vrstva: "+a+" na "+b,LOGGER_LAYER_RENAMED)}},{key:"creatorChange",value:function(a,b){Project.connection&&Project.connection.creatorChange(a,b),Logger.log("Creatorovi sa nastavuje "+a+" na "+b,LOGGER_CREATOR_CHANGE)}},{key:"objectAdded",value:function(a,b){a&&Project.connection&&Project.connection.object.create(b),Logger.log("Vytvára sa objekt ",LOGGER_OBJECT_CREATED)}},{key:"objectChange",value:function(a,b){Project.connection&&Project.connection.object.change(a,b)}},{key:"objectDeleted",value:function(a,b){a&&Project.connection&&Project.connection.object.delete(b)}},{key:"objectMove",value:function(a){Project.connection&&Project.connection.object.move(a)}},{key:"sceneCleanUp",value:function(){}},{key:"loadScene",value:function(){}},{key:"keyDown",value:function(a){Project.connection&&Project.connection.input.keyDown(a),Logger.log("stlačené klavesa "+a,LOGGER_KEY_EVENT)}},{key:"keyUp",value:function(a){Project.connection&&Project.connection.input.keyUp(a),Logger.log("pustená klavesa "+a,LOGGER_KEY_EVENT)}},{key:"mouseMove",value:function(a,b){isSharing()&&Sharer.mouseChange(a,b)}},{key:"mouseDown",value:function(a,b,c){Logger.log("stlačené tlačítko myši ::"+a+"::"+b+"::"+c,LOGGER_MOUSE_EVENT),isSharing()&&Sharer.mouseChange(a)}},{key:"mouseUp",value:function(a,b,c){Logger.log("pustené tlačítko myši ::"+a+"::"+b+"::"+c,LOGGER_MOUSE_EVENT),isSharing()&&Sharer.mouseChange(a)}}]),a}(),TimeLine=function(){function a(){var b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:75,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;_classCallCheck(this,a),this.onScreenResize(),this._slideHeight=TIMELINE_SLIDER_HEIGHT,this._slideColor=TIMELINE_SLIDER_COLOR,this._sliderOffset=TIMELINE_SLIDER_OFFSET,this._buttonColor=TIMELINE_BUTTON_COLOR,this._buttonSize=TIMELINE_BUTTON_SIZE,this._buttonBorderColor=TIMELINE_BUTTON_BORDER_COLOR,this._maxVal=c,this._minVal=d,this.value=b,this._sliderPosition=this._calcSliderPosition(),Logger.log("Bol vytvorený objekt "+this.constructor.name,LOGGER_COMPONENT_CREATE)}return _createClass(a,[{key:"_clickInBoundingBox",value:function(a,b){return a>this._position.x&&a<this._position.x+this._size.x&&b>this._position.y&&b<this._position.y+this._size.y}},{key:"clickIn",value:function(a,b){if(!this._clickInBoundingBox(a,b,this))return!1;var c=[this._sliderOffset+this._sliderPosition,this._position.y+(this._size.y>>1)];return Math.sqrt(Math.pow(a-c[0],2)+Math.pow(b-c[1],2))<this._buttonSize}},{key:"_calcSliderPosition",value:function(){return(this._size.x-(this._sliderOffset<<1))/(this._maxVal-this._minVal)*(this._val-this._minVal)}},{key:"animateToVal",value:function(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3/FPS,d=(a-this._val)/b,e=this,f=0,g=setInterval(function(){e._val+=d,++f==b&&clearInterval(g),draw()},c)}},{key:"onScreenResize",value:function(){arguments.length>0&&void 0!==arguments[0]?arguments[0]:window.innerWidth,arguments.length>1&&void 0!==arguments[1]?arguments[1]:window.innerHeight;this._position=new GVector2f(0,window.innerHeight-TIMELINE_HEIGHT),this._size=new GVector2f(window.innerWidth,TIMELINE_HEIGHT)}},{key:"onMouseMove",value:function(a){a.x<this._position.x+this._sliderOffset&&(a.x=this._position.x+this._sliderOffset),a.x>this._position.x+this._size.x-this._sliderOffset&&(a.x=this._position.x+this._size.x-this._sliderOffset),this._sliderPosition=a.x-this._sliderOffset,this._val=(this._sliderPosition-this._position.x)/(this._size.x-(this._sliderOffset<<1))*this._maxVal}},{key:"draw",value:function(){doRect({position:this._position,size:this._size,fillColor:"Lavender",borderColor:"LawnGreen",borderWidth:1}),doRect({x:this._position.x+this._sliderOffset,y:this._position.y+(this._size.y-this._slideHeight>>1),width:this._size.x-(this._sliderOffset<<1),height:this._slideHeight,fillColor:this._slideColor}),doArc({x:this._sliderOffset+this._sliderPosition,y:this._position.y+(this._size.y>>1),width:this._buttonSize,center:!0,height:this._buttonSize,fillColor:this._buttonColor,borderColor:this._buttonBorderColor})}},{key:"value",set:function(a){this._val=a,this._sliderPosition=this._calcSliderPosition()}}]),a}(),REFRESH_TIME=1e3,RECONNECT_TRIES=10,KEY_USER_NAME="user_name",KEY_USER_ID="user_id",KEY_LESS_ID="less_id",KEY_TARGET="target",KEY_TYPE="type",KEY_LAYER="layer",KEY_WATCH="watch",KEY_SHARE="share",KEY_TITLE="title",KEY_VALUE="value",KEY_TEACH="teach",KEY_DATA="data",KEY_EXERCISE="exercise",ConnectionManager=function(){function a(){var b=this;_classCallCheck(this,a),this._user_id=!1,this._socket=!1,this._user_name=DEFAULT_USER_NAME,this._connectedUsers={},this.paint={addPoint:function(a,c){return b._paintAction(ACTION_PAINT_ADD_POINT,a,c)},breakLine:function(a){return b._paintAction(ACTION_PAINT_BREAK_LINE,a)},clean:function(a){return b._paintAction(ACTION_PAINT_CLEAN,a)},addPath:function(a,c){return b._paintAction(ACTION_PAINT_ADD_PATH,a,c)}},this.object={move:function(a){return b._objectAction(ACTION_OBJECT_MOVE,a)},change:function(a,c){return b._objectAction(ACTION_OBJECT_CHANGE,a,c)},delete:function(a){return b._objectAction(ACTION_OBJECT_DELETE,a)},create:function(a){return b._objectAction(ACTION_OBJECT_CREATE,a)}},this.input={mouseMove:function(a,c){return b._inputAction(ACTION_MOUSE_MOVE,a,c)},mouseDown:function(a,c){return b._inputAction(ACTION_MOUSE_DOWN,a,c)},mouseUp:function(a,c){return b._inputAction(ACTION_MOUSE_UP,a,c)},keyDown:function(a){return b._inputAction(ACTION_KEY_DOWN,a)},keyUp:function(a){return b._inputAction(ACTION_KEY_UP,a)}},this.layer={create:function(a,c){return b._layerAction(ACTION_LAYER_CREATE,a,c)},delete:function(a){return b._layerAction(ACTION_LAYER_DELETE,a)},clean:function(a){return b._layerAction(ACTION_LAYER_CLEAN,a)},visible:function(a,c){return b._layerAction(ACTION_LAYER_VISIBLE,c)},rename:function(a,c){return b._layerAction(ACTION_LAYER_RENAME,c)}},this._sharing=!1,this._sender=new EventTimer(function(a){return b._sendStack()},REFRESH_TIME),this._buffer=[];var c=this;$.post("/create",{content:JSON.stringify({meno:"gabriel"})},function(a){c._user_id=a.cookies[KEY_USER_ID]},"json"),Logger&&Logger.log("Bol vytvorený objekt "+this.constructor.name,LOGGER_COMPONENT_CREATE)}return _createClass(a,[{key:"startShare",value:function(a){a[KEY_TYPE]=KEY_SHARE,this.connect(a)}},{key:"startTeach",value:function(a){a[KEY_TYPE]=KEY_TEACH,this.connect(a)}},{key:"startWatch",value:function(a){return a[KEY_TYPE]=KEY_WATCH,isUndefined(a[KEY_LESS_ID])?(Logger.error(getMessage(MSG_MISS_LESS_ID)),!1):void this.connect(a)}},{key:"startExercise",value:function(a){return a[KEY_TYPE]=KEY_EXERCISE,isUndefined(a[KEY_LESS_ID])?(Logger.error(getMessage(MSG_MISS_LESS_ID)),!1):void this.connect(a)}},{key:"connect",value:function(a){this._socket=io(),this._startTime=Date.now(),this._type=a[KEY_TYPE],this._user_name=a[KEY_USER_NAME]||this._user_name,a.resolution=window.innerWidth+"_"+window.innerHeight;var b=this;b.resetLives(),this._sharePaints=a.sharePaints,this._shareInput=a.shareInput,this._shareCreator=a.shareCreator,this._shareLayers=a.shareLayers,this._shareObjects=a.shareObjects,this._maximalWatchers=a.maxWatchers,this._socket.on("connect_failed",function(){Logger.error(getMessage(MSG_CONN_FAILED))}),this._socket.on("connect_error",function(){b._lives===RECONNECT_TRIES&&Logger.error(getMessage(MSG_CONN_ERROR)),b._lives--,0===b._lives&&b.disconnect()}),this._socket.on("reconnect",function(){b.resetLives(),Logger.notif(getMessage(MSG_CONN_RECONNECT))}),this._socket.on("confirmConnection",function(a){b._less_id=a[KEY_DATA][KEY_LESS_ID],b._connectTime=Date.now(),b._messageTime=Date.now(),b._type===KEY_WATCH||b._type===KEY_TEACH?(b._type===KEY_WATCH&&Scene.initSecondCanvas(),b._watching=!0):b._sharing=!0,Logger.notif(getMessage(MSG_CONN_CONFIRM)),isFunction(Menu.disabled)&&(Menu.disabled("sharing","watch"),Menu.disabled("sharing","stopShare"),Menu.disabled("sharing","shareOptions"),Menu.disabled("sharing","copyUrl"),Menu.disabled("sharing","startShare"))}),this._socket.on("receivedBuffer",function(a){b._processStack(a)}),this._socket.on("errorLog",function(a){Logger.error(a.msg)}),this._socket.on("notifLog",function(a){Logger.notif(a.msg)}),this._socket.emit("initConnection",a)}},{key:"disconnect",value:function(){isFunction(Menu.disabled)&&(Menu.disabled("sharing",KEY_WATCH),Menu.disabled("sharing","stopShare"),Menu.disabled("sharing","shareOptions"),Menu.disabled("sharing","copyUrl"),Menu.disabled("sharing","startShare")),this._socket.disconnect(),this._user_id=!1,this._socket=!1,this._sharing=!1,this._watching=!1,Logger.notif(getMessage(MSG_CONN_DISCONNECT)),Panel.stopShare()}},{key:"_processInputAction",value:function(a){}},{key:"_processStack",value:function(a){console.log("prijaty buffer po: "+(Date.now()-this._messageTime)),this._messageTime=Date.now();var b=this;each(a.buffer,function(a){switch(a.action){case"requireAllData":Handler.processRequireAllData(b,a[KEY_DATA]);break;case"sendAllData":Handler.processSendAllData(b,a[KEY_DATA]);break;case"userDisconnect":Handler.processUserDisconnect(b,a[KEY_DATA]);break;case"userConnect":Handler.processUserConnect(b,a[KEY_DATA]);break;case"paintAction":Handler.processPaintAction(a[KEY_DATA],b._type);break;case"layerAction":Handler.processLayerAction(a[KEY_DATA]);break;case"inputAction":b._processInputAction(a[KEY_DATA]);break;case"creatorAction":Creator.setOpt(a[KEY_DATA].key,a[KEY_DATA][KEY_VALUE]),draw();break;case"objectAction":Handler.processObjectAction(a[KEY_DATA],b._type);break;default:Logger.error(getMessage(MSG_UNKNOW_ACTION,a.action))}})}},{key:"_sendStack",value:function(){if(this._socket&&!this._socket.disconnected){if(0===this._buffer.length)return!1;var a={buffer:this._buffer,user_id:this._user_id};this._less_id&&(a[KEY_LESS_ID]=this._less_id),this._socket.emit("sendBuffer",a),this._buffer=[]}}},{key:"_sendMessage",value:function(a,b){this._buffer.push({action:a,time:Date.now(),data:b}),this._sender.callIfCan()}},{key:"resetLives",value:function(){this._lives=RECONNECT_TRIES}},{key:"creatorChange",value:function(a,b){if(this._socket&&this._shareCreator&&!this.watching){var c={key:a,value:b};this._sendMessage("creatorAction",c)}}},{key:"_layerAction",value:function(a,b,c){if(this._socket&&this._shareLayers&&!this.watching){var d={action:a};switch(a){case ACTION_LAYER_CREATE:d[KEY_TITLE]=b,d[KEY_TYPE]=c;break;case ACTION_LAYER_DELETE:d[KEY_TITLE]=b;break;case ACTION_LAYER_CLEAN:d[KEY_TITLE]=b;break;case ACTION_LAYER_VISIBLE:d[KEY_TITLE]=b,d[KEY_VALUE]=c;break;case ACTION_LAYER_RENAME:d[KEY_TITLE]=b,d[KEY_VALUE]=c}this._sendMessage("layerAction",d)}}},{key:"_objectAction",value:function(a,b,c){if(this._socket&&this._shareObjects&&!this.watching){var d={action:a,user_name:this._user_name};switch(a){case ACTION_OBJECT_MOVE:d.oId=b.id,d.oL=b.layer,d.oX=b.position.x,d.oY=b.position.y,d.oW=b.size.x,d.oH=b.size.y;break;case ACTION_OBJECT_CHANGE:d.oId=b.id,d.oL=b.layer,d.keys={},each(c,function(a,c){return d.keys.i=b[c]});break;case ACTION_OBJECT_DELETE:d.oId=b.id,d.oL=b.layer;break;case ACTION_OBJECT_CREATE:d.o=b;break;default:return void Logger.error(a,2)}this._sendMessage("objectAction",d)}}},{key:"_inputAction",value:function(a,b,c){if(!this._socket||!this._shareInput||this.watching)return!1;var d={type:a};switch(a){case ACTION_KEY_DOWN:d.key=b;break;case ACTION_KEY_UP:d.key=b;break;case ACTION_MOUSE_DOWN:d.key=b,d.position=c;break;case ACTION_MOUSE_UP:d.key=b,d.position=c;break;case ACTION_MOUSE_MOVE:d.direction=b,d.position=c;break;default:Logger.error(a,1)}this._sendMessage("inputAction",d)}},{key:"_paintAction",value:function(a,b,c){if(!this._socket||!this._sharePaints||this.watching)return!1;var d={action:a,user_name:this._user_name};switch(a){case ACTION_PAINT_ADD_POINT:d.pX=b.x,d.pY=b.y,d[KEY_LAYER]=c;break;case ACTION_PAINT_BREAK_LINE:d[KEY_LAYER]=b;break;case ACTION_PAINT_CLEAN:d[KEY_LAYER]=b;break;case ACTION_PAINT_ADD_PATH:d[KEY_LAYER]=b,d.path=c;break;case ACTION_PAINT_REMOVE_PATH:d[KEY_LAYER]=b;break;default:return void Logger.error(a,3)}this._sendMessage("paintAction",d)}},{key:"userId",get:function(){return this._user_id}},{key:"sharing",get:function(){return this._sharing}},{key:"watching",get:function(){return this._watching}}]),a}(),Handler=function(){function a(){_classCallCheck(this,a)}return _createClass(a,null,[{key:"processUserDisconnect",value:function(a,b){Logger.notif("používatel "+b[KEY_USER_NAME]+"[ "+b[KEY_USER_ID]+"] sa odpojil");var c=a._connectedUsers[b[KEY_USER_ID]];c&&(c.status=STATUS_DISCONNECTED,lastConnectionTime=Date.now())}},{key:"processUserConnect",value:function(a,b){a._connectedUsers[b[KEY_USER_ID]]={user_name:b[KEY_USER_NAME],status:STATUS_CONNECTED,connectTime:Date.now()},a._type===KEY_TEACH,Logger.notif(getMessage(MSG_USER_CONNECT,b[KEY_USER_NAME],b[KEY_USER_ID]))}},{key:"processRequireAllData",value:function(a,b){console.log("prijal som žiadosť o všetky udaje pre "+b[KEY_TARGET]);var c={};a._type===KEY_SHARE?(c={msg:{scene:Scene.toObject(),creator:Creator.toObject(),paint:Paints.toObject(),user_name:a._user_name},target:b[KEY_TARGET]},a._sendMessage("sendAllData",c)):a._type===KEY_EXERCISE&&(c={msg:{scene:Scene.toObject(),paint:Paints.toObject(),user_name:a._user_name},target:b[KEY_TARGET]},a._sendMessage("sendAllData",c))}},{key:"processSendAllData",value:function(a,b){if(console.log("prijal som všetky udaje "),a._type==KEY_WATCH){var c=b.shareOptions,d=b.watchOptions;c.share.objects&&Scene.fromObject(b.scene),c.share.creator&&Creator.fromObject(b.creator),c.share.paints&&Paints.fromObject(b.paint),d.show.chat&&Panel.startWatch(sendMessage),d.show.timeLine&&(timeLine=new TimeLine),Project.autor=d.nickName,console.log("nastavuje sa",b),Menu.visible=c.share.menu,Creator.visibleView=c.share.menu,Options.setOpt("showLayersViewer",c.share.layers)}else a._type==KEY_TEACH&&(Scene.getLayer(b[KEY_USER_NAME])&&Scene.deleteLayer(b[KEY_USER_NAME]),Scene.createLayer(b[KEY_USER_NAME],LAYER_USER),Scene.fromObjectToSingleLayer(b[KEY_USER_NAME],b.scene),Paints.fromObjectToSingleLayer(b[KEY_USER_NAME],b.paint));draw()}},{key:"processObjectAction",value:function(a,b){var c,d="teach"===b?a.user_name:a.oL;switch(a.action){case ACTION_OBJECT_MOVE:c=Scene.getObject(d,a.oId),c.position.set(a.oX,a.oY),c.size.set(a.oW,a.oH);break;case ACTION_OBJECT_DELETE:Scene.remove(Scene.getObject(d,a.oId),a.oL,!1);break;case ACTION_OBJECT_CHANGE:c=Scene.getObject(d,a.oId),each(a.keys,function(a,b){return c[b]=a});break;case ACTION_OBJECT_CREATE:a.o._layer=d,Creator.create(a.o);break;default:Logger.error(getMessage(MSG_RECIEVED_UNKNOWN_ACTION,a.action))}draw()}},{key:"processLayerAction",value:function(a){var b=Project.scene.getLayer(a[KEY_TITLE]);switch(a.action){case ACTION_LAYER_CREATE:b||Project.scene.createLayer(a[KEY_TITLE],a[KEY_TYPE]);break;case ACTION_LAYER_DELETE:b&&Project.scene.deleteLayer(a[KEY_TITLE]);break;case ACTION_LAYER_CLEAN:b&&b.cleanUp();break;case ACTION_LAYER_VISIBLE:b&&(b.visible=a[KEY_VALUE]);break;case ACTION_LAYER_RENAME:b&&b.rename(a[KEY_VALUE])}}},{key:"processPaintAction",value:function(a,b){var c=a[KEY_LAYER];switch(b===KEY_TEACH&&(c=a[KEY_USER_NAME]),a.action){case ACTION_PAINT_ADD_POINT:Paints.addPoint(new GVector2f(a.pX,a.pY),c);break;case ACTION_PAINT_BREAK_LINE:Paints.breakLine(c);break;case ACTION_PAINT_CLEAN:Paints.cleanUp(c);break;case ACTION_PAINT_ADD_PATH:Paints.addPath(c,a.path);break;default:Logger.error(getMessage(MSG_RECIEVED_UNKNOWN_ACTION,a.action))}draw()}}]),a}(),ProjectManager=function(){function a(b){var c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"OIP Project";_classCallCheck(this,a),this._createdAt=Date.now(),this._title=c,this._autor=b,this._idCounter=0,this._scene=new SceneManager,this._options=new OptionsManager,this._input=new InputManager,this._gui=new GuiManager,this._canvasManager=null,this._drawCounter=0,this._connection=null,this._analyzer=new Analyzer("http://192.168.0.123:3000/anonymousData");try{"function"==typeof ConnectionManager&&(this._connection=new ConnectionManager)}catch(a){alert("Nastala chyba pri vytváraní pripojenia "+a)}Logger.log("Bol vytvorený objekt "+this.constructor.name,LOGGER_COMPONENT_CREATE),this._analyzer.sendData(),""===getCookie("send_data")&&setCookie("send_data",1)}return _createClass(a,[{key:"initCanvas",value:function(){this._canvasManager=new CanvasManager(window.innerWidth,window.innerHeight)}},{key:"generateId",value:function(){var a="000000000"+this._idCounter++;return(this._connection?this._connection.userId:"")+a.substr(a.length-6)}},{key:"increaseDrawCounter",value:function(){this._drawCounter++}},{key:"input",get:function(){return this._input}},{key:"canvasManager",get:function(){return this._canvasManager}},{key:"canvas",get:function(){return this._canvasManager&&this._canvasManager.canvas.canvas}},{key:"context",get:function(){return this._canvasManager&&this._canvasManager.canvas.context}},{key:"drawCounter",get:function(){return this._drawCounter}},{key:"creator",get:function(){return this._scene.creator}},{key:"scene",get:function(){return this._scene}},{key:"gui",get:function(){return this._gui}},{key:"topMenu",get:function(){return this._gui.menu}},{key:"options",get:function(){return this._options}},{key:"connection",get:function(){return this._connection}},{key:"runOnMobile",get:function(){return this._browserData.mobile>0}},{key:"autor",set:function(a){this._autor=a},get:function(){return this._autor}},{key:"isMobile",get:function(){return this._analyzer.isMobile}},{key:"title",get:function(){return this._title}},{key:"time",get:function(){return Date.now()-this._createdAt}}]),a}(),PaintManager=function(){function a(){_classCallCheck(this,a),this._brushes=[],this._selectedImage=null,this._selectedImageName=null,this._selectedBrush=null,this._action=PAINT_ACTION_LINE,this._paintHistory=[],this._undoHistory=[],Logger.log("Bol vytvorený objekt "+this.constructor.name,LOGGER_COMPONENT_CREATE)}return _createClass(a,[{key:"addPoint",value:function(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Layers.activeLayerName;Events.paintAddPoint(a,b);var c=Scene.getLayer(b);c&&c.paint.addPoint(a)}},{key:"findPathsForRemove",value:function(a,b){var c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Layers.activeLayerName;Scene.getLayer(c).paint.findPathsForRemove(a,b)}},{key:"removeSelectedPaths",value:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Layers.activeLayerName;Scene.getLayer(a).paint.removeSelectedPaths()}},{key:"cleanUp",value:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Layers.activeLayerName;Events.paintCleanUp(a),Scene.getLayer(a).paint.cleanUp()}},{key:"fromObject",value:function(a){each(a,function(a,b){var c=Scene.getLayer(b);c||(c=Scene.createLayer(b)),c.paint.fromObject(a)})}},{key:"fromObjectToSingleLayer",value:function(a,b){var c=Scene.getLayer(a);each(b,function(a){c.paint.fromObject(a,!0)})}},{key:"toObject",value:function(){var a={};return each(Scene.layers,function(b){return a[b.title]=b.paint.toObject()}),a}},{key:"addPath",value:function(a,b){Scene.getLayer(a).paint.addLine(b)}},{key:"breakLine",value:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Layers.activeLayerName;this._paintHistory.push(a),this._undoHistory=[];Scene.getLayer(a).paint.breakLine();Events.paintBreakLine(a),this._setButtons()}},{key:"addBrush",value:function(a){var b=new Image;b.src=FOLDER_IMAGE+"/"+a,this._brushes[a]=b,isNull(this._selectedImage)&&(this.selectedImage=a),Logger.log("pridal sa nový štetec: "+a,LOGGER_PAINT_ACTION)}},{key:"rePaintImage",value:function(a,b){var c,d,e,f,g,h=document.createElement("canvas");for(h.width=a,h.height=a,c=h.getContext("2d"),c.drawImage(this._selectedImage,0,0,a,a),d=c.getImageData(0,0,a,a),e=d.data,f=b.replace("rgb(","").replace("rgba(","").replace(")","").split(", ").map(function(a){return parseInt(a)}),g=3;g<e.length;g+=4)0!=e[g]&&(e[g-3]=f[0],e[g-2]=f[1],e[g-1]=f[2]);c.putImageData(d,0,0),this._selectedBrush=h,Events.paintBrushChange(a,b,this._selectedImageName)}},{key:"drawLine",value:function(a,b,c,d,e,f,g){if(f==PAINT_ACTION_LINE)a.lineCap=LINE_CAP_ROUND,a.lineWidth=d,a.strokeStyle=e,a.beginPath(),a.moveTo(b.x,b.y),a.lineTo(c.x,c.y),a.stroke();else if(f==PAINT_ACTION_BRUSH){var h=b.dist(c),i=Math.atan2(b.x-c.x,b.y-c.y);Creator.setOpt("brushColor",e),Creator.setOpt("brushSize",d),Creator.setOpt("brushType",g);for(var j=0;j<h;j++)a.drawImage(Paints.selectedBrush,c.x+Math.sin(i)*j-(d>>1),c.y+Math.cos(i)*j-(d>>1),d,d)}}},{key:"undo",value:function(){if(0===this._paintHistory.length)return!1;var a=this._paintHistory.pop();Scene.getLayer(a).paint.undo(),this._undoHistory.push(a),Events.paintUndo(a),console.log(this._paintHistory.length,this._undoHistory.length),this._setButtons(),draw()}},{key:"redo",value:function(){if(0===this._undoHistory.length)return!1;var a=this._undoHistory.pop();Scene.getLayer(a).paint.redo(),this._paintHistory.push(a),Events.paintRedo(a),this._setButtons(),draw()}},{key:"_setButtons",value:function(){Menu.disabled("mainMenu","undo",0===this._paintHistory.length),Menu.disabled("mainMenu","redo",0===this._undoHistory.length)}},{key:"getBrush",value:function(a){return this._brushes[a]}},{key:"selectedImage",get:function(){return this._selectedImage},set:function(a){this._selectedImage=this._brushes[a],this._selectedImageName=a,Menu._redraw()}},{key:"selectedBrush",get:function(){return this._selectedBrush}},{key:"action",get:function(){return this._action},set:function(a){this._action=a}}],[{key:"getId",value:function(){return a._idCounter||(a._idCounter=1),a._idCounter++}}]),a}(),ListenersManager=function(){function a(){_classCallCheck(this,a),this._movedObject=null,this._clickedOnObject=!1}return _createClass(a,[{key:"mouseDown",value:function(a,b){var c=this;if(this._clickedOnObject=!1,$(canvas).hasClass("blur"))return closeDialog(),this._clickedOnObject=!0,!1;if(isDefined(timeLine)&&timeLine.clickIn(a.x,a.y))return this._movedObject=timeLine,this._clickedOnObject=!0,!1;if(this._clickedOnObject||actContextMenu||Creator.operation!=OPERATION_AREA||!area||(area.isReady&&area.clickIn(a.x,a.y)?(selectedObjects.movedObject=area,area.moving=!0,this._movedObject=selectedObjects):area.startCreate(a),this._clickedOnObject=!0),SelectedText){var d=new G("#selectedEditor");d.isEmpty()||(console.log("res: "+parseInt(window.getComputedStyle(d).fontSize,10)),SelectedText.text=d.text(),d.delete())}return Creator.clickIn(a.x,a.y,!1)||!Menu.isToolActive()&&!Creator.controllPress||Creator.object?(this._clickedOnObject||b!=LEFT_BUTTON||actContextMenu||Scene.forEach(function(d){if(d.visible&&!d.layer.userLayer&&d.clickIn(a.x,a.y,b))return Creator.operation===OPERATION_DRAW_LINE&&Input.isKeyDown(L_CTRL_KEY)&&d.selectedConnector?(Creator.createObject(a,d),c._movedObject=Creator):(d.moving=!0,selectedObjects.movedObject=d,c._movedObject=selectedObjects),c._clickedOnObject=!0,!0}),void draw()):(Creator.createObject(a),this._movedObject=Creator,this._clickedOnObject=!0,!1)}},{key:"hashChange",value:function(){setUpComponents(),MenuManager.dataBackup&&Menu.init(JSON.parse(MenuManager.dataBackup)),Layers&&Entity.setAttr(Layers,"visible",Components.layers()),Gui.showOptionsByComponents(),draw()}},{key:"keyDown",value:function(a,b){DELETE_KEY===a&&area.isReady&&area.removeSelected(b),draw()}},{key:"keyUp",value:function(a,b){if(b)switch(a){case Z_KEY:Paints.undo();break;case Y_KEY:Paints.redo();break;case A_KEY:selectedObjects.selectAll(),draw()}else switch(a){case DELETE_KEY:selectedObjects.deleteAll(),draw();break;case ESCAPE_KEY:closeDialog();break;case KEY_NUM_1:Creator.operation=OPERATION_DRAW_PATH,draw();break;case KEY_NUM_2:Creator.operation=OPERATION_DRAW_RECT,draw();break;case KEY_NUM_3:Creator.operation=OPERATION_DRAW_LINE,draw();break;case KEY_NUM_4:Creator.operation=OPERATION_DRAW_ARC,draw();break;case KEY_NUM_5:Creator.operation=OPERATION_DRAW_IMAGE,draw()}}},{key:"mousePress",value:function(a){return Menu.pressIn(a.x,a.y)?(draw(),!0):(Paints.breakLine(),actContextMenu=new ContextMenuManager(a),selectedObjects.movedObject&&(selectedObjects.movedObject.moving=!1,selectedObjects.movedObject=!1,this._movedObject=null),draw(),!1)}},{key:"mouseDoubleClick",value:function(a){var b=!1,c=new GVector2f(100,40);return Scene.forEach(function(c){!b&&isDefined(c.doubleClickIn)&&c.doubleClickIn(a.x,a.y)&&(b=c)}),b||getText("",a,c,function(b){return b.length&&Scene.addToScene(new TextField(b,a,c))}),draw(),!0}},{key:"mouseUp",value:function(a){var b=null;1===selectedObjects.size()&&(b=selectedObjects.firstObject),this._movedObject=null;var c=!1;if(Creator.operation===OPERATION_RUBBER&&Paints.removeSelectedPaths(),Creator.operation==OPERATION_AREA&&area&&(area.isCreating?area.endCreate(a):area.moving&&(area.moving=!1)),actContextMenu){if(actContextMenu.clickIn(a.x,a.y))return!1;actContextMenu=!1}if(Creator.object&&Creator.object.name!=OBJECT_LINE)return Creator.finishCreating(a),!1;if(Creator.operation==OPERATION_DRAW_PATH&&Components.draw()&&(Paints.addPoint(a),Paints.breakLine()),!Menu.clickIn(a.x,a.y)&&!Creator.clickIn(a.x,a.y)){closeDialog();var d=!1,e=null;Scene.forEach(function(f){if(!c&&f.clickIn(a.x,a.y)){if(b&&b.parent===f&&(d=!0),f.selectedConnector&&(e=f),Creator.object)return f.selectedConnector&&(console.log("teraz"),Creator.object.targetB=f),void(c=!0);Input.isKeyDown(L_CTRL_KEY)?selectedObjects.add(f):selectedObjects.clearAndAdd(f),c=!0}}),selectedObjects.movedObject&&(e&&selectedObjects.movedObject.name===OBJECT_LINE&&(selectedObjects.movedObject.setTarget(e),console.log("teraz")),selectedObjects.movedObject.moving=!1,selectedObjects.movedObject=!1,this._movedObject=null),b&&!d&&b.removeParent(),Creator.object&&Creator.finishCreating(),c||selectedObjects.clear()}}},{key:"mouseMove",value:function(a,b,c){if(Options.changeCursor){var d=Menu.hover(a.x,a.y);d||Creator.operation!==OPERATION_AREA||(d=area.hover(a.x,a.y)),d||Scene.forEach(function(b){d||(d=b.hover(a.x,a.y))})}if(Creator.operation==OPERATION_AREA&&area&&area.isCreating)return area.addPoint(a),this._clickedOnObject=!0,!1;if(Creator.operation===OPERATION_RUBBER&&Input.isButtonDown(LEFT_BUTTON))return Paints.drawLine(context,a,{x:a.x-b,y:a.y-c},Creator.brushSize,"grey",PAINT_ACTION_LINE),Paints.findPathsForRemove(a,1),Project.scene.findObjectsForRemove(a.x,a.y,1),this._clickedOnObject=!0,!1;if(this._movedObject&&isFunction(this._movedObject.onMouseMove))return this._movedObject.onMouseMove(a,b,c),draw(),this._clickedOnObject=!0,!1;if(Input.isButtonDown(LEFT_BUTTON)&&Creator.operation==OPERATION_DRAW_PATH&&Components.draw()){var e=1;return Paints.addPoint(1===e?a:a.div(e).round().mul(e)),draw(),this._clickedOnObject=!0,!1}}}]),a}(),initTime=Date.now(),movedObject=!1,Logger=new LogManager,Project=new ProjectManager("Gabriel Csollei"),Scene=Project.scene,Creator=Project.creator,Input=Project.input,selectedObjects=Project.scene.objectManager,Menu=Project.topMenu,actContextMenu=!1,Listeners=new ListenersManager,Content=new ContentManager,Files=new FileManager,Paints=new PaintManager,Task=null,Events=("undefined"==typeof EventManager?"undefined":_typeof(EventManager))!==KEYWORD_UNDEFINED?new EventManager:null,SelectedText=null,Gui=Project.gui,Options=Project.options,drawEvent=new EventTimer(realDraw,1e3/FPS),area=null,Panel=null,Forms=null,Connection=Project.connection,draw=function(){return drawEvent.callIfCan()},components,drawMousePos,Layers,canvas,context,chatViewer,timeLine,Components={draw:function(){return isDefined(components)&&isDefined(components.draw)&&components.draw===!0},share:function(){return isDefined(components)&&isDefined(components.share)&&components.share===!0},watch:function(){return isDefined(components)&&isDefined(components.watch)&&components.watch===!0},tools:function(){return isDefined(components)&&isDefined(components.tools)&&components.tools===!0},save:function(){return isDefined(components)&&isDefined(components.save)&&components.save===!0},load:function(){return isDefined(components)&&isDefined(components.load)&&components.load===!0},screen:function(){return isDefined(components)&&isDefined(components.screen)&&components.screen===!0},content:function(){return isDefined(components)&&isDefined(components.content)&&components.content===!0},layers:function(){return isDefined(components)&&isDefined(components.layers)&&components.layers===!0},task:function(){return isDefined(components)&&isDefined(components.task)&&components.task===!0},edit:function(){return isDefined(components)&&isDefined(components.edit)&&components.edit===!0}};ajax(FOLDER_JSON+"/context.json",function(a){return ContextMenuManager.items=a},"json"),$.getJSON(FOLDER_JSON+"/attributes.json",function(a){return Entity.attr=a}),ajax(FOLDER_JSON+"/forms.json",function(a){Forms=new FormManager(a);var b={shareForm:"sharingForm",optionsForm:"optionsForm",watchForm:"watchForm",saveXmlForm:"saveXmlForm",saveForm:"saveImgForm"};each(b,function(a,b){var c=document.getElementById(b);c&&c.appendChild(Forms.createForm(a))}),Project.options.init()},"json"),$.ajax({dataType:"json",url:"/js/json/config_user.json",success:function(a){console.log("constants: ",setConstants(a.environmentOptions)),setVisibilityData(a.visibilityOptions)}});var loading=function(){Listeners.hashChange(),area=new Area,Project.initCanvas(),canvas=Project.canvas,
context=Project.context,Project._connection=new ConnectionManager,$.getJSON(FOLDER_JSON+"/menu.json",function(a){Project.topMenu.init(a),$.getJSON(FOLDER_JSON+"/creator.json",function(a){Creator.init(a),Paints.rePaintImage(Creator.brushSize,Creator.brushColor),draw()})}),Panel=new PanelManager,Project.scene.createLayer(),Project.scene.createLayer("rightMenu","gui"),Project.scene.createLayer("test2"),Project.context.shadowColor=DEFAULT_SHADOW_COLOR,Project.input.initListeners(Project.canvas),"undefined"!=typeof Sharer&&(chatViewer=new ChatViewer(Project.title+"'s chat",Project.autor,sendMessage)),Layers=new LayersViewer(G.byId("layerViewerPlaceholder")),Project.scene.addToScene(Layers,"rightMenu");var a=Project.topMenu.position.x+(Project.topMenu.size.x+MENU_OFFSET)*Project.topMenu.visibleElements-MENU_OFFSET;Creator.view=new CreatorViewer(new GVector2f(Project.topMenu.visible?a:MENU_OFFSET,Project.topMenu.position.y-MENU_OFFSET)),console.log("stranka sa nacítala za: ",Date.now()-initTime+" ms"),console.log("to by malo byť: "+Date.now()+" ms"),draw()};$(loading);var Entity=function(){function a(b){var c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new GVector2f,d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new GVector2f,e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};_classCallCheck(this,a),this._position=c,this._size=d,this._name=b,this._drawCounter=-1,this._selected=!1,this._visible=!0,this._moving=!1,this._locked=!1,this._minSize=!1,this._selectedConnector=!1,this._layer="default",this._parent=null,this._childrens=[],a.changeAttr(this,e),isUndefined(this._connectors)&&(this._connectors=[new GVector2f(.5,0),new GVector2f(.5,1),new GVector2f(0,.5),new GVector2f(1,.5)]),isUndefined(this._id)&&(this._id=Project.generateId()),isUndefined(this._borderWidth)&&(this._borderWidth=Creator.borderWidth),isUndefined(this._radius)&&(this._radius=Creator.radius),isUndefined(this._fillColor)&&(this._fillColor=Creator.color),isUndefined(this._borderColor)&&(this._borderColor=Creator.borderColor)}return _createClass(a,[{key:"isIn",value:function(a,b){var c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return a+c>this._position.x&&a-c<this._position.x+this._size.x&&b+c>this._position.y&&b-c<this._position.y+this._size.y}},{key:"removeChildren",value:function(a){var b=this._childrens.indexOf(a);return b>=0&&(this._childrens.splice(b,1),a._parent=null),a}},{key:"removeParent",value:function(){return this._parent&&this._parent.removeChildren(this),this}},{key:"addChildren",value:function(a){if(a._parent!==this&&this._parent!==a){var b=this._childrens.indexOf(a);b<0&&(this._childrens.push(a),a._parent=this)}return a}},{key:"eachChildren",value:function(a){each(this._childrens,function(b){a(b)})}},{key:"addConnector",value:function(){var a=this;objectToArray(arguments).forEach(function(b){return a._connectors.push(b)},this)}},{key:"clickInBoundingBox",value:function(a,b){var c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this;return a+SELECTOR_SIZE>c._position.x&&a-SELECTOR_SIZE<c._position.x+c._size.x&&b+SELECTOR_SIZE>c._position.y&&b-SELECTOR_SIZE<c._position.y+c._size.y}},{key:"clickIn",value:function(a,b){return!!this.clickInBoundingBox(a,b)&&this._clickIn(a,b)}},{key:"_clickIn",value:function(a,b){return!1}},{key:"hover",value:function(a,b){return!!this.clickInBoundingBox(a,b)&&this._hover(a,b)}},{key:"_hover",value:function(a,b){return!1}},{key:"pressIn",value:function(a,b){return!1}},{key:"cleanUp",value:function(){}},{key:"_draw",value:function(){}},{key:"draw",value:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:context;if(this._drawCounter!==Project.drawCounter&&(this._drawCounter=Project.drawCounter,this.visible)){this._draw(a);for(var b in this._childrens)this._childrens[b].draw(a)}}},{key:"checkConnectors",value:function(a){var b=this;this._selectedConnector=!1,each(this._connectors,function(c,d){if(!b._selectedConnector){var e=c.getClone().mul(b.size);a.dist(b.position.x+e.x,b.position.y+e.y)<SELECTOR_SIZE&&(b._selectedConnector=d)}})}},{key:"getConnectorPosition",value:function(a){var b=this._connectors[a];if(b)return this._position.getClone().add(this._size.getClone().mul(b))}},{key:"parent",get:function(){return this._parent}},{key:"selectedConnector",get:function(){return this._selectedConnector},set:function(a){this._selectedConnector=a}},{key:"id",get:function(){return this._id}},{key:"name",get:function(){return this._name}},{key:"size",get:function(){return this._size}},{key:"layer",get:function(){return this._layer},set:function(a){this._layer=a}},{key:"radius",get:function(){return this._radius}},{key:"locked",get:function(){return this._locked},set:function(a){this._locked=a}},{key:"minSize",get:function(){return this._minSize},set:function(a){this._minSize=a}},{key:"visible",get:function(){return this._visible}},{key:"selected",get:function(){return this._selected},set:function(a){this._selected=a}},{key:"position",get:function(){return this._position}},{key:"fillColor",get:function(){return this._fillColor}},{key:"borderWidth",get:function(){return this._borderWidth}},{key:"borderColor",get:function(){return this._borderColor}}],[{key:"getId",value:function(){return isUndefined(a._actId)&&(a._actId=0),a._actId++}},{key:"setAttr",value:function(b,c,d){return isUndefined(a.attr)||isDefined(a.attr.Entity[c])||isDefined(a.attr[b.name][c])?b["_"+c]=d:Logger.error("k objektu "+b.name+" sa snaží priradiť neplatný atribút: "+c),Events.objectChange(b,c,d),b}},{key:"changeAttr",value:function(b,c,d){return isObject(c)?each(c,function(c,d){return a.setAttr(b,d,c)}):a.setAttr(b,c,d),b}},{key:"findMinAndMax",value:function(a,b,c){b.set(a[0]),c.set(a[0]),a.forEach(function(d,e){e&&(b.x=Math.min(a[e].x,b.x),b.y=Math.min(a[e].y,b.y),c.x=Math.max(a[e].x,c.x),c.y=Math.max(a[e].y,c.y))}),c.sub(b)}},{key:"drawConnectors",value:function(a,b){(Creator.operation==OPERATION_DRAW_JOIN||Creator.operation==OPERATION_DRAW_LINE&&Input.isKeyDown(L_CTRL_KEY))&&a._connectors.forEach(function(c){return drawConnector(c,a,b)})}},{key:"animateMove",value:function(a,b){var c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:FPS,d=b.getClone().sub(a.position).div(c),e=0,f=setInterval(function(){a.position.add(d),draw(),++e==c&&(clearInterval(f),a.position.set(b))},1e3/c)}},{key:"setMoveType",value:function(a,b){b.dist(a.position.x+(a.size.x>>1),a.position.y)<SELECTOR_SIZE?a.moveType=0:b.dist(a.position.x+a.size.x,a.position.y+(a.size.y>>1))<SELECTOR_SIZE?a.moveType=1:b.dist(a.position.x+(a.size.x>>1),a.position.y+a.size.y)<SELECTOR_SIZE?a.moveType=2:b.dist(a.position.x,a.position.y+(a.size.y>>1))<SELECTOR_SIZE?a.moveType=3:b.dist(a.position.x+a.size.x,a.position.y+a.size.y)<SELECTOR_SIZE?a.moveType=5:b.x>a.position.x&&b.y>a.position.y&&b.x<a.position.x+a.size.x&&b.y<a.position.y+a.size.y&&(a.moveType=4)}},{key:"createInstance",value:function(a){var b=isString(a)?a:a._name;switch(b){case OBJECT_RECT:return new Rect;case OBJECT_ARC:return new Arc;case OBJECT_TABLE:return new Table;case OBJECT_TEXT:return new TextField("");case OBJECT_POLYGON:return new Polygon([0,0,0]);case OBJECT_LINE:return new Line([0,0,0]);case OBJECT_CLASS:return new Class;default:return Logger.error("snažíš sa vložiť objekt s neznámym menom: "+a._name),null}}},{key:"create",value:function(b){var c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];isString(b)&&(b=JSON.parse(b));var d=a.createInstance(b);return d&&(each(b,function(a,b){a&&isDefined(a._x)&&_typeof(isDefined(a._y))?d[b]=new GVector2f(a._x,a._y):"data"==b?d[b]=a.map(function(a){return a.map(function(a){return a})}):"points"==b?d[b]=a.map(function(a){return new GVector2f(a._x,a._y)}):"_id"==b&&c?d[b]=Project.generateId():d[b]=a}),Logger.notif("objekt bol úspešne vytvorený"),Logger.log("Vytvoril sa objekt "+(d.name||"Neznámy"),LOGGER_OBJECT_CREATED)),d}}]),a}(),CreatorViewer=function(a){function b(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new GVector2f(100,100),c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new GVector2f(400,40),d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};_classCallCheck(this,b);var e=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,"CreatorViewer",a,c,d));return e._items=[],e._canvas=document.createElement("canvas"),e._context=e._canvas.getContext("2d"),Entity.changeAttr(e,{fillColor:MENU_BACKGROUND_COLOR,borderColor:MENU_BORDER_COLOR,borderWidth:MENU_BORDER_WIDTH,radius:MENU_RADIUS}),Logger.log("Bol vytvorený objekt "+e.constructor.name,LOGGER_COMPONENT_CREATE),e}return _inherits(b,a),_createClass(b,[{key:"init",value:function(){this.size.x=(MENU_WIDTH+MENU_OFFSET)*getLength(Creator.items)+MENU_OFFSET,this.size.y=MENU_HEIGHT+(MENU_OFFSET<<1),this._canvas.width=this._size.x,this._canvas.height=MENU_HEIGHT<<4,this._context=this._canvas.getContext("2d");var a=0,b=0;each(Creator.items,function(c,d,e){b=0,e[d].offset=a,doRect({x:a,y:b,width:MENU_WIDTH,height:MENU_HEIGHT,radius:this._radius,borderColor:this._borderColor,fillColor:this._fillColor,borderWidth:this._borderWidth,ctx:this._context}),isDefined(c.values)?each(c.values,function(c,f){b>0&&doRect({x:a,y:b,width:MENU_WIDTH,height:MENU_HEIGHT,radius:this._radius,borderColor:this._borderColor,fillColor:this._fillColor,borderWidth:this._borderWidth,ctx:this._context}),c==Creator[d]&&(e[d].selectedIndex=f),this._drawIcon(d,c,a,b),b+=MENU_HEIGHT},this):"bool"===c.type?(e[d].selectedIndex=0,this._drawIcon(d,c.value,a,b)):d==ATTRIBUTE_FONT_COLOR?fillText("Abc",a+(MENU_WIDTH>>1),b+(MENU_HEIGHT>>1),DEFAULT_FONT_SIZE,Creator.fontColor,0,FONT_ALIGN_CENTER,this._context):(e[d].selectedIndex=0,this._drawIcon(d,Creator[d],a,b)),a+=MENU_WIDTH},this),this.changeOperation()}},{key:"_drawBool",value:function(a,b,c,d,e,f){var g=c+e>>1;doLine(a?{points:[new GVector2f(b+f,g),new GVector2f(b+f+d/4,g+3*f),new GVector2f(b+d-f,g-2*f)],borderWidth:MENU_BORDER_WIDTH<<2,borderColor:CHECKBOX_COLOR_TRUE,ctx:this._context}:{points:[[new GVector2f(b+f,c+f),new GVector2f(b+d-f,c+e-f)],[new GVector2f(b+f,c+e-f),new GVector2f(b+d-f,c+f)]],borderWidth:MENU_BORDER_WIDTH<<2,borderColor:CHECKBOX_COLOR_FALSE,ctx:this._context})}},{key:"_drawIcon",value:function(a,b,c,d){var e=arguments.length>4&&void 0!==arguments[4]?arguments[4]:MENU_WIDTH,f=arguments.length>5&&void 0!==arguments[5]?arguments[5]:MENU_HEIGHT,g=arguments.length>6&&void 0!==arguments[6]?arguments[6]:5;switch(a){case"allLayers":this._drawBool(b,c,d,e,f,g);break;case"controll":this._drawBool(b,c,d,e,f,g);break;case ATTRIBUTE_LINE_WIDTH:doLine({points:[c+g,d+(f>>1),c+e-g,d+(f>>1)],borderWidth:b,borderColor:MENU_BORDER_COLOR,ctx:this._context});break;case ATTRIBUTE_RADIUS:doRect({position:[c+(g<<1),d+(g<<1)],size:[e-(g<<2),f-(g<<2)],borderWidth:5,borderColor:MENU_BORDER_COLOR,radius:b,ctx:this._context});break;case ATTRIBUTE_FILL_COLOR:doRect({position:[c+(g<<1),d+(g<<1)],size:[e-(g<<2),f-(g<<2)],borderWidth:5,borderColor:MENU_BORDER_COLOR,fillColor:Creator[ATTRIBUTE_FILL_COLOR],ctx:this._context});break;case ATTRIBUTE_BRUSH_TYPE:"line"===b?doArc({position:[c+(g<<1),d+(g<<1)],size:[e-(g<<2),f-(g<<2)],fillColor:MENU_BORDER_COLOR,ctx:this._context}):doRect({position:[c,d],size:[e,f],bgImage:Paints.getBrush(b),ctx:this._context});break;case ATTRIBUTE_BRUSH_COLOR:doArc({position:[c+(g<<1),d+(g<<1)],size:[e-(g<<2),f-(g<<2)],fillColor:Creator[ATTRIBUTE_BRUSH_COLOR],ctx:this._context});break;case ATTRIBUTE_BRUSH_SIZE:doArc({position:[c+(e>>1),d+(f>>1)],size:[b,b],center:!0,fillColor:MENU_BORDER_COLOR,ctx:this._context});break;case ATTRIBUTE_BORDER_COLOR:doRect({position:[c+(g<<1),d+(g<<1)],size:[e-(g<<2),f-(g<<2)],borderWidth:5,borderColor:Creator[ATTRIBUTE_BORDER_COLOR],ctx:this._context});break;case ATTRIBUTE_BORDER_WIDTH:doRect({position:[c+(g<<1),d+(g<<1)],size:[e-(g<<2),f-(g<<2)],borderWidth:b,borderColor:MENU_BORDER_COLOR,ctx:this._context});break;case ATTRIBUTE_FONT_SIZE:fillText("Abc",c+(e>>1),d+(f>>1),b,MENU_BACKGROUND_COLOR,0,FONT_ALIGN_CENTER,this._context);break;default:fillText(a,c+(e>>1),d+(f>>1),7,MENU_FONT_COLOR,0,FONT_ALIGN_CENTER,this._context)}}},{key:"_clickOn",value:function(a,b){if(b<this.position.y||a<this.position.x||a>this.position.x+this.size.x)return!1;var c,d=this.position.x+MENU_OFFSET,e=null;return each(this._items,function(f,g,h){!e&&a>d&&a<d+MENU_WIDTH?b<this.position.y+MENU_OFFSET+MENU_HEIGHT?e=f:f.itemsSelected&&(c=this.position.y+MENU_OFFSET,isDefined(f.item.values)&&each(f.item.values,function(a,d){c+=MENU_HEIGHT+MENU_OFFSET,!e&&b>c&&b<c+MENU_HEIGHT&&(e=f,f.item.selectedIndex=d)})):f.itemsSelected&&(h[g].itemsSelected=!1),d+=MENU_OFFSET+MENU_WIDTH},this),e}},{key:"clickIn",value:function(a,b){var c=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],d=this,e=this._clickOn(a,b);return!!e&&(!(c||!e)||(isDefined(e.item.values)?(Creator.setOpt(e.key,e.item.values[e.item.selectedIndex]),e.itemsSelected=!e.itemsSelected):"color"==e.item.type?pickUpColor(function(a){return Creator.setOpt(e.key,a)}):"bool"==e.item.type&&(e.item.value=!e.item.value,"controll"===e.key&&(Creator._controllPress=e.item.value),"allLayers"===e.key&&(Creator._allLayers=e.item.value),d.init(),draw()),!0))}},{key:"changeOperation",value:function(){this._items=[],each(Creator.items,function(a,c){b.allowedOption(Creator.operation,a.allowedFor)&&this._items.push({item:a,key:c,itemsSelected:!1})},this)}},{key:"draw",value:function(){var a=MENU_OFFSET;each(this._items,function(b){if(doRect({bgImage:{x:b.item.offset,y:b.item.selectedIndex*MENU_HEIGHT,w:MENU_WIDTH,h:MENU_HEIGHT,img:this._canvas},x:this.position.x+a,y:this.position.y+MENU_OFFSET,width:MENU_WIDTH,height:MENU_HEIGHT,radius:this._radius,borderColor:this._borderColor,borderWidth:this._borderWidth}),fillText(b.key,this.position.x+a+(MENU_WIDTH>>1),this.position.y+MENU_OFFSET+(MENU_HEIGHT>>1),7,MENU_FONT_COLOR,0,FONT_ALIGN_CENTER),b.itemsSelected&&isDefined(b.item.values)){var c=this.position.y+MENU_OFFSET;each(b.item.values,function(d,e){c+=MENU_OFFSET+MENU_WIDTH,doRect({bgImage:{x:b.item.offset,y:e*MENU_HEIGHT,w:MENU_WIDTH,h:MENU_HEIGHT,img:this._canvas},x:this.position.x+a,y:c,width:MENU_WIDTH,height:MENU_HEIGHT,radius:this._radius,borderColor:this._borderColor,borderWidth:this._borderWidth})},this)}a+=MENU_WIDTH+MENU_OFFSET},this)}}],[{key:"allowedOption",value:function(a,b){switch(a){case 1e3:return isIn(OBJECT_RECT,b);case 1001:return isIn(OBJECT_ARC,b);case 1002:return isIn(OBJECT_PAINT,b);case 1003:return isIn(OBJECT_LINE,b);case 1004:return isIn(OBJECT_JOIN,b);case 1006:return isIn(OBJECT_RUBBER,b);case 1007:return isIn(OBJECT_AREA,b)}return!1}}]),b}(Entity),TextField=function(a){function b(a,c,d){var e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:DEFAULT_FONT_COLOR;_classCallCheck(this,b);var f=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,"Text",c,d,{fillColor:DEFAULT_BACKGROUND_COLOR,radius:DEFAULT_RADIUS}));return f._text=a||"",f._textColor=e,f._fontSize=DEFAULT_FONT_SIZE,f._moveType=-1,f._taskResult=!1,f._hightlight=!1,f.size.x=calcTextWidth(a,f._fontSize+"pt "+DEFAULT_FONT)+(DEFAULT_TEXT_OFFSET<<1),f.minSize=f.size.getClone(),f._verticalTextAlign=FONT_VALIGN_TOP,f._horizontalTextAlign=FONT_HALIGN_LEFT,f._fontOffset=DEFAULT_TEXT_OFFSET,f._link=!1,f.addConnector(new GVector2f(0,0),new GVector2f(1,0),new GVector2f(0,1),new GVector2f(1,1)),f}return _inherits(b,a),_createClass(b,[{key:"draw",value:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:context,b=this.position.getClone();doRect({shadow:this.moving&&!this.locked,position:this.position,size:this.size,radius:this.radius,fillColor:this.fillColor,borderWidth:this._borderWidth,borderColor:this._hightlight?this._hightlight==HIGHTLIGHT_CORRECT?"green":"red":DEFAUL_STROKE_COLOR,draw:!0,fill:!0,ctx:a}),a.textAlign=this._horizontalTextAlign,a.textBaseline=this._verticalTextAlign,a.fillStyle=this._textColor,a.font=this._fontSize+"pt "+DEFAULT_FONT,this._horizontalTextAlign==FONT_HALIGN_LEFT?b.x+=this._fontOffset:this._horizontalTextAlign==FONT_HALIGN_CENTER?b.x+=this.size.x>>1:this._horizontalTextAlign==FONT_HALIGN_RIGHT&&(b.x+=this.size.x-this._fontOffset),this._verticalTextAlign==FONT_VALIGN_MIDDLE?b.y+=this.size.y>>1:this._verticalTextAlign==FONT_VALIGN_BOTT&&(b.y+=this.size.y-this._fontOffset),a.fillText(this._text,b.x,b.y),drawBorder(a,this),Entity.drawConnectors(this,a)}},{key:"clickIn",value:function(a,b){if(!this.clickInBoundingBox(a,b))return!1;var c=this.position,d=new GVector2f(a,b);return this.checkConnectors(d),!!this._selectedConnector||(d.dist(c.x+(this.size.x>>1),c.y)<SELECTOR_SIZE?this._moveType=0:d.dist(c.x+this.size.x,c.y+(this.size.y>>1))<SELECTOR_SIZE?this._moveType=1:d.dist(c.x+(this.size.x>>1),c.y+this.size.y)<SELECTOR_SIZE?this._moveType=2:d.dist(c.x,c.y+(this.size.y>>1))<SELECTOR_SIZE?this._moveType=3:d.dist(c.x+this.size.x,c.y+this.size.y)<SELECTOR_SIZE?this._moveType=5:a>this.position.x&&b>this.position.y&&a<this.position.x+this.size.x&&b<this.position.y+this.size.y&&(this._moveType=4),this._moveType>=0)}},{key:"doubleClickIn",value:function(a,b){return!!this.clickInBoundingBox(a,b)&&(getText(this._text,new GVector2f(a,b),this._size.getClone().sub(4),function(a){0==a.length&&Scene.remove(this),this._text=a,this._size.x=calcTextWidth(a)+(DEFAULT_TEXT_OFFSET<<1),Task&&this.taskResult&&(this._hightlight=Task.checkResult(this)?HIGHTLIGHT_CORRECT:HIGHTLIGHT_WRONG)},this),!0)}},{key:"moveType",get:function(){return this._moveType},set:function(a){this._moveType=a}},{key:"text",get:function(){return this._text},set:function(a){this._text=a,this._size.x=calcTextWidth(a)+(DEFAULT_TEXT_OFFSET<<1)}},{key:"taskResult",get:function(){return this._taskResult},set:function(a){this._taskResult=a}},{key:"verticalTextAlign",set:function(a){this._verticalTextAlign=a}},{key:"horizontalTextAlign",set:function(a){this._horizontalTextAlign=a}}]),b}(Entity),Table=function(a){function b(a,c){var d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[[]];_classCallCheck(this,b);var e=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,OBJECT_TABLE,a,c,{borderColor:shadeColor1(TABLE_HEADER_COLOR,-20),radius:TABLE_RADIUS}));return e.data=d,e._headerColor=TABLE_HEADER_COLOR,e.moveType=-1,e._bodyColor=TABLE_BODY_COLOR,e._textOffset=TABLE_TEXT_OFFSET,e._columnWidth=e._size.x/e.data[0].length,e._lineHeight=TABLE_LINE_HEIGHT,e._fontSize=DEFAULT_FONT_SIZE,e.size.set(e._size.x,d.length*e._lineHeight),e._calcMaxTextWidth(),e}return _inherits(b,a),_createClass(b,[{key:"clear",value:function(a,b){if("row"==b){var c=parseInt((a-this._position.y)/this._lineHeight);this.data[c].forEach(function(a,b){this.data[c][b]=""},this)}else if("column"==b){var d=parseInt((a-this._position.x)/this._columnWidth);this.data.forEach(function(a){a[d]=""})}else"table"==b&&this.data.forEach(function(a){a.forEach(function(b,c){a[c]=""},this)},this)}},{key:"addRow",value:function(a,b){var c=parseInt((a-this._position.y)/this._lineHeight),d=0;"below"==b&&d++;var e=[];this.data[0].forEach(function(){e.push([""])}),this.data.splice(c+d,0,e),this._size.y=this.data.length*this._lineHeight,this._checkSize()}},{key:"addColumn",value:function(a,b){var c=parseInt((a-this._position.x)/this._columnWidth),d=0;"right"==b&&d++,this.data.forEach(function(a){a.splice(c+d,0,[""])}),this._columnWidth=this._size.x/this.data[0].length,this._checkSize()}},{key:"removeRow",value:function(a){var b=parseInt((a-this._position.y)/this._lineHeight);b>0?this.data.splice(b,1):Logger.error("nemožeš vymazať hlavičku tabulky"),this._size.y=this.data.length*this._lineHeight,this._calcMaxTextWidth(),0==this.data.length&&Scene.remove(this)}},{key:"removeColumn",value:function(a){var b=parseInt((a-this._position.x)/this._columnWidth);this.data.forEach(function(a){a.splice(b,1)}),this._columnWidth=this._size.x/this.data[0].length,this._calcMaxTextWidth(),0==this.data[0].length&&Scene.remove(this)}},{key:"clickIn",value:function(a,b){if(!this.clickInBoundingBox(a,b))return!1;var c=this.position,d=new GVector2f(a,b);return d.dist(c.x+(this.size.x>>1),c.y)<SELECTOR_SIZE?this.moveType=0:d.dist(c.x+this.size.x,c.y+(this.size.y>>1))<SELECTOR_SIZE?this.moveType=1:d.dist(c.x+(this.size.x>>1),c.y+this.size.y)<SELECTOR_SIZE?this.moveType=2:d.dist(c.x,c.y+(this.size.y>>1))<SELECTOR_SIZE?this.moveType=3:d.dist(c.x+this.size.x,c.y+this.size.y)<SELECTOR_SIZE?this.moveType=5:a>this.position.x&&b>this.position.y&&a<this.position.x+this.size.x&&b<this.position.y+this.size.y&&(this.moveType=4),this.moveType>=0}},{key:"_calcMaxTextWidth",value:function(a){var b;return context.font=this._fontSize+"pt "+DEFAULT_FONT,isString(a)&&(b=context.measureText(a).width+(this._textOffset<<1),b>this._maxTextWidth)?void(this._maxTextWidth=b):(this._maxTextWidth=0,void this.data.forEach(function(a){a.forEach(function(a){var b=context.measureText(a).width+(this._textOffset<<1);b>this._maxTextWidth&&(this._maxTextWidth=b)},this)},this))}},{key:"_checkSize",value:function(){this.size.y<2*this._fontSize*this.data.length&&(this.size.y=2*this._fontSize*this.data.length),this._lineHeight=this.size.y/this.data.length,this._columnWidth=Math.max(this.size.x/this.data[0].length,this._maxTextWidth),this.size.x=this._columnWidth*this.data[0].length}},{key:"doubleClickIn",value:function(a,b){if(!this.clickInBoundingBox(a,b)||this.locked)return!1;var c=parseInt((b-this._position.y)/this._lineHeight),d=parseInt((a-this._position.x)/this._columnWidth),e=this._position.y+c*this._lineHeight+1,f=this._position.x+d*this._columnWidth+1,g=this._columnWidth;return getText(this.data[c][d],new GVector2f(f,e),new GVector2f(g,this._lineHeight).sub(4),function(a){this.data[c][d]=a,this._calcMaxTextWidth(a),this._checkSize()},this),!0}},{key:"draw",value:function(){var a,b,c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:context,d=this._position.x,e=this._position.y,f=[];for(this.moveType>=0&&this._checkSize(),doRect({position:this._position,width:this._size.x,height:this._lineHeight,radius:{tr:this.radius,tl:this.radius},fillColor:this._headerColor,shadow:this.moving&&!this.locked,ctx:c}),doRect({x:this._position.x,y:this._position.y+this._lineHeight,width:this._size.x,height:this._lineHeight*(this.data.length-1),radius:{br:this.radius,bl:this.radius},fillColor:this._bodyColor,shadow:this.moving&&!this.locked,ctx:c}),doRect({position:this._position,size:this._size,radius:this.radius,borderColor:this.borderColor,borderWidth:this.borderWidth,ctx:c}),a=0;a<this.data[0].length;a++)a>0&&f.push([d,this._position.y,d,this._position.y+this.data.length*this._lineHeight]),fillText(this.data[0][a],d+(this._columnWidth>>1),this._position.y+(this._lineHeight>>1),this._fontSize,DEFAULT_FONT_COLOR,0,FONT_ALIGN_CENTER),d+=this._columnWidth;for(a=1;a<this.data.length;a++)for(d=this._position.x,e+=this._lineHeight,a>0&&f.push([this._position.x,e,this._position.x+this._size.x,e]),b=0;b<this.data[a].length;b++)fillText(this.data[a][b],d+(this._columnWidth>>1),e+(this._lineHeight>>1),this._fontSize,DEFAULT_FONT_COLOR,0,FONT_ALIGN_CENTER),d+=this._columnWidth;doLine({points:f,borderWidth:this.borderWidth,borderColor:this.borderColor,ctx:c}),drawBorder(c,this)}}]),b}(Entity),Class=function(a){function b(a,c,d){var e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},f=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},g=arguments.length>5&&void 0!==arguments[5]?arguments[5]:ACCESS_PUBLIC;_classCallCheck(this,b);var h=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,c,[[]]));return h._name=OBJECT_CLASS,h._title=d,h._access=g,h._methods=f,h._attr=e,h._fontSize=15,h._lineHeight=30,h._headerColor="#24D330",h._bodyColor="#CCFFCC",Entity.changeAttr(h,ATTRIBUTE_BORDER_COLOR,shadeColor1(h._headerColor,-20)),h._makeData(),h.size.set(h._size.x,h.data.length*h._lineHeight),h._calcMaxTextWidth(),h._checkSize(),h}return _inherits(b,a),_createClass(b,[{key:"addMethod",value:function(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"void",c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"void",d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:ACCESS_PUBLIC;this._methods[a]={name:a,retType:b,access:d,args:c},this._makeData()}},{key:"addAttribute",value:function(a,b){var c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:ACCESS_PUBLIC;this._attr[a]={name:a,type:b,access:c},this._makeData()}},{key:"_makeData",value:function(){var a=this;this.data=[[this._title]],each(this._attr,function(c){return a.data.push([b._attributeToString(c)])}),each(this._methods,function(c){return a.data.push([b._methodToString(c)])})}},{key:"getJavaSource",value:function(){var a=b.toAccess(this._access)+" class "+this._title+"{\n\t";return a+=$.map(this._attr,function(a){return b.toAccess(a.access)+" "+a.type+" "+a.name+";\n"}).join("\t"),a+=$.map(this._methods,function(a){var c=Array.isArray(a.args)?a.args.map(function(a){return a[1]+" "+a[0]}).join(", "):"",d="\n\t"+b.toAccess(a.access)+" "+a.retType+" ";return d+=a.name+"("+c+"){\n\t\tTODO auto generated body\n\t}\n"}).join("\t"),a+="}"}}],[{key:"_parseAttribute",value:function(a){var b=a.replace(/ /g,"").split(":");return{type:b[1],access:b[0][0],name:b[0].slice(1,b[0].length)}}},{key:"_parseMethod",value:function(a){var b=a.replace(/ /g,"").split(")"),c=b[0].split("("),d=c[1].split(",").map(function(a){return a.split(":")});return"void"==d[0][0]&&(d="void"),{returnType:b[1].replace(":",""),access:b[0][0],name:c[0].slice(1,c[0].length),args:d}}},{key:"toAccess",value:function(a){switch(a){case ACCESS_PUBLIC:return"public";case ACCESS_PRIVATE:return"private";case ACCESS_PROTECTED:return"protected";default:return""}}},{key:"_methodToString",value:function(a){var b=Array.isArray(a.args)?a.args.map(function(a){return a[0]+": "+a[1]}).join(", "):a.args;return a.access+" "+a.name+"("+b+"): "+a.retType}},{key:"_attributeToString",value:function(a){return a.access+" "+a.name+": "+a.type}}]),b}(Table),Polygon=function(a){function b(a,c){_classCallCheck(this,b);var d=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,OBJECT_POLYGON,new GVector2f,new GVector2f,{fillColor:c}));return d.points=a,d.movingPoint=-1,a.length<3&&(Logger.warn("vytvoril sa polygon ktory mal menej ako 3 body a tak sa maže"),Scene.remove(d)),Entity.findMinAndMax(d.points,d.position,d.size),d}return _inherits(b,a),_createClass(b,[{key:"doubleClickIn",value:function(a,b){return!!this.clickInBoundingBox(a,b)&&(this.points.forEach(function(c,d){new GVector2f(a,b).dist(c)<SELECTOR_SIZE&&(this.points.splice(d,1),Entity.findMinAndMax(this.points,this.position,this.size))},this),this.points.length<3&&Scene.remove(this),!0)}},{key:"clickIn",value:function(a,c){if(!this.clickInBoundingBox(a,c))return!1;this.movingPoint=-1;var d=new GVector2f(a,c);return this.points.forEach(function(a,b,c){return this.movingPoint>=0||void(d.dist(a)<SELECTOR_SIZE?this.movingPoint=b:b<c.length&&d.dist(a.x+c[(b+1)%c.length].x>>1,a.y+c[(b+1)%c.length].y>>1)<SELECTOR_SIZE&&(this.movingPoint=parseFloat(b)+.5))},this),this.movingPoint>=0||b.determineClick(this.points,a,c)}},{key:"draw",value:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:context;if(doPolygon({shadow:this.moving&&!this.locked,points:this.points,fillColor:this.fillColor,borderColor:this.borderColor,borderWidth:this.borderWidth,radius:this.radius,ctx:a}),this.selected){drawBorder(a,this,{});for(var b=0;b<this.points.length;b++){var c=b-1;0==b&&(c=this.points.length-1),drawSelectArc(a,this.points[b].x,this.points[b].y),drawSelectArc(a,this.points[b].x+this.points[c].x>>1,this.points[b].y+this.points[c].y>>1)}}}}],[{key:"determineClick",value:function(a,b,c){for(var d=0;d<a.length;d++){var e=d+1,f=d-1;0==d&&(f=a.length-1),d==a.length-1&&(e=0);var g=a[d].getClone().sub(a[f]),h=a[e].getClone().sub(a[d]),i=new GVector2f(b,c).sub(a[d]);if(angleBetween(g,h)<angleBetween(g,i))return!1}return!0}}]),b}(Entity),Join=function(a){function b(a){var c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:JOIN_LINEAR;_classCallCheck(this,b);var d=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,OBJECT_JOIN));return d._obj1=a,d._obj1_connector=a.selectedConnector,d._obj2=null,d._obj2_connector=null,d._lineType=c,Entity.changeAttr(d,{borderColor:"blue",borderWidth:5}),d._tmpPos=a.position.getClone(),d}return _inherits(b,a),_createClass(b,[{key:"updateCreatingPosition",value:function(a){this._tmpPos.set(a)}},{key:"draw",value:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:context;if(null==this._obj1.position)return Logger.warn("ide sa kresliť join ktorý nemá potrebné udaje"),void Scene.remove(this);var b,c=this._obj1.position.getClone().add(this._obj1.size.getClone().mul(this._obj1_connector)),d=[];if(b=null!=this._obj2?this._obj2.position.getClone().add(this._obj2.size.getClone().mul(this._obj2_connector)):this._tmpPos,d.push(c),this._lineType!=JOIN_LINEAR){var e=c.getClone().add(b).br(1),f=c.getClone().sub(b);f.x=Math.abs(f.x),f.y=Math.abs(f.y),f.x>f.y?this._lineType==JOIN_SEQUENCAL?(d.push(new GVector2f(e.x,c.y)),d.push(new GVector2f(e.x,b.y)),d.push(b)):this._lineType==JOIN_BAZIER&&d.push([new GVector2f(e.x,c.y),new GVector2f(e.x,b.y),b]):f.x<=f.y&&(this._lineType==JOIN_SEQUENCAL?(d.push(new GVector2f(c.x,e.y)),d.push(new GVector2f(b.x,e.y)),d.push(b)):this._lineType==JOIN_BAZIER&&d.push([new GVector2f(c.x,e.y),new GVector2f(b.x,e.y),b]))}else d.push(b);this._lineType==JOIN_BAZIER?drawBazierCurve(d,this.borderWidth,this.borderColor):doLine({points:d,borderWidth:this.borderWidth,borderColor:this.borderColor,ctx:a})}},{key:"obj2",set:function(a){this._obj2=a,this._obj2_connector=a.selectedConnector,this._obj1.selectedConnector=!1,this._obj2.selectedConnector=!1}},{key:"type",set:function(a){this._lineType=a,draw()}}]),b}(Entity),Rect=function(a){function b(a,c,d){_classCallCheck(this,b);var e=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,OBJECT_RECT,a,c,{fillColor:d}));return e.moveType=-1,e.minSize=new GVector2f(SELECTOR_SIZE),e.addConnector(new GVector2f(0,0),new GVector2f(1,0),new GVector2f(0,1),new GVector2f(1,1)),e}return _inherits(b,a),_createClass(b,[{key:"updateCreatingPosition",value:function(a){this.size.x=a.x-this.position.x,this.size.y=a.y-this.position.y}},{key:"_hover",value:function(a,b){return this.clickInBoundingBox(a,b)?(setCursor(this._locked?CURSOR_NOT_ALLOWED:CURSOR_POINTER),!0):(setCursor(CURSOR_DEFAULT),!1)}},{key:"_clickIn",value:function(a,b){var c=new GVector2f(a,b);return this.moveType=-1,!(!Input.isKeyDown(L_CTRL_KEY)||(this.checkConnectors(c),!this._selectedConnector))||(Entity.setMoveType(this,c),this.moveType>=0)}},{key:"_checkRadius",value:function(){var a=Math.min(this.size.x,this.size.y)>>1;return this._radius>a?a:this._radius}},{key:"_draw",value:function(a){doRect({position:this.position,size:this.size,fillColor:this.fillColor,shadow:this.moving&&!this.locked,borderWidth:this.borderWidth,borderColor:this.borderColor,radius:this._checkRadius(),ctx:a}),Entity.drawConnectors(this,a),drawBorder(a,this)}}]),b}(Entity),Paint=function(a){function b(){_classCallCheck(this,b);var a=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,OBJECT_PAINT,new GVector2f,new GVector2f));return a._points=[b.defArray()],a._count=0,a._canvas=Project.canvasManager.createCanvas(Project.canvas.width,Project.canvas.height,"canvas"+Project.generateId()),a.onScreenResize(),a._editBackup=[],a}return _inherits(b,a),_createClass(b,[{key:"onScreenResize",value:function(){this._canvas.setCanvasSize(canvas.width,canvas.height),this.redraw(this._points)}},{key:"animate",value:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:20,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._points.length-1,c=this._points,d=0,e=0,f=this;this.cleanUp();var g=setInterval(function(){return d>=b||d>=c.length-1?void clearInterval(g):(Creator.setOpt(ATTRIBUTE_BRUSH_COLOR,c[d].color),
Creator.setOpt(ATTRIBUTE_BRUSH_SIZE,c[d].size),Creator.setOpt(ATTRIBUTE_BRUSH_TYPE,c[d].type),f.addPoint(c[d].points[e]),e++==c[d].points.length-1&&(f.breakLine(),d++,e=0),void draw())},a)}},{key:"redraw",value:function(a){var c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a.length-1;this.cleanUp();var d=[];a.forEach(function(a,b){b>c||isNull(a.color)||(d.push(a),a.points.forEach(function(b,c,d){c&&Paints.drawLine(this._canvas.context,b,d[c-1],a.size,a.color,a.action,a.type)},this))},this),this._points=d,a.length>0&&a[a.length-1].points.length&&this.breakLine(),a[a.length-1].points.length||this._points.push(b.defArray()),Logger.log("prekresluje sa "+this.constructor.name,LOGGER_DRAW)}},{key:"undo",value:function(){return 1!==this._points.length&&(isNull(this._points[this._points.length-1].color)&&this._points.pop(),this._editBackup.push(this._points.pop()),this.redraw(this._points),void(0===this._points.length&&this._points.push(b.defArray())))}},{key:"redo",value:function(){return 0!=this._editBackup.length&&(isNull(this._points[this._points.length-1].color)&&this._points.pop(),this._points.push(this._editBackup.pop()),void this.redraw(this._points))}},{key:"addLine",value:function(a){console.log("prijala sa line: ",a)}},{key:"addPoint",value:function(a){0===this._points.length&&this._points.push(b.defArray());var c=this._points[this._points.length-1],d=c.points;if(CUT_OFF_PATHS_BEFORE&&d.length>2){var e=d[d.length-2].getClone().sub(d[d.length-1]),f=d[d.length-1].getClone().sub(a),g=GVector2f.angle(e,f)*f.length();if(g<CUT_OFF_BEFORE_DISTANCE)return}this._editBackup=[],this._count++,isNull(c.color)&&(c.color=Creator.brushColor,c.action=Paints.action,c.type=Creator.brushType,c.size=Creator.brushSize,c.min=a.getClone(),c.max=a.getClone()),d.length&&Paints.drawLine(this._canvas.context,d[d.length-1],a,Creator.brushSize,Creator.brushColor,Paints.action,Creator.brushType),c.min.x=Math.min(c.min.x,a.x),c.min.y=Math.min(c.min.y,a.y),c.max.x=Math.max(c.max.x,a.x),c.max.y=Math.max(c.max.y,a.y),d.push(a)}},{key:"fromObject",value:function(a){var b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];each(a,function(a){each(a.points,function(a,b,c){c[b]=new GVector2f(a._x,a._y)})}),this.redraw(b?a.concat(this._points):a)}},{key:"toObject",value:function(){return this._points}},{key:"cleanUp",value:function(){this._points=[b.defArray()],this._points[this._actColor]=[[]],this._count=0,this._canvas.context.clearRect(0,0,canvas.width,canvas.height),Logger.log("Bol vyčistený objekt "+this.constructor.name,LOGGER_OBJECT_CLEANED)}},{key:"breakLine",value:function(){if(0===this._points.length)this._points.push(b.defArray());else{if(!(this._points[this._points.length-1].points.length<2))return this._points.push(b.defArray()),CUT_OFF_PATHS_AFTER&&(b.roundPath(this._points[this._points.length-2],CUT_OFF_AFTER_DISTANCE),this.redraw(this._points)),this._points[this._points.length-2];this._points[this._points.length-1]=b.defArray()}return!1}},{key:"findPathsForRemove",value:function(a,b){var c=[];return each(this._points,function(b,d){if(!b.forRemove&&b.min&&b.max){var e=(Creator.brushSize>>1)+(b.size>>1);a.x+e>b.min.x-b.size&&a.y+e>b.min.y&&a.x-e<b.max.x+b.size&&a.y-e<b.max.y&&each(b.points,function(e){!b.forRemove&&e.dist(a)<Creator.brushSize&&(b.forRemove=!0,c.push({line:b,points:[],lineIndex:d}))})}}),!1}},{key:"removeSelectedPaths",value:function(){for(var a=this._points.length;a--;)this._points[a].forRemove&&this._points.splice(a,1);this.redraw(this._points)}},{key:"draw",value:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:context;this.visible&&a.drawImage(this._canvas.canvas,0,0)}},{key:"points",get:function(){return this._points}}],[{key:"defArray",value:function(){return{id:PaintManager.getId(),color:null,action:null,size:null,type:null,points:[],min:null,max:null,forRemove:!1}}},{key:"roundPath",value:function(a,b){for(var c=a.points.length-3;c--;c>0){var d=a.points[c],e=a.points[c+1],f=a.points[c+2],g=GVector2f.angle(e.getClone().sub(d),f.getClone().sub(d)),h=e.getClone().sub(f).length(),i=h*g;i<b&&a.points.splice(c+1,1)}}}]),b}(Entity),Line=function(a){function b(a,c,d){var e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,f=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;_classCallCheck(this,b);var g=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,OBJECT_LINE,new GVector2f,new GVector2f,{fillColor:d,borderWidth:c}));return g._points=a,g.movingPoint=-1,g._lineCap=LINE_CAP_BUTT,g._joinType=LINE_JOIN_MITER,g._lineStyle=LINE_STYLE_NORMAL,g._lineType=JOIN_LINEAR,g._arrow=new Image,g._arrow.src="img/arrow.png",g._arrowEndType=0,g._arrowStartType=0,g.targetA=e,g.targetB=f,g._startText=null,g._text_A="začiatok 10%",g._text_B="koniec 90%",a.length<2&&(Logger.warn("vytvoril sa line ktory mal menej ako 2 body a tak sa maže"),Scene.remove(g)),Entity.findMinAndMax(g._points,g.position,g.size),g}return _inherits(b,a),_createClass(b,[{key:"setStartText",value:function(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:context;if(0===arguments.length||!isString(a)||0===a.length)return void(this._startText=null);var e=10;this._startText={text:a,dist:b,fontSize:e,angle:c,textWidth:CanvasHandler.calcTextWidth(d,a,e+"pt Comic Sans MS")},0===this._startText.dist&&(this._startText.dist=this._startText.textWidth)}},{key:"doubleClickIn",value:function(a,b){return!!this.clickInBoundingBox(a,b)&&(this._points.forEach(function(c,d){new GVector2f(a,b).dist(c)<SELECTOR_SIZE&&(this._points.splice(d,1),Entity.findMinAndMax(this._points,this.position,this.size))},this),this._points.length<2&&Scene.remove(this),!0)}},{key:"_clickIn",value:function(a,c){if(this.movingPoint=-1,null!==this._startText){var d=this._points[this._points.length-1].getClone(),e=this._points[this._points.length-2].getClone(),f=e.sub(d).normalize(),g=this._startText.angle,h=new GVector2f(f.x*Math.cos(g)-f.y*Math.sin(g),f.x*Math.sin(g)+f.y*Math.cos(g)),i=d.add(h.mul(this._startText.dist));i.dist(new GVector2f(a,c))<this._startText.textWidth&&console.log("aaaaaaaaaanooooooooo")}if(this._points.forEach(function(b,d,e){return this.movingPoint>=0||void(new GVector2f(a,c).dist(b)<SELECTOR_SIZE?this.movingPoint=d:d+1<e.length&&new GVector2f(a,c).dist(b.x+e[d+1].x>>1,b.y+e[d+1].y>>1)<SELECTOR_SIZE&&(this.movingPoint=parseFloat(d)+.5))},this),this.movingPoint>=0)return this.movingPoint>=0;for(var j=1;j<this._points.length;j++)if(b.determineClick(this._points[j-1],this._points[j],a,c,10))return!0;return!1}},{key:"setTarget",value:function(a){0===this.movingPoint?this.targetA=a:this.movingPoint==this.points.length-1&&(this.targetB=a)}},{key:"updateCreatingPosition",value:function(a){this._points[this._points.length-1].set(a),Entity.findMinAndMax(this._points,this.position,this.size)}},{key:"draw",value:function(){var a,b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:context,c=this._points.length;this._targetA&&(a=Project.scene.getObject(this._targetLayerA,this._targetA),a?this._points[0].set(a.getConnectorPosition(this._targetConnectionA)):this.targetA=a),this._targetB&&(a=Project.scene.getObject(this._targetLayerB,this._targetB),a?this._points[c-1].set(a.getConnectorPosition(this._targetConnectionB)):this.targetB=a),(this._targetA||this._targetB)&&Entity.findMinAndMax(this._points,this.position,this.size),isNumber(this._radius)&&this._radius>1&&(this._radius+=""),doLine({shadow:this.moving&&!this.locked,lineCap:this._lineCap,joinType:this._joinType,lineStyle:this._lineStyle,points:this._points,borderWidth:this.borderWidth,borderColor:this.fillColor,radius:this.radius,lineDash:this._lineStyle==LINE_STYLE_STRIPPED?[15,5]:[],ctx:b}),Arrow.drawArrow(b,this._points[1],this._points[0],this,this._arrowEndType),Arrow.drawArrow(b,this._points[c-2],this._points[c-1],this,this._arrowStartType);var d,e,f=this._points[0].getClone(),g=this._points[1].getClone();if(e=CanvasHandler.calcTextWidth(b,this._text_B,"10pt Comic Sans MS"),d=f.add(g.sub(f).normalize().mul((e>>1)+10)),doRect({position:d,fillColor:"white",width:e,height:10,center:!0,ctx:b}),b.fillStyle="black",b.textAlign=FONT_HALIGN_CENTER,b.textBaseline=FONT_VALIGN_MIDDLE,b.fillText(this._text_B,d.x,d.y),isObject(this._startText)&&null!==this._startText){var h=this._points[this._points.length-1].getClone(),i=this._points[this._points.length-2].getClone(),j=i.sub(h).normalize(),k=this._startText.angle,l=new GVector2f(j.x*Math.cos(k)-j.y*Math.sin(k),j.x*Math.sin(k)+j.y*Math.cos(k)),m=h.add(l.mul(this._startText.dist));doRect({position:m,fillColor:"white",width:this._startText.textWidth,height:this._startText.fontSize,center:!0,ctx:b}),b.fillStyle="black",b.textAlign=FONT_HALIGN_CENTER,b.textBaseline=FONT_VALIGN_MIDDLE,b.fillText(this._startText.text,m.x,m.y)}if(context.lineWidth=DEFAULT_STROKE_WIDTH<<1,this.selected){drawBorder(b,this,{}),drawSelectArc(b,this._points[0].x,this._points[0].y);for(var n=1;n<c;n++)drawSelectArc(b,this._points[n].x,this._points[n].y),drawSelectArc(b,this._points[n].x+this._points[n-1].x>>1,this._points[n].y+this._points[n-1].y>>1)}}},{key:"points",get:function(){return this._points}},{key:"lineCap",set:function(a){this._lineCap=a}},{key:"arrowEndType",set:function(a){this._arrowEndType=a}},{key:"lineType",set:function(a){this._lineType=a}},{key:"joinType",set:function(a){this._joinType=a}},{key:"lineStyle",set:function(a){this._lineStyle=a}},{key:"arrowStartType",set:function(a){this._arrowStartType=a}},{key:"targetB",set:function(a){var b=a?a.id:"";this._targetB!=b&&(this._targetB=b,this._targetLayerB=a?a.layer:"",this._targetConnectionB=a?a.selectedConnector:"")}},{key:"targetA",set:function(a){var b=a?a.id:"";this._targetA!=b&&(this._targetA=b,this._targetLayerA=a?a.layer:"",this._targetConnectionA=a?a.selectedConnector:"")}}],[{key:"determineClick",value:function(a,b,c,d,e){if(c<Math.min(a.x,b.x)||c>Math.max(a.x,b.x)||d<Math.min(a.y,b.y)||d>Math.max(a.y,b.y))return!1;var f,g,h,i,j=a.dist(b),k=Math.ceil(Math.log2(j));for(a.x<b.x?(f=a.getClone(),g=b.getClone()):(f=b.getClone(),g=a.getClone()),h=f.getClone().add(g).br(1),i=0;i<k;i++)if(c>h.x?f=h:g=h,h=f.add(g).br(1),Math.abs(d-h.y)<e)return!0;return!1}}]),b}(Entity),Arc=function(a){function b(a,c,d){_classCallCheck(this,b);var e=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,OBJECT_ARC,a,c,{fillColor:d,minSize:new GVector2f(SELECTOR_SIZE)}));return e.moveType=-1,e}return _inherits(b,a),_createClass(b,[{key:"updateCreatingPosition",value:function(a){this.size.x=a.x-this.position.x,this.size.y=a.y-this.position.y}},{key:"_clickIn",value:function(a,b){var c=new GVector2f(a,b);return this.moveType=-1,this.checkConnectors(c),!!this._selectedConnector||(Entity.setMoveType(this,c),this.moveType>=0)}},{key:"_draw",value:function(a){doArc({position:this.position,size:this.size,fillColor:this.fillColor,borderColor:this.borderColor,borderWidth:this.borderWidth,shadow:this.moving&&!this.locked,ctx:a}),Entity.drawConnectors(this,a),drawBorder(a,this)}}]),b}(Entity),MINIMAL_DIAGONAL=10,Area=function(){function a(){_classCallCheck(this,a),this.clear(),this._name=OBJECT_AREA,this._moving=!1,this._min=new GVector2f,this._max=new GVector2f,this._offset=new GVector2f}return _createClass(a,[{key:"move",value:function(a,b){this._offset.add(a,b)}},{key:"clear",value:function(){this._points=[],this._isCreating=!1}},{key:"removeSelected",value:function(a){var b=(arguments.length>1&&void 0!==arguments[1]&&arguments[1],this);this._max.getClone().sub(this._min);Project.scene.forEach(function(c){var d=b._isPointIn(c.position.x,c.position.y),e=b._isPointIn(c.position.x+c.size.x,c.position.y),f=b._isPointIn(c.position.x,c.position.y+c.size.y),g=b._isPointIn(c.position.x+c.size.x,c.position.y+c.size.y);a?(d||e||f||g)&&Scene.remove(c):d&&e&&f&&g&&Scene.remove(c)}),each(Project.scene.layers,function(c){var d=c.paint.points;each(d,function(c){if(!c.points.length)return!1;var d=b._isPointIn(c.min.x,c.min.y),e=b._isPointIn(c.max.x,c.min.y),f=b._isPointIn(c.min.x,c.max.y),g=b._isPointIn(c.max.x,c.max.y);if(!(d||e||f||g))return!1;var h;if(a){var h=!1;each(c.points,function(a){h||(h=b._isPointIn(a.x,a.y))})}else h=!0,each(c.points,function(a){h&&(h=b._isPointIn(a.x,a.y))});c.forRemove=h}),c.paint.removeSelectedPaths()})}},{key:"_isPointIn",value:function(a,b){if(this._points<2)return!1;var c=0,d=0,e=[];return each(this._points,function(f,g,h){var i=h[(g+1)%h.length];(f.y>=b&&i.y<b||f.y<=b&&i.y>b)&&(i.x>a&&f.x>a?d++:i.x<a&&f.x<a?c++:e.push([f.x,f.y,i.x,i.y]))}),0!=e.length||d%2!=0&&c%2!=0}},{key:"hover",value:function(a,b){if(this._isCreating)return!1;var c=a>this._min.x&&b>this._min.y&&a<this._max.x&&b<this._max.y;return c&&(c=this._isPointIn(a,b)),setCursor(c?CURSOR_POINTER:CURSOR_DEFAULT),c!==!1}},{key:"clickIn",value:function(a,b){return this._isPointIn(a,b)}},{key:"addPoint",value:function(a){var b=this._points[this._points.length-1];doLine({points:[b.x,b.y,a.x,a.y],borderWidth:5,borderColor:"blue"}),this._min.x=Math.min(this._min.x,a.x),this._min.y=Math.min(this._min.y,a.y),this._max.x=Math.max(this._max.x,a.x),this._max.y=Math.max(this._max.y,a.y),this._points.push(a)}},{key:"startCreate",value:function(a){this.clear(),this._points.push(a),this._isCreating=!0,this._min.set(a),this._max.set(a)}},{key:"endCreate",value:function(a){this._points.push(a),this._isCreating=!1,this._min.x=Math.min(this._min.x,a.x),this._min.y=Math.min(this._min.y,a.y),this._max.x=Math.max(this._max.x,a.x),this._max.y=Math.max(this._max.y,a.y)}},{key:"draw",value:function(){arguments.length>0&&void 0!==arguments[0]?arguments[0]:context;this._isCreating||this._points.length<=3||doPolygon({points:this._points,offset:this._offset,borderWidth:5,borderColor:"red"})}},{key:"name",get:function(){return this._name}},{key:"moving",get:function(){return this._moving},set:function(a){var b=this;this._moving=a,a||(each(this._points,function(a){a.x+=b._offset.x,a.y+=b._offset.y}),this._min.add(this._offset),this._max.add(this._offset),this._offset.set(0,0))}},{key:"isCreating",get:function(){return this._isCreating}},{key:"isReady",get:function(){return this._min&&this._max&&this._min.dist(this._max)>MINIMAL_DIAGONAL}}]),a}(),Graph=function(a){function b(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];_classCallCheck(this,b);var d=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,OBJECT_GRAPH,new GVector2f,new GVector2f));return d._vertices=a,d._edges=c,d}return _inherits(b,a),_createClass(b,[{key:"addVertex",value:function(a){return!(!isObject(a)||isUndefined(a.x)||isUndefined(a.y))&&(a.fillColor=a.fillColor||GRAPH_FILL_COLOR,a.borderColor=a.borderColor||GRAPH_BORDER_COLOR,a.size=a.size||GRAPH_VERTEX_COLOR,a.borderWidth=a.borderWidth||GRAPH_BORDER_WIDTH,a.label=a.label||"",void this._vertices.push(a))}},{key:"addEdge",value:function(a){return!(!isObject(a)||isUndefined(a.A)||isUndefined(a.B))&&(a.fillColor=a.fillColor||GRAPH_BORDER_COLOR,a.borderWidth=a.borderWidth||GRAPH_BORDER_WIDTH,a.labelA=a.labelA||"",a.labelB=a.labelB||"",a.startA=a.startA||LINE_NONE,a.startB=a.startB||LINE_NONE,void this._edges.push(a))}},{key:"draw",value:function(){var a=this;each(this._edges,function(b){"undefined"!=typeof a._vertices[b.A]&&"undefined"!=typeof a._vertices[b.B]&&doLine({points:[a._vertices[b.A].x,a._vertices[b.A].y,a._vertices[b.B].x,a._vertices[b.B].y],borderWidth:b.borderWidth,borderColor:b.fillColor})}),each(this._vertices,function(a){return doArc({x:a.x,y:a.y,fillColor:a.fillColor,size:a.size,borderColor:a.borderColor,borderWidth:a.borderWidth,center:!0})})}}]),b}(Entity),ImageObject=function(a){function b(a,c,d,e){_classCallCheck(this,b);var f=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,OBJECT_IMAGE,a,c,e));return f._radius=20,f._image=d||null,f}return _inherits(b,a),_createClass(b,[{key:"updateCreatingPosition",value:function(a){this.size.x=a.x-this.position.x,this.size.y=a.y-this.position.y}},{key:"clickIn",value:function(a,b){if(!this.clickInBoundingBox(a,b))return!1;var c=new GVector2f(a,b);return this.moveType=-1,this.checkConnectors(c),!!this._selectedConnector||(Entity.setMoveType(this,c),this.moveType>=0)}},{key:"draw",value:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:context;doRect({bgImage:this._image||!1,fill:null===this._image,position:this._position,size:this.size,radius:this.radius,draw:!0,shadow:this.moving&&!this.locked,borderWidth:this.borderWidth,borderColor:this.borderColor,ctx:a}),drawBorder(a,this)}},{key:"image",set:function(a){this._image=a}}]),b}(Entity),TextArea=function(a){function b(a,c,d){var e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:DEFAULT_FONT_COLOR;_classCallCheck(this,b);var f=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,OBJECT_TEXT,c,d,{fillColor:DEFAULT_BACKGROUND_COLOR,radius:DEFAULT_RADIUS}));return f._text=a||"",f._textColor=e,f._fontSize=DEFAULT_FONT_SIZE,f._moveType=-1,f._verticalTextAlign=FONT_VALIGN_TOP,f._horizontalTextAlign=FONT_HALIGN_LEFT,f._fontOffset=DEFAULT_TEXT_OFFSET,f._selected=!1,f._padding=20,f._lineHeight=30,f.addConnector(new GVector2f(0,0),new GVector2f(1,0),new GVector2f(0,1),new GVector2f(1,1)),f}return _inherits(b,a),_createClass(b,[{key:"_blur",value:function(){this._selected=!1,SelectedText=null}},{key:"clickIn",value:function(a,b){if(!this.clickInBoundingBox(a,b))return this._selected&&this._blur(),!1;this._selected=!0,SelectedText=this;var c=this.position,d=new GVector2f(a,b),e=document.getElementById("selectedEditor");return e&&document.body.removeChild(e),e=document.createElement("div"),e.setAttribute("id","selectedEditor"),e.setAttribute("contenteditable","true"),e.style.top=this._position.y+"px",e.style.left=this._position.x+"px",e.style.width=this._size.x+"px",e.style.height=this._size.y+"px",e.style.backgroundColor=this._fillColor,e.style.borderRadius=this._radius+"px",e.style.padding=this._padding+"px",e.style.color=this._textColor,e.style.zIndex=1e5,e.style.font=this._fontSize+"pt "+DEFAULT_FONT,document.body.insertBefore(e,document.getElementById("myCanvas")),this.checkConnectors(d),!!this._selectedConnector||(d.dist(c.x+(this.size.x>>1),c.y)<SELECTOR_SIZE?this._moveType=0:d.dist(c.x+this.size.x,c.y+(this.size.y>>1))<SELECTOR_SIZE?this._moveType=1:d.dist(c.x+(this.size.x>>1),c.y+this.size.y)<SELECTOR_SIZE?this._moveType=2:d.dist(c.x,c.y+(this.size.y>>1))<SELECTOR_SIZE?this._moveType=3:d.dist(c.x+this.size.x,c.y+this.size.y)<SELECTOR_SIZE?this._moveType=5:a>this.position.x&&b>this.position.y&&a<this.position.x+this.size.x&&b<this.position.y+this.size.y&&(this._moveType=4),this._moveType>=0)}},{key:"draw",value:function(){var a=this,b=this.position.getClone();doRect({shadow:this.moving&&!this.locked,position:this.position,size:this.size,radius:this.radius,fillColor:this.fillColor,borderWidth:this._borderWidth,draw:!0,fill:!0}),context.textAlign=this._horizontalTextAlign,context.textBaseline=this._verticalTextAlign,context.fillStyle=this._textColor,context.font=this._fontSize+"pt "+DEFAULT_FONT;var c=this._padding;each(this._text,function(d){context.fillText(d,b.x+a._padding,b.y+c),c+=1.4*a._lineHeight})}},{key:"text",set:function(a){console.log(a),this._text=a.split("\n")}}]),b}(Entity),Arrow=function(){function a(){_classCallCheck(this,a)}return _createClass(a,null,[{key:"drawArrow",value:function(a,b,c,d){var e=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,f=arguments.length>5&&void 0!==arguments[5]?arguments[5]:Math.PI/6,g=arguments.length>6&&void 0!==arguments[6]?arguments[6]:30;if(0!=e){var h=c.getClone().sub(b).normalize(),i=Math.cos(f),j=Math.sin(f),k=new GVector2f(c.x,c.y),l=new GVector2f(c.x-(h.x*i-h.y*j)*g,c.y-(h.x*j+h.y*i)*g),m=new GVector2f(c.x-(h.x*i+h.y*j)*g,c.y+(h.x*j-h.y*i)*g),n=new GVector2f(c.x-((h.x*i-h.y*j)*g<<1)+(c.x-((h.x*i+h.y*j)*g<<1))>>1,c.y-((h.x*j+h.y*i)*g<<1)+(c.y+((h.x*j-h.y*i)*g<<1))>>1);switch(e){case 2210:doLine({points:[[l,k],[m,k]],borderColor:d.borderColor,borderWidth:d.borderWidth,ctx:a});break;case 2211:doPolygon({points:[k,l,m],fill:!0,draw:!0,borderColor:d.borderColor,fillColor:d.fillColor,borderWidth:d.borderWidth,ctx:a});break;case 2212:doPolygon({points:[k,l,m],fill:!0,draw:!0,borderColor:d.borderColor,fillColor:d.borderColor,borderWidth:d.borderWidth,ctx:a});break;case 2213:doPolygon({points:[l,k,m,n],fill:!0,draw:!0,borderColor:d.borderColor,fillColor:d.fillColor,borderWidth:d.borderWidth,ctx:a});break;case 2214:doPolygon({points:[l,k,m,n],fill:!0,draw:!0,borderColor:d.borderColor,fillColor:d.borderColor,borderWidth:d.borderWidth,ctx:a})}}}}]),a}(),Test=function(){function a(){_classCallCheck(this,a)}return _createClass(a,[{key:"testContextMenu",value:function(){}},{key:"testInput",value:function(){var a=new InputManager;(a.isButtonDown(0)||a.isButtonDown("gabo")||a.isButtonDown(!1)||a.isButtonDown(0))&&Logger.error("button je dole aj ked by tam nemal byť"),(a.isKeyDown(0)||a.isKeyDown("gabo")||a.isKeyDown(!1)||a.isKeyDown(0))&&Logger.error("key je dole aj ked by tam nemal byť"),a.keyDown(0),a.isKeyDown(0)||Logger.error("key nieje dole ked by mal byť dole"),a.keyUp(0),a.isKeyDown(0)&&Logger.error("key je dole aj ked by tam už nemal byť"),a.buttonDown({button:0}),a.isButtonDown(0)||Logger.error("button nieje dole ked by mal byť dole"),a.buttonUp({button:0}),a.isButtonDown(0)&&Logger.error("button je dole aj ked by tam už nemal byť")}},{key:"testTable",value:function(){}}],[{key:"allTests",value:function(){}}]),a}(),SharerManager=function(){function a(){var b=this;_classCallCheck(this,a),this._id=!1,this._socket=!1,this._sharing=!1,this.paint={addPoint:function(a,c){return b._paintOperation(ACTION_PAINT_ADD_POINT,a,c)},breakLine:function(a){return b._paintOperation(ACTION_PAINT_BREAK_LINE,a)},clean:function(a){return b._paintOperation(ACTION_PAINT_CLEAN,a)}},this._sender=new EventTimer(function(a){return b._sendStack()},1e3/60),this._buffer=[],Logger&&Logger.log("Bol vytvorený objekt "+this.constructor.name,LOGGER_COMPONENT_CREATE)}return _createClass(a,[{key:"_sendStack",value:function(){this._socket&&!this._socket.disconnected&&(this._socket.emit("sendBuffer",this._buffer),this._buffer=[])}},{key:"startShare",value:function(a){this._socket=io(),this._sharing=!0,this._startTime=Date.now(),this._sharePaints=a.sharePaints,this._shareCreator=a.shareCreator,this._shareObjects=a.shareObjects,this._maximalWatchers=a.maxWatchers,this._actualWatchers=[];var b=this,c={res:{x:window.innerWidth,y:window.innerHeight},pass:a.password,limit:a.maxWatchers,realTime:a.realTime,detailMovement:a.detailMovement,share:{menu:a.shareMenu,paints:this._sharePaints,creator:this._shareCreator,objects:this._shareObjects}};this._socket.on("chatMessage",function(a){Panel.recieveMessage(a.text,a.sender)}),this._sendMessage("startShare",c),this._socket.on("notification",function(a){Logger.notif("prijatá správa: "+a.msg),console.log(a.msg)}),this._socket.on("confirmShare",function(a){b._id=a.id;var c=document.createElement("a");c.setAttribute("target","_blank"),c.setAttribute("href",b.watcherUrl),c.appendChild(document.createTextNode("adrese")),c.style.float="none";var d=document.createElement("span");d.appendChild(document.createTextNode("zdiela sa na ")),d.appendChild(c),d.appendChild(document.createTextNode(" s ID "+a.id)),Logger.notif(d),Menu.disabled("sharing","watch"),Menu.disabled("sharing","stopShare"),Menu.disabled("sharing","shareOptions"),Menu.disabled("sharing","copyUrl"),Menu.disabled("sharing","startShare"),Panel.startShare(sendMessage)}),this._socket.on("getAllData",function(a){console.log("prišla žiadosť o odoslanie všetkých dát");var c={id:b._id,msg:{scene:Scene.toObject(),creator:Creator.toObject(),paint:Paints.toObject()},target:a.target};console.log("recData.nickName: "+a.nickName),Panel.addWatcher(a.nickName),b._actualWatchers.push(a.nickName),Logger.notif("prijatá správa: Nový watcher "+a.nickName+" sa úspešne pripojil"),b._sendMessage("sendAllData",c)})}},{key:"stopShare",value:function(){Menu.disabled("sharing","watch"),Menu.disabled("sharing","stopShare"),Menu.disabled("sharing","shareOptions"),Menu.disabled("sharing","copyUrl"),Menu.disabled("sharing","startShare"),this._id=!1,this._socket.disconnect(),this._socket=!1,this._sharing=!1,Panel.stopShare()}},{key:"copyUrl",value:function(){var a=document.createElement("textarea");a.appendChild(document.createTextNode(this.watcherUrl)),document.body.appendChild(a),a.select();try{document.execCommand("copy"),Logger.notif("Adresa zdielania bola úspečne skopírovaná do schránky")}catch(a){Logger.notif("Nepodarilo sa skopírovať adresu zdielania")}document.body.removeChild(a)}},{key:"changeCreator",value:function(a,b){var c={id:this._id,msg:{key:a,val:b}};this._sendMessage("changeCreator",c)}},{key:"_paintOperation",value:function(a,b,c){if(!this._sharePaints)return!1;var d={id:this._id,msg:{action:a}};switch(a){case ACTION_PAINT_ADD_POINT:d.msg.pX=b.x,d.msg.pY=b.y,d.msg.layer=c;break;case ACTION_PAINT_BREAK_LINE:d.msg.layer=b;break;case ACTION_PAINT_CLEAN:d.msg.layer=b;break;default:return void Logger.error("nastala chyba lebo sa chce vykonať neznáma paintAction: "+a)}this._sendMessage("paintAction",d)}},{key:"sendMessage",value:function(a,b){var c={id:this._id,msg:{text:a,sender:b}};this._sendMessage("chatMessage",c)}},{key:"mouseChange",value:function(a,b,c){if(!this._id)return!1;var d={id:this._id,msg:{posX:Input.mousePos.x,posY:Input.mousePos.y,buttonDown:Input.isButtonDown(LEFT_BUTTON)}};this._sendMessage("mouseData",d)}},{key:"_sendMessage",value:function(a,b){this._sender.callIfCan(),this._buffer.push([a,b]),this._socket.emit(a,b)}},{key:"objectChange",value:function(a,b,c){if(this._socket){var d={id:this._id,msg:{action:b}};switch(b){case ACTION_OBJECT_MOVE:d.msg.oId=a.id,d.msg.oL=a.layer,d.msg.oX=a.position.x,d.msg.oY=a.position.y,d.msg.oW=a.size.x,d.msg.oH=a.size.y;break;case ACTION_OBJECT_CHANGE:d.msg.oId=a.id,d.msg.oL=a.layer,d.msg.keys={},each(c,function(b,c){return d.msg.keys.i=a[c]});break;case ACTION_OBJECT_DELETE:d.msg.oId=a.id,d.msg.oL=a.layer;break;case ACTION_OBJECT_CREATE:d.msg.o=a;break;default:return void Logger.error("nastala chyba lebo sa chce vykonať neznáma akcia: "+b)}this._sendMessage("action",d)}}},{key:"write",value:function(a){this._sendMessage("broadcastMsg",{id:this._id,msg:a})}},{key:"isSharing",get:function(){return this._sharing}},{key:"maxWatchers",get:function(){return this._maximalWatchers}},{key:"duration",get:function(){return Date.now()-this._startTime}},{key:"watcherUrl",get:function(){return location.origin+"/watcher?id="+this._id}}]),a}(),TaskManager=function(){function a(b,c,d){var e=this;_classCallCheck(this,a),this._title=c,this._layer=d,this._resultCount=0,this._results={},this._start=Date.now(),each(b,function(a,b){e._results[b]={correctValue:a,correct:!1},e._resultCount++}),Logger.log("Bol vytvorený objekt "+this.constructor.name,LOGGER_COMPONENT_CREATE)}return _createClass(a,[{key:"onSuccess",value:function(){Logger.notif("Všetko je vyriešené správne")}},{key:"_getMissingResultsCount",value:function(){var a=0;return each(this._results,function(b){b.correct||a++}),a}},{key:"checkResult",value:function(a){return!(!this._results[a.id]||this._results[a.id].correctValue!==a.text)&&(this._results[a.id].correct=!0,this._results[a.id].time=Date.now(),0===this._getMissingResultsCount()&&this.onSuccess(),!0)}},{key:"draw",value:function(){}}]),a}(),FormManager=function(){function a(b){_classCallCheck(this,a),this._data=b,this._allowerAttributes=["id","style","name","value","onclick","onchange","placeholder","disabled","visible"]}return _createClass(a,[{key:"createForm",value:function(a){return this._generateForm(this._data[a])}},{key:"_createInput",value:function(b){var c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(b.visible===!1)return null;var d,e,f=new G("div",{});if(isIn(b.type,"checkbox","multiCheckbox")&&!c&&f.attr("class","panel"),b.label&&b.id&&!c&&f.append('<label for="'+b.id+'">'+b.label+": </label>"),"multiCheckbox"===b.type){f.append(G.createElement("div",{cont:b.label}));var g=new G("div",{});for(d in b.items)b.items.hasOwnProperty(d)&&g.append(this._createInput(b.items[d],!0));f.append(g)}else if("wrapper"==b.type){var h=new G("div",{});a._setAllCheckedAttributes(h.first(),this._allowerAttributes,b);for(d in b.items)b.items.hasOwnProperty(d)&&h.append(this._createInput(b.items[d]));f.append(h)}else if("combobox"===b.type){e=new G("select",{}),a._setAllCheckedAttributes(e.first(),this._allowerAttributes,b),b.disabled===!0&&e.attr("disabled",b.disabled);for(d in b.options)b.options.hasOwnProperty(d)&&e.append(G.createElement("option",{value:b.options[d].value},b.options[d].label));f.append(e)}else"plainText"===b.type?f.append(b.text):(e=new G("input",{attr:{type:b.type}}),"boolean"==typeof b.checked&&e.attr("checked",b.checked),a._setAllCheckedAttributes(e.first(),this._allowerAttributes,b),f.append(e));return c&&f.append('<label for="'+b.id+'">'+b.label+": </label>"),f.first()}},{key:"_generateForm",value:function(a){var b=new G("form",{cont:"<h2>"+a.title+"</h2><br/>"});for(var c in a.elements)if(a.elements.hasOwnProperty(c)){var d=this._createInput(a.elements[c]);d&&b.append(d)}return b.first()}}],[{key:"_setAllCheckedAttributes",value:function(a,b,c){for(var d in b)b.hasOwnProperty(d)&&c[b[d]]&&a.setAttribute(b[d],c[b[d]])}}]),a}();